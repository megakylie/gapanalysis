---
title: "Invert Code"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

This is an R Markdown for the Gap Analysis Invertebrate Graph and Table Making. This is the cleaned up code from my first run with Hymenoptera, this code should be able to be used with all the datasets for each Order with little adjustment. 

Diptera 

# Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)

dip_inat <- read_csv("diptera/dip_inat.csv")
dip_lacm <- read_csv("diptera/dip_lacm.csv")
dip_chis <- read_csv("diptera/dip_chis.csv")
dip_bold <- read_csv("diptera/dip_bold.csv")

# extra for flies
dip_nic <- read_csv("diptera/dip_nic.csv")

```


# Step 2. Combine datasets 
```{r}
dip_inat_combine <- dip_inat %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_lacm_combine <- dip_lacm %>%
   select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_chis_combine <- dip_chis %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_nic_combine <- dip_nic %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_master = rbind(dip_inat_combine, dip_chis_combine, dip_lacm_combine, dip_nic_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

# bold doesn't have date info
dip_bold_combine <-dip_bold %>%
   select(source, island, acceptedFamily, acceptedGenus, acceptedName) 

dip_combine <- dip_master %>%
   select(source, island, acceptedFamily, acceptedGenus, acceptedName) 

dip_master_bold = rbind(dip_combine, dip_bold_combine)
```

```{r heat map}
dip_inat_map <- dip_inat %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

```

# Step. 3 Make Graphs! 

## Island Graph 
```{r Graphing by island}

dip_islandsum <- dip_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))

dip_island_graph <- ggplot(data = dip_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(x ="Island", 
       y = "Number of Specimens Collected",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1200), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

dip_island_graph

```

## Temporal Graph
```{r Graphing by year}

dip_occyear = ggplot(dip_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 1000)) + 
  scale_x_continuous(limits=c(1910, 2025)) + 
  labs(x="Year", y ="Number of Specimens Sampled")

dip_occyear

ggsave(plot=dip_isoccmonth, filename="diptera/DipteraGraphs/dip_year.png", height=5, width=9, units="in", dpi=300)

```

##Graphing the seasonal gaps in collections. 

```{r Graphing by month}

occmonth <- ggplot(mastersyn, aes(x=month, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0)) + 
  labs(x="Month", y ="Number of Specimens Samples") +
  scale_x_continuous(breaks = seq(1, 12, by=1)) 

occmonth

# by month and island 
dip_master$month <- as.factor(dip_master$month)
dip_month <- na.omit(subset(dip_master, select = c(island, month)))

dip_isoccmonth <- ggplot(dip_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

dip_isoccmonth 

ggsave(plot=dip_isoccmonth, filename="diptera/DipteraGraphs/dip_seasonal.png", height=5, width=9, units="in", dpi=300)

```

