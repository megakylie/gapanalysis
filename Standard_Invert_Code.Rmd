---
title: "Invert Code"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

This is an R Markdown for the Gap Analysis Invertebrate Graph and Table Making. This is the cleaned up code from my first run with Hymenoptera, this code should be able to be used with all the datasets for each Order with little adjustment. 

Includes: Diptera, Mollusks, Chilopoda, Diplopoda, Blattodea, Odonata

#Packages to Download 
```{r Download Packages}
# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

# Diptera 

### Dip Step 1. Download Packages *above* and Import Data
```{r setup}

dip_inat <- read_csv("diptera/dip_inat.csv")
dip_lacm <- read_csv("diptera/dip_lacm.csv")
dip_chis <- read_csv("diptera/dip_chis.csv")
dip_bold <- read_csv("diptera/dip_bold.csv")

# extra for flies
dip_nic <- read_csv("diptera/dip_nic.csv")

```


### Dip Step 2. Combine datasets 
```{r Selecting columns and combining}
dip_inat_combine <- dip_inat %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_lacm_combine <- dip_lacm %>%
   select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_chis_combine <- dip_chis %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_nic_combine <- dip_nic %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

dip_master = rbind(dip_inat_combine, dip_chis_combine, dip_lacm_combine, dip_nic_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

# bold doesn't have date info
dip_bold_combine <-dip_bold %>%
   select(source, island, acceptedFamily, acceptedGenus, acceptedName) 

dip_combine <- dip_master %>%
   select(source, island, acceptedFamily, acceptedGenus, acceptedName) 

dip_master_bold = rbind(dip_combine, dip_bold_combine)
```

```{r heat map}
dip_inat_map <- dip_inat %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

```

###Dip Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

dip_islandsum <- dip_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))

dip_island <- ggplot(data = dip_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Diptera Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1200), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

dip_island 

ggsave(plot=dip_island, filename="diptera/DipteraGraphs/dip_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
dip_islandsum2 = merge(dip_islandsum, island_size, by="island", all.y=TRUE)
dip_islandprop = dip_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

dip_island_prop <- ggplot(data = dip_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Diptera Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,70), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

dip_island_prop 

ggsave(plot=dip_island_prop, filename="diptera/DipteraGraphs/dip_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}


dip_year = ggplot(dip_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 1000)) + 
  scale_x_continuous(limits=c(1910, 2025)) + 
  labs(x="Year", y ="Number of Diptera Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

dip_year

ggsave(plot=dip_year, filename="diptera/DipteraGraphs/dip_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

occmonth <- ggplot(mastersyn, aes(x=month, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0)) + 
  labs(x="Month", y ="Number of Specimens Samples") +
  scale_x_continuous(breaks = seq(1, 12, by=1)) 

occmonth

# by month and island 
dip_master$month <- as.factor(dip_master$month)
dip_month <- na.omit(subset(dip_master, select = c(island, month)))


dip_ismonth <- ggplot(dip_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Diptera Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

dip_ismonth 

ggsave(plot=dip_ismonth, filename="diptera/DipteraGraphs/dip_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Dip Step 4. Make Tables 
```{r Family by Source Table}
q = table(dip_master_bold$acceptedFamily)
q = as.data.frame.table(q)
write.csv(q, "diptera/DipteraGraphs/dip_table.csv")

# include BOLD? so few 
table(dip_bold_combine$acceptedFamily)

table(dip_chis_combine$acceptedFamily)

table(dip_lacm_combine$acceptedFamily)

table(dip_inat_combine$acceptedFamily)

table(dip_nic_combine$acceptedFamily)

write.csv(dip_master, "diptera/DipteraGraphs/dip_master.csv", na="")


```

```{r Source Resolution}
ddply(dip_master_bold, "source", summarise, n = length(unique(acceptedFamily)))

ddply(dip_master_bold, "source", summarise, n = length(acceptedFamily))
ddply(dip_master_bold, "source", summarise, n = length(acceptedGenus))
ddply(dip_master_bold, "source", summarise, n = length(acceptedName))

```




#
# Mollusks

###Mol Step 1. Download Packages and Import Data
```{r setup}

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r download data}
mol_inat <- read_csv("mollusks/mol_inat.csv")

mol_chis <- read_csv("mollusks/mol_chis.csv")

```


###Mol Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
mol_inat_combine <- mol_inat %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

mol_chis_combine <- mol_chis %>%
  rename(latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)


mol_master = rbind(mol_inat_combine, mol_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order= "acceptedOrder")

```

###Mol Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

mol_islandsum <- mol_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
mol_islandsum <- na.omit(subset(mol_islandsum, select = c(island, samples, source)))

mol_island <- ggplot(data = mol_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Mollusk Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,900), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mol_island 

ggsave(plot=mol_island, filename="mollusks/MolluskGraphs/mol_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
mol_islandsum2 = merge(mol_islandsum, island_size, by="island", all.y=TRUE)
mol_islandprop = mol_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

mol_island_prop <- ggplot(data = mol_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Mollusk Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,65), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mol_island_prop 

ggsave(plot=mol_island_prop, filename="mollusks/MolluskGraphs/mol_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
There is no year information for about half of the Cal-IBIS records
```{r Graphing by year}

mol_year = ggplot(mol_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 400)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1790, 2025), breaks=c(1800, 1863, 1875, 1885, 1900, 1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Mollusk Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

mol_year

ggsave(plot=mol_year, filename="mollusks/MolluskGraphs/mol_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
mol_master$month <- as.factor(mol_master$month)
mol_month <- na.omit(subset(mol_master, select = c(island, month)))


mol_ismonth <- ggplot(mol_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0)) + 
  labs(x="Mollusk Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

mol_ismonth 

ggsave(plot=mol_ismonth, filename="mollusks/MolluskGraphs/mol_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Mol Step 4. Make Tables 
```{r Family by Source Table}
moltab = table(mol_master$acceptedFamily)
moltab = as.data.frame.table(moltab)
write.csv(moltab, "mollusks/MolluskGraphs/mol_table.csv")


table(mol_chis_combine$acceptedFamily)


table(mol_inat_combine$acceptedFamily)
```

```{r Source Resolution}
ddply(mol_master, "source", summarise, n = length(unique(acceptedFamily)))

write.csv(mol_master, "mollusks/mol_master.csv")
```




#
# Chilopoda 

###Chilo Step 1. Download Packages and Import Data
```{r packages}

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r data}
chilo_inat <- read_csv("chilopoda/chilo_inat.csv")
```

###Chilo Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
chilo_inat_combine <- chilo_inat %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName)

chilo_master = rbind(chilo_inat_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "Santa Cruz", "Anacapa", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order = "acceptedOrder")

```

###Chilo Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
chilo_islandsum <- chilo_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
##FF6600
island_size = read_csv("island_size.csv")
chilo_islandsum2 = merge(chilo_islandsum, island_size, by="island", all.y=TRUE)

chilo_island <- ggplot(data = chilo_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Chilopoda Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,45), expand = c(0,0)) +
   scale_fill_manual(values=c("#FF5500"))

chilo_island 

ggsave(plot=chilo_island, filename="chilopoda/ChilopodaGraphs/chilo_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
chilo_islandsum2 = merge(chilo_islandsum, island_size, by="island", all.y=TRUE)
chilo_islandprop = chilo_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

chilo_island_prop <- ggplot(data = chilo_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Chilopoda Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,0.5), expand = c(0,0)) +
  scale_fill_manual(values=c("#FF5500"))

chilo_island_prop 

ggsave(plot=chilo_island_prop, filename="chilopoda/ChilopodaGraphs/chilo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
chilo_year = ggplot(chilo_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 30)) + 
  scale_x_continuous(limits=c(2000, 2022),   breaks=c(2000, 2005, 2010, 2015, 2020)) + 
  labs(x="Year", y ="Number of Chilopoda Specimens Sampled") +  scale_fill_manual(values=c("#FF5500"))

chilo_year

ggsave(plot=chilo_year, filename="chilopoda/chilopodaGraphs/chilo_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
chilo_master$month <- as.factor(chilo_master$month)
chilo_month <- na.omit(subset(chilo_master, select = c(island, month)))


chilo_ismonth <- ggplot(chilo_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0)) + 
  labs(x="Chilopoda Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

chilo_ismonth 

ggsave(plot=chilo_ismonth, filename="chilopoda/chilopodaGraphs/chilo_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Chilo Step 4. Make Tables 
```{r Family by Source Table}
chilotab = table(chilo_master$acceptedFamily)
chilotab = as.data.frame.table(chilotab)
write.csv(chilotab, "chilopoda/ChilopodaGraphs/chilo_table.csv")

chilotab2 = table(chilo_master$acceptedName)
chilotab2 = as.data.frame.table(chilotab2)
chilotab2

```




#
# Diplopoda
###Diplo Step 1. Download Packages *above* and Import Data


```{r data}
diplo_inat <- read_csv("diplopoda/diplo_inat.csv")
diplo_lacm <- read_csv("diplopoda/diplo_lacm.csv")
diplo_chis <- read_csv("diplopoda/diplo_chis.csv")

```

###Diplo Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
diplo_inat_combine <- diplo_inat %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName)

diplo_chis_combine <- diplo_chis %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName)

diplo_lacm_combine <- diplo_lacm %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName)


diplo_master = rbind(diplo_inat_combine, diplo_chis_combine, diplo_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "Santa Cruz", "Anacapa", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order = "acceptedOrder")

```

###Diplo Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
diplo_master$month <- as.factor(diplo_master$island)
diplo_master$source <- as.factor(diplo_master$source)

diplo_islandsum <- diplo_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))

island_size = read_csv("island_size.csv")
diplo_islandsum2 = merge(diplo_islandsum, island_size, by="island", all.y=TRUE)

diplo_island <- ggplot(data = diplo_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Diplopoda Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,15), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

diplo_island 

ggsave(plot=diplo_island, filename="diplopoda/DiplopodaGraphs/diplo_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
diplo_islandsum2 = merge(diplo_islandsum, island_size, by="island", all.y=TRUE)
diplo_islandprop = diplo_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

diplo_island_prop <- ggplot(data = diplo_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Diplopoda Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,4), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

diplo_island_prop 

ggsave(plot=diplo_island_prop, filename="diplopoda/DiplopodaGraphs/diplo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
diplo_year = ggplot(diplo_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 30)) + 
  scale_x_continuous(limits=c(1925, 2025),   breaks=c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025)) + 
  labs(x="Year", y ="Number of Diplopoda Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

diplo_year

ggsave(plot=diplo_year, filename="diplopoda/DiplopodaGraphs/diplo_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
diplo_month <- na.omit(subset(diplo_master, select = c(island, month)))
diplo_month$month2 <-as.factor(diplo_month$month)


diplo_ismonth <- ggplot(diplo_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Diplopoda Sampling per Island by Month", y ="Number of Specimens Sampled", fill="month") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

diplo_ismonth 

ggsave(plot=diplo_ismonth, filename="diplopoda/DiplopodaGraphs/diplo_seasonal.png", height=4.5, width=9, units="in", dpi=300)

```

###Diplo Step 4. Make Tables 
```{r Family by Source Table}
diplotab = table(diplo_master$acceptedFamily)
diplotab = as.data.frame.table(diplotab)
write.csv(diplotab, "diplopoda/DiplopodaGraphs/diplo_table.csv")

# include BOLD? so few 

table(diplo_chis_combine$acceptedFamily)
table(diplo_lacm_combine$acceptedFamily)
table(diplo_inat_combine$acceptedFamily)



```

```{r Source Resolution}
ddply(dip_master_bold, "source", summarise, n = length(unique(acceptedFamily)))

ddply(dip_master_bold, "source", summarise, n = length(acceptedFamily))
ddply(dip_master_bold, "source", summarise, n = length(acceptedGenus))
ddply(dip_master_bold, "source", summarise, n = length(acceptedName))

```


#
# Blattodea
###Bla Step 1. Download Packages *above* and Import Data
```{r data}
bla_inat <- read_csv("blattodea/bla_inat.csv")
bla_chis <- read_csv("blattodea/bla_chis.csv")
```
###Bla Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
bla_inat_combine <- bla_inat %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

bla_chis_combine <- bla_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude") %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)


bla_master = rbind(bla_inat_combine, bla_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order = "acceptedOrder")

```

###Bla Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

bla_islandsum <- bla_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))

island_size = read_csv("island_size.csv")
bla_islandsum2 = merge(bla_islandsum, island_size, by="island", all.y=TRUE)

bla_island <- ggplot(data = bla_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Blattodea Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,10), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

bla_island 

ggsave(plot=bla_island, filename="blattodea/BlattodeaGraphs/bla_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
bla_islandsum2 = merge(bla_islandsum, island_size, by="island", all.y=TRUE)
bla_islandprop = bla_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

bla_island_prop <- ggplot(data = bla_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Blattodea Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,0.25), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

bla_island_prop 

ggsave(plot=bla_island_prop, filename="blattodea/BlattodeaGraphs/bla_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
bla_year = ggplot(bla_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 12)) + 
  scale_x_continuous(limits=c(1928, 2025),   breaks=c(1930, 1977, 2020)) + 
  labs(x="Year", y ="Number of Blattodea Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

bla_year

ggsave(plot=bla_year, filename="blattodea/BlattodeaGraphs/bla_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
bla_month <- na.omit(subset(bla_master, select = c(island, month)))
bla_month$month2 <-as.factor(bla_month$month)


bla_ismonth <- ggplot(bla_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Blattodea Sampling per Island by Month", y ="Number of Specimens Sampled", fill="month") +  
  facet_wrap(vars(island), nrow=1, scales="free_y")

bla_ismonth 

ggsave(plot=bla_ismonth, filename="blattodea/BlattodeaGraphs/bla_seasonal.png", height=2.4, width=9, units="in", dpi=300)

```

###Bla Step 4. Make Tables 
```{r Family by Source Table}
blatab = table(bla_master$acceptedFamily)
diplotab = as.data.frame.table(diplotab)
write.csv(diplotab, "diplopoda/DiplopodaGraphs/diplo_table.csv")



table(bla_chis_combine$acceptedFamily)
table(bla_inat_combine$acceptedFamily)
```

#
# Odonanta
###Odo Step 1. Download Packages *above* and Import Data

```{r data}
odo_inat <- read_csv("odonata/odo_inat.csv")
odo_chis <- read_csv("odonata/odo_chis.csv")
```

###Odo Step 2. Combine datasets 
```{r selecting and combining}
odo_inat_combine <- odo_inat %>%
  rename(order="acceptedOrder") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

odo_chis_combine <- odo_chis %>%
  rename(order = "order_", latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)


odo_master = rbind(odo_inat_combine, odo_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```

###Odo Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

odo_islandsum <- odo_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 
odo_islandsum <- na.omit(subset(odo_islandsum, select = c(island, samples, source)))

odo_island <- ggplot(data = odo_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(x ="Number of Phasmidae Sampled", 
       y = "Island",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,150), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

odo_island 

ggsave(plot=odo_island, filename="odonata/OdonataGraphs/odo_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
odo_islandsum2 = merge(odo_islandsum, island_size, by="island", all.y=TRUE)
odo_islandprop = odo_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

odo_island_prop <- ggplot(data = odo_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Odonata Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1.25), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

odo_island_prop 

ggsave(plot=odo_island_prop, filename="odonata/OdonataGraphs/odo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
odo_year = ggplot(odo_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 50)) + 
  scale_x_continuous(limits=c(1910, 2025),   breaks=c(1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Odonata Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

odo_year

ggsave(plot=odo_year, filename="odonata/OdonataGraphs/odo_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 

odo_month <- na.omit(subset(odo_master, select = c(island, month)))
odo_month$month2 <-as.factor(odo_month$month)


odo_ismonth <- ggplot(odo_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Odonata Sampling per Island by Month", y ="Number of Specimens Sampled", fill="month") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")


odo_ismonth 

ggsave(plot=odo_ismonth, filename="odonata/OdonataGraphs/odo_seasonal.png", height=4.5, width=9, units="in", dpi=300)

```

###Odo Step 4. Make Tables 
```{r Family by Source Table}
odotab = table(odo_master$acceptedFamily)
odotab = as.data.frame.table(odotab)
write.csv(odotab, "odonata/OdonataGraphs/odo_table.csv")

table(odo_chis_combine$acceptedFamily)
table(odo_inat_combine$acceptedFamily)

#unique name list 
odotab2 = table(odo_master$acceptedName)
odotab2 = as.data.frame.table(odotab2)
write.csv(odotab2, "odonata/OdonataGraphs/odo_table2.csv")
```
#
# Phasmida
###Phas Step 1. Download Packages *above* and Import Data

```{r data}
phas_inat <- read_csv("phasmida/phas_inat.csv")
phas_chis <- read_csv("phasmida/phas_chis.csv")
```

###Phas Step 2. Combine datasets 
```{r selecting and combining}
phas_inat_combine <- phas_inat %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

phas_chis_combine <- phas_chis %>%
  rename(order = "order_", latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)


phas_master = rbind(phas_inat_combine, phas_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```

###Phas Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

phas_islandsum <- phas_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 
phas_islandsum <- na.omit(subset(phas_islandsum, select = c(island, samples, source)))

phas_island <- ggplot(data = phas_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(x ="Number of Phasmida Specimens Sampled", 
       y = "Island",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,8), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

phas_island 

ggsave(plot=phas_island, filename="phasmida/PhasmidaGraphs/phas_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
phas_islandsum2 = merge(phas_islandsum, island_size, by="island", all.y=TRUE)
phas_islandprop = phas_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

phas_island_prop <- ggplot(data = phas_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Phasmida Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

phas_island_prop 

ggsave(plot=phas_island_prop, filename="phasmida/PhasmidaGraphs/odo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
phas_year = ggplot(phas_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 5)) + 
  scale_x_continuous(limits=c(1930, 2025),   breaks=c(1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Phasmida Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

phas_year

ggsave(plot=phas_year, filename="phasmida/PhasmidaGraphs/phas_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
phas_month <- na.omit(subset(phas_master, select = c(island, month)))
phas_month$month2 <-as.factor(phas_month$month)

phas_ismonth <- ggplot(phas_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Phasmida Sampling per Island by Month", y ="Number of Specimens Sampled", fill="month") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

phas_ismonth 

ggsave(plot=phas_ismonth, filename="phasmida/PhasmidaGraphs/phas_seasonal.png", height=2.25, width=4, units="in", dpi=300)

```

###Phas Step 4. Make Tables 
```{r Family by Source Table}
write.csv(phas_master, "phasmida/PhasmidaGraphs/phas_master.csv")

```
#
#Coleoptera
### Col Step 1. Download Packages *above* and Import Data
```{r setup}

col_inat <- read_csv("coleoptera/col_inat.csv")
col_lacm <- read_csv("coleoptera/col_lacm.csv")
col_chis <- read_csv("coleoptera/col_chis.csv")

col_inat_date <- read_csv("coleoptera/col_inat_date.csv")

col_inat_fix <- col_inat_date %>%
  select(id, year, month)
col_inat2 <- left_join(col_inat, col_inat_fix)
```


### Col Step 2. Combine datasets HUGE ERROR, no dates in iNat data...
```{r Selecting columns and combining}
col_inat_combine <- col_inat2 %>%
  rename(order="taxon_orde") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

col_chis_combine <- col_chis %>%
  rename(order ="order_", latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

col_lacm_combine <- col_lacm %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

col_lacm_combine <- col_lacm %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

col_coordinates = rbind(col_inat_combine, col_chis_combine)
col_combo <- col_coordinates %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

col_master = rbind(col_combo, col_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```

###Col Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

col_islandsum <- na.omit(subset(col_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 

col_island <- ggplot(data = col_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Coleoptera Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,5000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

col_island 

ggsave(plot=col_island, filename="coleoptera/ColeopteraGraphs/col_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
col_islandsum2 = merge(col_islandsum, island_size, by="island", all.y=TRUE)
col_islandprop = col_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

col_island_prop <- ggplot(data = col_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Coleoptera Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,260), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

col_island_prop 

ggsave(plot=col_island_prop, filename="coleoptera/ColeopteraGraphs/col_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
col_year = ggplot(col_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 8000)) + 
  scale_x_continuous(limits=c(1890, 2025), breaks=c(1890, 1900, 1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Coleoptera Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

col_year

ggsave(plot=col_year, filename="coleoptera/ColeopteraGraphs/col_year.png", height=5, width=9, units="in", dpi=300)

#logging it bc such a heavy skew
col_yeargraph2 = ggplot(col_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(trans='log10', expand=c(0,0)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1890, 2025), breaks=c(1890, 1900, 1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Log Transformed Number of Coleoptera Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

col_yeargraph2

ggsave(plot=col_yeargraph2, filename="coleoptera/ColeopteraGraphs/col_year2.png", height=4.5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
col_master$month <- as.factor(col_master$month)
col_month <- na.omit(subset(col_master, select = c(island, month)))


col_ismonth <- ggplot(col_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Coleoptera Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

col_ismonth 

ggsave(plot=col_ismonth, filename="coleoptera/ColeopteraGraphs/col_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Dip Step 4. Make Tables 
```{r Family by Source Table}
coltab= table(col_master$acceptedFamily)
coltab = as.data.frame.table(coltab)

coltab_inat = table(col_inat$acceptedFamily)
coltab_inat = as.data.frame.table(coltab_inat)
coltab_inat <- coltab_inat %>%
  rename(iNaturalist = "Freq") 

coltab_chis = table(col_chis$acceptedFamily)
coltab_chis = as.data.frame.table(coltab_chis)
coltab_chis <- coltab_chis %>%
  rename(CalIBIS = "Freq") 

coltab_lacm = table(col_lacm$acceptedFamily)
coltab_lacm = as.data.frame.table(coltab_lacm)
coltab_lacm <- coltab_lacm %>%
  rename(LACM = "Freq") 

col_table <- left_join(coltab, coltab_inat)
col_table2 <- left_join(col_table, coltab_chis)
col_table3 <- left_join(col_table2, coltab_lacm)

col_table_complete <-col_table3 %>%
  rename(Sum = "Freq", Family = "Var1")

col_table_complete2 <- col_table_complete %>%
  relocate("Family", "CalIBIS", "iNaturalist", "LACM", "Sum") %>%
  mutate(Percentage = (Sum/20925))


write.csv(col_table_complete2, "coleoptera/ColeopteraGraphs/col_table_complete.csv", na="0")
write.csv(col_master, "coleoptera/col_master.csv", na="")


```

```{r Source Resolution}
ddply(dip_master_bold, "source", summarise, n = length(unique(acceptedFamily)))

ddply(dip_master_bold, "source", summarise, n = length(acceptedFamily))
ddply(dip_master_bold, "source", summarise, n = length(acceptedGenus))
ddply(dip_master_bold, "source", summarise, n = length(acceptedName))

```
#
#Lepidoptera
### Lep Step 1. Download Packages *above* and Import Data
```{r setup}

lep_inat <- read_csv("lepidoptera/lep_inat.csv")
lep_lacm <- read_csv("lepidoptera/lep_lacm.csv")
lep_chis <- read_csv("lepidoptera/lep_chis.csv")


```


### Lep Step 2. Combine datasets HUGE ERROR, no dates in iNat data...
```{r Selecting columns and combining}
lep_inat_combine <- lep_inat %>%
  rename(order="taxon_order_name") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

lep_chis_combine <- lep_chis %>%
  rename(order = "order_", latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

lep_lacm_combine <- lep_lacm %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

lep_coordinates = rbind(lep_inat_combine, lep_chis_combine)
lep_combo <- lep_coordinates %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName)

lep_master = rbind(lep_combo, lep_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```

###Lep Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

lep_islandsum <- na.omit(subset(lep_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 


lep_island <- ggplot(data = lep_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Lepidoptera Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,4000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

lep_island 

ggsave(plot=lep_island, filename="lepidoptera/LepidopteraGraphs/lep_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
lep_islandsum2 = merge(lep_islandsum, island_size, by="island", all.y=TRUE)
lep_islandprop = lep_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

lep_island_propgraph <- ggplot(data = lep_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Lepidoptera Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,150), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

lep_island_propgraph 

ggsave(plot=lep_island_propgraph, filename="lepidoptera/LepidopteraGraphs/lep_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
lep_year <- na.omit(subset(lep_master, select = c(island, year, month, source)))
lep_yeargraph = ggplot(lep_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 1750)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1905, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Lepidoptera Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

lep_yeargraph

ggsave(plot=lep_yeargraph, filename="lepidoptera/LepidopteraGraphs/lep_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
lep_year$month <- as.factor(lep_year$month)

lep_ismonth <- ggplot(lep_year, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Lepidoptera Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

lep_ismonth 

ggsave(plot=lep_ismonth, filename="lepidoptera/LepidopteraGraphs/lep_seasonal.png", height=4.5, width=9, units="in", dpi=300)

```

###Lep Step 4. Make Tables 
```{r Family by Source Table}
leptab= table(lep_master$acceptedFamily)
leptab = as.data.frame.table(leptab)
write.csv(leptab, "lepidoptera/LepidopteraGraphs/lep_table.csv")

leptab_inat = table(lep_inat$acceptedFamily)
leptab_inat = as.data.frame.table(leptab_inat)
leptab_inat <- leptab_inat %>%
  rename(iNaturalist = "Freq") 

leptab_chis = table(lep_chis$acceptedFamily)
leptab_chis = as.data.frame.table(leptab_chis)
leptab_chis <- leptab_chis %>%
  rename(CalIBIS = "Freq") 

leptab_lacm = table(lep_lacm$acceptedFamily)
leptab_lacm = as.data.frame.table(leptab_lacm)
leptab_lacm <- leptab_lacm %>%
  rename(LACM = "Freq") 

lep_table <- left_join(leptab, leptab_inat)
lep_table2 <- left_join(lep_table, leptab_chis)
lep_table3 <- left_join(lep_table2, leptab_lacm)

lep_table_complete <-lep_table3 %>%
  rename(Sum = "Freq", Family = "Var1")

lep_fam = read_csv("lepidoptera/lep_families.csv")
lep_table_complete2 <- left_join(lep_table_complete, lep_fam) 

lep_table_complete2 <- lep_table_complete2 %>%
  relocate("iconic", "Family", "CalIBIS", "iNaturalist", "LACM", "Sum") %>%
  mutate(Percentage = (Sum/9392))


write.csv(lep_table_complete2, "lepidoptera/LepidopteraGraphs/lep_table_complete.csv", na="0")
write.csv(lep_master, "lepidoptera/lep_master.csv", na="")
```
#
#Arachnida 
#### Arac Step1. Download Packages *above* and Import Data
```{r setup}
arac_inat <- read_csv("arachnida/arac_inat.csv")
arac_lacm <- read_csv("arachnida/arac_lacm.csv")
arac_chis <- read_csv("arachnida/arac_chis.csv")
```


### Arac Step 2. Combine datasets BY CLASS not ORDER (Note for total combine data for KHL)
```{r Selecting columns and combining}
arac_inat_combine <- arac_inat %>%
  rename(class="iconic_taxon_name") %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

arac_chis_combine <- arac_chis %>%
  rename(order="order_", latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude) 


arac_lacm_combine <- arac_lacm %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName)

arac_coordinates = rbind(arac_inat_combine, arac_chis_combine)
arac_coordinates[arac_coordinates == 0] <- NA
arac_combo <- arac_coordinates %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName)

arac_master = rbind(arac_combo, arac_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

#some base R script to get rid of the silly 0 months, years and lat/long (done above to coord data)
arac_master[arac_master == 0] <- NA


```

###Arac Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

arac_islandsum <- na.omit(subset(arac_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 


arac_island <- ggplot(data = arac_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Arachnida Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,600), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

arac_island 

ggsave(plot=arac_island, filename="arachnida/ArachnidaGraphs/arac_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
arac_islandsum2 = merge(arac_islandsum, island_size, by="island", all.y=TRUE)
arac_islandprop = arac_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

arac_island_propgraph <- ggplot(data = arac_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Arachnida Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,12), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

arac_island_propgraph 

ggsave(plot=arac_island_propgraph, filename="arachnida/ArachnidaGraphs/arac_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}

arac_year <- na.omit(subset(arac_master, select = c(island, year, month, source)))
arac_yeargraph = ggplot(arac_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 550)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1905, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Arachnida Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

arac_yeargraph

ggsave(plot=lep_yeargraph, filename="lepidoptera/LepidopteraGraphs/lep_year.png", height=5, width=9, units="in", dpi=300)

#logging it bc such a heavy skew
arac_yeargraph2 = ggplot(arac_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(trans='log10', expand=c(0,0)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1905, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Log Transformed Number of Arachnida Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

arac_yeargraph2

ggsave(plot=arac_yeargraph2, filename="arachnida/ArachnidaGraphs/arac_year2.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
arac_year$month <- as.factor(arac_year$month)

arac_ismonth <- ggplot(arac_year, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Arachnida Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

arac_ismonth 

ggsave(plot=arac_ismonth, filename="arachnida/ArachnidaGraphs/arac_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Arac Step 4. Make Tables 
```{r Family by Source Table}
#not using LACM single Scorpion to order in this table so using arac_combo instead of arac_master
aractab= table(arac_combo$acceptedFamily)
aractab = as.data.frame.table(aractab)

aractab_inat = table(arac_inat$acceptedFamily)
aractab_inat = as.data.frame.table(aractab_inat)
aractab_inat <- aractab_inat %>%
  rename(iNaturalist = "Freq") 

aractab_chis = table(arac_chis$acceptedFamily)
aractab_chis = as.data.frame.table(aractab_chis)
aractab_chis <- aractab_chis %>%
  rename(CalIBIS = "Freq") 

arac_table <- left_join(aractab, aractab_inat)
arac_table2 <- left_join(arac_table, aractab_chis)

arac_table_complete <-arac_table2 %>%
  rename(Sum = "Freq", Family = "Var1")

arac_table_complete <- arac_table_complete %>%
  mutate(Percentage = (Sum/1333))

#this is me trying to add order to the table as well (can be used to add higher rankings to other tables!)
arac_combo2 <- arac_combo %>% 
  rename(Family="acceptedFamily", Order = "order") %>%
  select(Family, Order)
arac_combo3 <- distinct(arac_combo2, Family, .keep_all = TRUE)

arac_table_worder <- left_join(arac_table_complete, arac_combo3)


write.csv(arac_table_worder, "arachnida/ArachnidaGraphs/arac_table_complete.csv", na="0")
```