---
title: "Vert Code"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

This is an R Markdown for the Gap Analysis Vertebrate Graph and Table Making. Based on the Invertebrate code. Geographic, Temporal and Seasonal gaps are addressed with graphs. 

Mammals, Reptiles, Amphibians are included. Birds have a separate markdown.

#Mammals

##Mam Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r}
mam_inat <- read_csv("mammal/mam_inat.csv")

mam_chis <- read_csv("mammal/mam_chis.csv")

mam_polecat <- read_csv("mammal/mam_polecat.csv")

```


##Mam Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
mam_inat_combine <- mam_inat %>%
  rename(class="iconic_tax", scientificName = "scientific") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)
  
mam_chis_combine <- mam_chis %>%
  rename(latitude = "decimalLatitude", longitude = "decimalLongitude") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

mam_polecat_combine <- mam_polecat %>%
  rename(latitude = "decimalLatitude", longitude = "decimalLongitude") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)


mam_master = rbind(mam_inat_combine, mam_chis_combine, mam_polecat_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```

```{r heat map}
mam_inat_map <- mam_inat %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

mam_chis_map <- mam_inat %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

mam_map = rbind(mam_inat_map, mam_chis_map)

```

##Mam Step. 3 Make Graphs! 

### Island Graph 
```{r Graphing by island}
mam_islandsum <- mam_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
mam_islandsum <- na.omit(subset(mam_islandsum, select = c(island, samples, source)))

mam_island <- ggplot(data = mam_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Mammal Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1200), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mam_island 

ggsave(plot=mam_island, filename="mammal/MammalGraphs/mam_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
mam_islandsum2 = merge(mam_islandsum, island_size, by="island", all.y=TRUE)
mam_islandprop = mam_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

mam_island_prop <- ggplot(data = mam_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Mammal Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,275), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mam_island_prop 

ggsave(plot=mam_island_prop, filename="mammal/MammalGraphs/mam_island_prop.png", height=5, width=8, units="in", dpi=300)
```


### Temporal Graph
```{r Graphing by year}


mam_year = ggplot(mam_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 900)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1885, 2020), breaks=c(1885, 1900, 1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Mammal Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

mam_year

ggsave(plot=mam_year, filename="mammal/MammalGraphs/mam_year.png", height=5, width=9, units="in", dpi=300)

```

###Seasonal Graph 

```{r Graphing by month}
# by month and island 
mam_master$month <- as.factor(mam_master$month)
mam_month <- na.omit(subset(mam_master, select = c(island, month)))


mam_ismonth <- ggplot(mam_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Mammal Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

mam_ismonth 

ggsave(plot=mam_ismonth, filename="mammal/MammalGraphs/mam_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Mammal Collection Type}
mam_chis2 <- na.omit(subset(mam_chis, select = c(CollectionType, island, acceptedName))) 
                     
mam_coll <- ggplot(mam_chis2, aes(x=CollectionType, fill=CollectionType)) + geom_bar() + theme_bw() + theme(legend.position = "none") + theme(axis.text.x = element_text(angle =90)) + labs(x="Collection Type", y="Number of Mammal Specimens")

mam_coll
ggsave(plot=mam_coll, filename="mammal/MammalGraphs/mam_type.png", height=5, width=8, units="in", dpi=300)
```


##Mam Step 4. Make Tables 
```{r Family by Source Table}
mamtab = table(mam_master$acceptedName)
mamtab = as.data.frame.table(mamtab)
write.csv(mamtab, "mammal/MammalGraphs/mam_table2.csv")
write.csv(mam_chis_combine, "mammal/MammalGraphs/mam_chis_clean.csv")

table(mam_chis_combine$acceptedName)

table(mam_chis_combine$order)


table(mam_inat_combine$acceptedName)


mamtab= table(mam_master$acceptedName)
mamtab = as.data.frame.table(mamtab) 
mamtab2 = mamtab %>%
  rename(acceptedName = "Var1", total = "Freq")

mam_master2 = mam_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName)

mamtable = left_join(mamtab2, mam_master2 )
mamtable = distinct(mamtable)

mamtab_inat = table(mam_inat$acceptedName)
mamtab_inat = as.data.frame.table(mamtab_inat) %>%
  rename(iNaturalist = "Freq", acceptedName = "Var1")

mamtab_chis = table(mam_chis$acceptedName)
mamtab_chis = as.data.frame.table(mamtab_chis) %>%
  rename(CalIBIS = "Freq", acceptedName = "Var1") 

mam_table <- left_join(mamtable, mamtab_chis)
mam_table2 <- left_join(mam_table, mamtab_inat)

mam_table_complete <-mam_table2 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus") %>%
  relocate("Family", "Genus", "Species", "CalIBIS", "iNaturalist", "total")

write.csv(mam_table_complete, "mammal/MammalGraphs/mam_table_complete.csv", na="0")



```

#
#Reptiles 

##Rep Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r}
rep_inat <- read_csv("reptile/rep_inat.csv")

rep_chis <- read_csv("reptile/rep_chis.csv")

```


##Rep Step 2. Combine datasets. Lat and Long included. 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
rep_inat_combine <- rep_inat %>%
  rename(class="iconic_tax") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

rep_chis_combine <- rep_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude") %>%
  select(source_1, month, year, island_2, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude) %>%
  rename(island="island_2", source = "source_1")


rep_master = rbind(rep_inat_combine, rep_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```


##Rep Step. 3 Make Graphs! 

### Island Graph 
```{r Graphing by island}
rep_islandsum <- rep_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
rep_islandsum <- na.omit(subset(rep_islandsum, select = c(island, samples, source)))

rep_island <- ggplot(data = rep_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Reptile Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,2700), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

rep_island 

ggsave(plot=rep_island, filename="reptile/ReptileGraphs/rep_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
rep_islandsum2 = merge(rep_islandsum, island_size, by="island", all.y=TRUE)
rep_islandprop = rep_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

rep_island_prop <- ggplot(data = rep_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Reptile Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,50), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

rep_island_prop 

ggsave(plot=rep_island_prop, filename="reptile/ReptileGraphs/rep_island_prop.png", height=5, width=8, units="in", dpi=300)
```


### Temporal Graph
```{r Graphing by year}
rep_year <- na.omit(subset(rep_master, select = c(island, year, source)))
rep_year = ggplot(rep_year, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 500)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1852, 2022), breaks=c(1855, 1870, 1885, 1900, 1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Reptile Data Points") +   scale_fill_brewer(palette = "Dark2")

rep_year

ggsave(plot=rep_year, filename="reptile/ReptileGraphs/rep_year.png", height=5, width=9, units="in", dpi=300)

```

###Seasonal Graph 

```{r Graphing by month}
# by month and island 
rep_master$month <- as.factor(rep_master$month)
rep_month <- na.omit(subset(rep_master, select = c(island, month)))


rep_ismonth <- ggplot(rep_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Reptile Data Points per Island by Month", y ="Number of Reptile Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

rep_ismonth 

ggsave(plot=rep_ismonth, filename="reptile/ReptileGraphs/rep_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Reptile Collection Type}
rep_coll <-na.omit(subset(rep_chis, select=c(island_2, year, collectionType, order_, acceptedFamily, acceptedGenus, acceptedName)))
rep_collgraph <- ggplot(rep_coll, aes(x=collectionType, fill=collectionType)) + geom_bar() + theme_bw() + theme(legend.position = "none") + labs(x="Collection Type", y="Number of Reptile Specimens") + scale_y_continuous(expand=expansion(mult=c(0,0.05)))

rep_collgraph
ggsave(plot=rep_collgraph, filename="reptile/ReptileGraphs/rep_type.png", height=5, width=8, units="in", dpi=300)
```


##Rep Step 4. Make Tables 
```{r Family by Source Table}
write.csv(rep_master, "reptile/rep_master.csv")
reptab = table(rep_master$acceptedName)
reptab = as.data.frame.table(reptab)
write.csv(reptab, "reptile/ReptileGraphs/rep_table.csv")


table(rep_chis_combine$acceptedName)


table(rep_inat_combine$acceptedName)



```



#
#Amphibians 
##Amph Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r Datasets}
amph_inat <- read_csv("amphibian/amph_inat.csv")

amph_chis <- read_csv("amphibian/amph_chis.csv")

```


##Amph Step 2. Combine datasets. Lat and Long included. 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
amph_inat_combine <- amph_inat %>%
  rename(class="iconic_tax") %>%
  select(source, month, year, island, class, acceptedGenus, acceptedName, latitude, longitude)

amph_chis_combine <- amph_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", month="month_", year="year_") %>%
  select( month, year, island...128, class, acceptedGenus, acceptedName, latitude, longitude) %>%
  rename(island = "island...128") %>%
  add_column(source="Cal-IBIS")


amph_master = rbind(amph_inat_combine, amph_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```


##Amph Step. 3 Make Graphs! 

### Island Graph 
```{r Graphing by island}

amph_islandsum <- amph_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))

island_size = read_csv("island_size.csv")
amph_islandsum2 = merge(amph_islandsum, island_size, by="island", all.y=TRUE)

amph_islandsum2$source[is.na(amph_islandsum2$source)] <- "Cal-IBIS"

amph_island <- ggplot(data = amph_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Amphibian Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,2500), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

amph_island 

ggsave(plot=amph_island, filename="amphibian/AmphibianGraphs/amph_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
amph_islandsum2 = merge(amph_islandsum, island_size, by="island", all.y=TRUE)
amph_islandprop2 = amph_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)
amph_islandprop2$source[is.na(amph_islandprop2$source)] <- "Cal-IBIS"

amph_island_prop <- ggplot(data = amph_islandprop2, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Amphibian Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,70), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

amph_island_prop 

ggsave(plot=amph_island_prop, filename="amphibian/AmphibianGraphs/amph_island_prop.png", height=5, width=8, units="in", dpi=300)
```


### Temporal Graph
```{r Graphing by year}
amph_year = amph_master %>%
  select(year, source, acceptedName)
amph_year$source[is.na(amph_year$source)] <- "Cal-IBIS"
amph_yearplot = ggplot(amph_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 1100)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1870, 2022), breaks=c(1875, 1900, 1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Amphibian Data Points") +   scale_fill_brewer(palette = "Dark2")

amph_yearplot

ggsave(plot=amph_yearplot, filename="amphibian/AmphibianGraphs/amph_year.png", height=5, width=9, units="in", dpi=300)

```

###Seasonal Graph 

```{r Graphing by month}
# by month and island 
amph_master$month <- as.factor(amph_master$month)
amph_month <- na.omit(subset(amph_master, select = c(island, month)))


amph_ismonth = ggplot(amph_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Amphibian Data Points per Island by Month", y ="Number of Amphibian Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

amph_ismonth 

ggsave(plot=amph_ismonth, filename="amphibian/AmphibianGraphs/amph_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Reptile Collection Type}
amph_coll <-na.omit(subset(amph_chis, select=c(collectionType, order_, acceptedGenus, acceptedName)))
amph_collgraph <- ggplot(amph_coll, aes(x=collectionType, fill=collectionType)) + geom_bar() + theme_bw() + theme(legend.position = "none") + labs(x="Collection Type", y="Number of Amphibian Specimens") + scale_y_continuous(expand=expansion(mult=c(0,0.05)))

amph_collgraph
ggsave(plot=amph_collgraph, filename="amphibian/AmphibianGraphs/amph_type.png", height=5, width=8, units="in", dpi=300)
```


##Amph Step 4. Make Tables 
```{r Family by Source Table}

amphtab = table(amph_master$acceptedName)
amphtab = as.data.frame.table(amphtab)
write.csv(amphtab, "amphibian/AmphibianGraphs/amph_table.csv")


table(amph_chis_combine$acceptedName)


table(amph_inat_combine$acceptedName)



```



