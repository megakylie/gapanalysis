---
title: "Vert Code"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

This is an R Markdown for the Gap Analysis Vertabrate Graph and Table Making. Based on the Invertabrate code. Geographic, Temporal and Seasonal gaps are addressed with graphs. 

Mammals, Reptiles, Amphibians, and Birds are included. 

#Mammals

##Mam Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r}
mam_inat <- read_csv("mammal/mam_inat.csv")

mam_chis <- read_csv("mammal/mam_chis.csv")

```


##Mam Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
mam_inat_combine <- mam_inat %>%
  rename(class="iconic_tax") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName)

mam_chis_combine <- mam_chis %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName)


mam_master = rbind(mam_inat_combine, mam_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```

```{r heat map}
mam_inat_map <- mam_inat %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

mam_chis_map <- mam_inat %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

mam_map = rbind(mam_inat_map, mam_chis_map)

```

##Mam Step. 3 Make Graphs! 

### Island Graph 
```{r Graphing by island}

mam_islandsum <- mam_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
mam_islandsum <- na.omit(subset(mam_islandsum, select = c(island, samples, source)))

mam_island <- ggplot(data = mam_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Mammal Specimens Sampled",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1200), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mam_island 

ggsave(plot=mam_island, filename="mammal/MammalGraphs/mam_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
mam_islandsum2 = merge(mam_islandsum, island_size, by="island", all.y=TRUE)
mam_islandprop = mam_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

mam_island_prop <- ggplot(data = mam_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Mammal Specimens Sampled/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,275), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mam_island_prop 

ggsave(plot=mam_island_prop, filename="mammal/MammalGraphs/mam_island_prop.png", height=5, width=8, units="in", dpi=300)
```


### Temporal Graph
```{r Graphing by year}


mam_year = ggplot(mam_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 900)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1885, 2020), breaks=c(1885, 1900, 1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Mammal Specimens Sampled") +   scale_fill_brewer(palette = "Dark2")

mam_year

ggsave(plot=mam_year, filename="mammal/MammalGraphs/mam_year.png", height=5, width=9, units="in", dpi=300)

```

###Seasonal Graph 

```{r Graphing by month}
# by month and island 
mam_master$month <- as.factor(mam_master$month)
mam_month <- na.omit(subset(mam_master, select = c(island, month)))


mam_ismonth <- ggplot(mam_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Mammal Sampling per Island by Month", y ="Number of Specimens Sampled") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

mam_ismonth 

ggsave(plot=mam_ismonth, filename="mammal/MammalGraphs/mam_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Mammal Collection Type}
mam_chis2 <- na.omit(subset(mam_chis, select = c(CollectionType, island, acceptedName))) 
                     
mam_coll <- ggplot(mam_chis2, aes(x=CollectionType, fill=CollectionType)) + geom_bar() + theme_bw() + theme(legend.position = "none") + theme(axis.text.x = element_text(angle =90)) + labs(x="Collection Type", y="Number of Mammal Specimens")

mam_coll
ggsave(plot=mam_coll, filename="mammal/MammalGraphs/mam_type.png", height=5, width=8, units="in", dpi=300)
```


##Mam Step 4. Make Tables 
```{r Family by Source Table}
mamtab = table(mam_master$acceptedName)
mamtab = as.data.frame.table(mamtab)
write.csv(mamtab, "mammal/MammalGraphs/mam_table2.csv")
write.csv(mam_chis_combine, "mammal/MammalGraphs/mam_chis_clean.csv")

table(mam_chis_combine$acceptedName)

table(mam_chis_combine$order)


table(mam_inat_combine$acceptedName)



```


#
#Reptiles 

##Rep Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r}
rep_inat <- read_csv("reptile/rep_inat.csv")

rep_chis <- read_csv("reptile/rep_chis.csv")

```


##Rep Step 2. Combine datasets. Lat and Long included. 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
rep_inat_combine <- rep_inat %>%
  rename(class="iconic_tax") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

rep_chis_combine <- rep_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude") %>%
  select(source_1, month, year, island_1, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude) %>%
  rename(island = "island_1", source = "source_1")


rep_master = rbind(rep_inat_combine, rep_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```


##Rep Step. 3 Make Graphs! 

### Island Graph 
```{r Graphing by island}

rep_islandsum <- rep_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
rep_islandsum <- na.omit(subset(rep_islandsum, select = c(island, samples, source)))

rep_island <- ggplot(data = rep_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Reptile Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,2700), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

rep_island 

ggsave(plot=rep_island, filename="reptile/ReptileGraphs/rep_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
rep_islandsum2 = merge(rep_islandsum, island_size, by="island", all.y=TRUE)
rep_islandprop = rep_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

rep_island_prop <- ggplot(data = rep_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Reptile Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,50), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

rep_island_prop 

ggsave(plot=rep_island_prop, filename="reptile/ReptileGraphs/rep_island_prop.png", height=5, width=8, units="in", dpi=300)
```


### Temporal Graph
```{r Graphing by year}
rep_year <- na.omit(subset(rep_master, select = c(island, year, source)))
rep_year = ggplot(rep_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 500)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1810, 2020), breaks=c(1818, 1840, 1855, 1870, 1885, 1900, 1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Reptile Data Points") +   scale_fill_brewer(palette = "Dark2")

rep_year

ggsave(plot=rep_year, filename="reptile/ReptileGraphs/rep_year.png", height=5, width=9, units="in", dpi=300)

```

###Seasonal Graph 

```{r Graphing by month}
# by month and island 
rep_master$month <- as.factor(rep_master$month)
rep_month <- na.omit(subset(rep_master, select = c(island, month)))


rep_ismonth <- ggplot(rep_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Reptile Data Points per Island by Month", y ="Number of Reptile Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

rep_ismonth 

ggsave(plot=rep_ismonth, filename="reptile/ReptileGraphs/rep_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Reptile Collection Type}
rep_coll <-na.omit(subset(rep_chis, select=c(island_1, year, collectionType, order_, acceptedFamily, acceptedGenus, acceptedName)))
rep_collgraph <- ggplot(rep_coll, aes(x=collectionType, fill=collectionType)) + geom_bar() + theme_bw() + theme(legend.position = "none") + labs(x="Collection Type", y="Number of Reptile Specimens")

rep_collgraph
ggsave(plot=rep_collgraph, filename="reptile/ReptileGraphs/rep_type.png", height=5, width=8, units="in", dpi=300)
```


##Rep Step 4. Make Tables 
```{r Family by Source Table}
write.csv(rep_master, "reptile/rep_master.csv")
reptab = table(rep_master$acceptedName)
reptab = as.data.frame.table(reptab)
write.csv(reptab, "reptile/ReptileGraphs/rep_table.csv")


table(rep_chis_combine$acceptedName)


table(rep_inat_combine$acceptedName)



```



#
#Amphibians 
##Amph Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r Datasets}
amph_inat <- read_csv("amphibian/amph_inat.csv")

amph_chis <- read_csv("amphibian/amph_chis.csv")

```


##Amph Step 2. Combine datasets. Lat and Long included. 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
amph_inat_combine <- amph_inat %>%
  rename(class="iconic_tax") %>%
  select(source, month, year, island, class, acceptedGenus, acceptedName, latitude, longitude)

amph_chis_combine <- amph_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", month="month_", year="year_") %>%
  select(source_1, month, year, island_1, class, acceptedGenus, acceptedName, latitude, longitude) %>%
  rename(island = "island_1", source = "source_1")


amph_master = rbind(amph_inat_combine, amph_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```


##Amph Step. 3 Make Graphs! 

### Island Graph 
```{r Graphing by island}

amph_islandsum <- amph_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
amph_islandsum <- na.omit(subset(amph_islandsum, select = c(island, samples, source)))
island_size = read_csv("island_size.csv")
amph_islandsum2 = merge(amph_islandsum, island_size, by="island", all.y=TRUE)

amph_island <- ggplot(data = amph_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Amphibian Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,2500), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

amph_island 

ggsave(plot=amph_island, filename="amphibian/AmphibianGraphs/amph_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
amph_islandsum2 = merge(amph_islandsum, island_size, by="island", all.y=TRUE)
amph_islandprop = amph_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

amph_island_prop <- ggplot(data = amph_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Amphibian Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,70), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

amph_island_prop 

ggsave(plot=amph_island_prop, filename="amphibian/AmphibianGraphs/amph_island_prop.png", height=5, width=8, units="in", dpi=300)
```


### Temporal Graph
```{r Graphing by year}
amph_year <- na.omit(subset(amph_master, select = c(island, year, source)))
amph_yearplot = ggplot(amph_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 1200)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1795, 2021), breaks=c(1800, 1818, 1875, 1900, 1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020)) + 
  labs(x="Year", y ="Number of Amphibian Data Points") +   scale_fill_brewer(palette = "Dark2")

amph_yearplot

ggsave(plot=amph_yearplot, filename="amphibian/AmphibianGraphs/amph_year.png", height=5, width=9, units="in", dpi=300)

```

###Seasonal Graph 

```{r Graphing by month}
# by month and island 
amph_master$month <- as.factor(amph_master$month)
amph_month <- na.omit(subset(amph_master, select = c(island, month)))


amph_ismonth <- ggplot(amph_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Amphibian Data Points per Island by Month", y ="Number of Amphibian Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

amph_ismonth 

ggsave(plot=amph_ismonth, filename="amphibian/AmphibianGraphs/amph_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Reptile Collection Type}
amph_coll <-na.omit(subset(amph_chis, select=c(collectionType, order_, acceptedGenus, acceptedName)))
amph_collgraph <- ggplot(amph_coll, aes(x=collectionType, fill=collectionType)) + geom_bar() + theme_bw() + theme(legend.position = "none") + labs(x="Collection Type", y="Number of Amphibian Specimens")

amph_collgraph
ggsave(plot=amph_collgraph, filename="amphibian/AmphibianGraphs/amph_type.png", height=5, width=8, units="in", dpi=300)
```


##Amph Step 4. Make Tables 
```{r Family by Source Table}

amphtab = table(amph_master$acceptedName)
amphtab = as.data.frame.table(amphtab)
write.csv(amphtab, "amphibian/AmphibianGraphs/amph_table.csv")


table(amph_chis_combine$acceptedName)


table(amph_inat_combine$acceptedName)



```

#
#Birds 
##Aves Step 1. Download Packages and Import Data
```{r setup}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r}
aves_inat <- read_csv("aves/aves_inat2.csv")
aves_ebird <- read_csv("aves/aves_ebird2.csv")
aves_chis <- read_csv("aves/aves_chis_090821.csv")
aves_sbmnh_obs <- read_csv("aves/aves_sbmnh_obs_090821.csv")
aves_sbmnh_col <- read_csv("aves/aves_sbmnh_col2_090821.csv")

```


##Aves Step 2. Combine datasets. Lat and Long included. 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
aves_inat_combine <- aves_inat %>%
  rename(class="iconic_tax", type="collectionType") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type)

aves_chis_combine <- aves_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", year="year_", month="month_", type="collectionType") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type)

aves_sbmnh_obs_combine <- aves_sbmnh_obs %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", type="collectionType") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type)

aves_sbmnh_col_combine <- aves_sbmnh_col %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", type="collectionType2") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type)

aves_ebird_combine <- aves_ebird %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", year="year_", month="month_", type = "collection Type") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type)
  
aves_master = rbind(aves_inat_combine, aves_chis_combine, aves_sbmnh_obs_combine, aves_sbmnh_col_combine, aves_ebird_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))
## 342351 records!!! 
```


##Aves Step. 3 Make Graphs! 

### Island Graph 
```{r Graphing by island}

aves_islandsum <- aves_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) %>%
filter(!is.na(island)) %>%
   ungroup() %>%
  mutate(source2 = fct_relevel(source, "Cal-IBIS", "iNaturalist", "EBIRD", "SBMNH Collections", "SBMNH Observations"))

aves_islandsum <- na.omit(subset(aves_islandsum, select = c(island, samples, source2)))

aves_island <- ggplot(data = aves_islandsum, aes(x = samples, y = fct_rev(island), fill = source2)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,121000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

aves_island 

ggsave(plot=aves_island, filename="aves/AvesGraphs/aves_island.png", height=5, width=8, units="in", dpi=300)

#by collection type
aves_master$type = as.character(aves_master$type)
aves_islandsumty <- aves_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, type) %>%
  summarise(samples = sum(no_sample)) %>%
filter(!is.na(island)) 
aves_islandsumty <- na.omit(subset(aves_islandsumty, select = c(island, samples, type)))

aves_islandtype <- ggplot(data = aves_islandsumty, aes(x = samples, y = fct_rev(island), fill = type)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points",
       fill = "Type") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,121000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Paired")

aves_islandtype
ggsave(plot=aves_islandtype, filename="aves/AvesGraphs/aves_island_type.png", height=5, width=8, units="in", dpi=300)


```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
aves_islandsum2 = merge(aves_islandsum, island_size, by="island", all.y=TRUE)
aves_islandprop = aves_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

aves_island_prop <- ggplot(data = aves_islandprop, aes(x = by_area, y = fct_rev(island), fill = source2)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,10000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

aves_island_prop 

ggsave(plot=aves_island_prop, filename="aves/AvesGraphs/aves_island_prop.png", height=5, width=8, units="in", dpi=300)

aves_islandsumty2 = merge(aves_islandsumty, island_size, by="island", all.y=TRUE)
aves_islandsumty_prop = aves_islandsumty2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

aves_island_prop_type <- ggplot(data = aves_islandsumty_prop, aes(x = by_area, y = fct_rev(island), fill = type)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points/Island Area (km^2)",
       fill = "Type") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,10000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Paired" )
aves_island_prop_type

ggsave(plot=aves_island_prop_type, filename="aves/AvesGraphs/aves_island_prop_type.png", height=5, width=8, units="in", dpi=300)

```


### Temporal Graph
```{r Graphing by year}
aves_year <- na.omit(subset(aves_master, select = c(island, year, source, type))) %>%
  mutate(source2 = fct_relevel(source, "Cal-IBIS", "iNaturalist", "EBIRD", "SBMNH Collections", "SBMNH Observations"))
aves_yeargraph = ggplot(aves_year, aes(x=year, fill=source2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 9000)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1810, 2022), breaks=c(1818, 1850, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + 
  labs(x="Year", y ="Number of Bird Data Points", fill="Data Source") +   scale_fill_brewer(palette = "Dark2")

aves_yeargraph

ggsave(plot=aves_yeargraph, filename="aves/AvesGraphs/aves_year.png", height=5, width=9, units="in", dpi=300)

aves_yeargraph2 = ggplot(aves_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(trans='log10', expand=c(0,0)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1810, 2022), breaks=c(1818, 1850, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + 
  labs(x="Year", y="Number of Bird Data Points (log scaled", fill="Type") +   scale_fill_brewer(palette = "Dark2")

aves_yeargraph2

ggsave(plot=aves_yeargraph2, filename="aves/AvesGraphs/aves_year2.png", height=5, width=9, units="in", dpi=300)

#collection type

aves_yeargraph3 = ggplot(aves_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() +   facet_wrap(vars(type), nrow=1, scales="free") +
  scale_y_continuous(expand=c(0,0)) + 
  scale_x_continuous(expand=c(0,0), n.breaks=10) +
  labs(x="Year", y="Number of Bird Data Points", fill="Data Source") + scale_fill_brewer(palette = "Dark2") 


aves_yeargraph3

ggsave(plot=aves_yeargraph3, filename="aves/AvesGraphs/aves_year3.png", height=15, width=40, units="cm", dpi=300)

```

###Seasonal Graph 

```{r Graphing by month}
# by month and island 
aves_master$month <- as.factor(aves_master$month)
aves_month <- na.omit(subset(aves_master, select = c(island, month)))


aves_ismonth <- ggplot(aves_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Bird Data Points per Island by Month", y ="Number of Bird Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

aves_ismonth 

ggsave(plot=aves_ismonth, filename="aves/AvesGraphs/aves_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Reptile Collection Type}
aves_colltype = rbind(aves_sbmnh_combine, aves_chis_combine)
aves_colltype = na.omit(subset(aves_chis_combine, select = c(collectionType, source)))
aves_collgraph <- ggplot(aves_colltype, aes(x=collectionType, fill=source)) + geom_bar() + theme_bw()  + labs(x="Collection Type", y="Number of Bird Specimens") + scale_y_continuous(expand=c(0,0), limits=c(0,6000), breaks=c(0, 1000, 2000, 3000, 4000, 5000, 6000))

aves_collgraph

ggsave(plot=aves_collgraph, filename="aves/AvesGraphs/aves_type_CHIS.png", height=5, width=8, units="in", dpi=300)



#doing it will a log 
aves_collgraph2 <- ggplot(aves_colltype, aes(x=collectionType, fill=source)) + geom_bar() + theme_bw()  + labs(x="Collection Type", y="Number of Bird Specimens (log scaled)") +
scale_y_continuous(trans='log10', expand=c(0,0)) 
aves_collgraph2
ggsave(plot=aves_collgraph, filename="aves/AvesGraphs/aves_type2.png", height=5, width=8, units="in", dpi=300)

```


##Aves Step 4. Make Tables 
```{r Family by Source Table}
write.csv(aves_master, "aves/aves_master.csv")
avestab = table(aves_master$acceptedFamily)
avestab = as.data.frame.table(avestab)
write.csv(avestab, "aves/AvesGraphs/aves_table.csv")


aves_inat_tab = table(aves_inat_combine$acceptedFamily)
write.csv(aves_inat_tab, "aves/AvesGraphs/aves_inat_table.csv")

aves_chis_tab = table(aves_chis_combine$acceptedFamily)
write.csv(aves_chis_tab, "aves/AvesGraphs/aves_chis_table.csv")

aves_sbmnh_tab = table(aves_sbmnh_combine$acceptedFamily)
write.csv(aves_sbmnh_tab, "aves/AvesGraphs/aves_sbmnh_table.csv")

aves_ebird_tab = table(aves_ebird_combine$acceptedFamily)
write.csv(aves_ebird_tab, "aves/AvesGraphs/aves_ebird_table.csv")


table(rep_inat_combine$acceptedName)

tabaves_inat <- read_csv("aves/AvesGraphs/aves_inat_table.csv")
tabaves_ebird <- read_csv("aves/AvesGraphs/aves_ebird_table.csv")
tabaves_chis <- read_csv("aves/AvesGraphs/aves_chis_table.csv")
tabaves_sbmnh <- read_csv("aves/AvesGraphs/aves_sbmnh_table.csv")
avestab <- read_csv("aves/AvesGraphs/aves_table.csv")

aves_table <- left_join(avestab, tabaves_inat)
aves_table2 <- left_join(aves_table, tabaves_ebird)
aves_table3 <- left_join(aves_table2, tabaves_chis)
aves_table4 <- left_join(aves_table3, tabaves_sbmnh)

write.csv(aves_table4, "aves/AvesGraphs/aves_complete_table.csv")

```

```{r Family by Source Table}
avestab= table(aves_master$acceptedName)
avestab = as.data.frame.table(avestab) 
avestab2 = avestab %>%
  rename(acceptedName = "Var1", total = "Freq")

aves_master2 = aves_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName)

avestable = left_join(avestab2, aves_master2 )

coltab_inat = table(col_inat$acceptedFamily)
coltab_inat = as.data.frame.table(coltab_inat)
coltab_inat <- coltab_inat %>%
  rename(iNaturalist = "Freq") 

coltab_chis = table(col_chis$acceptedFamily)
coltab_chis = as.data.frame.table(coltab_chis)
coltab_chis <- coltab_chis %>%
  rename(CalIBIS = "Freq") 

coltab_lacm = table(col_lacm$acceptedFamily)
coltab_lacm = as.data.frame.table(coltab_lacm)
coltab_lacm <- coltab_lacm %>%
  rename(LACM = "Freq") 

col_table <- left_join(coltab, coltab_inat)
col_table2 <- left_join(col_table, coltab_chis)
col_table3 <- left_join(col_table2, coltab_lacm)

col_table_complete <-col_table3 %>%
  rename(Sum = "Freq", Family = "Var1")

col_table_complete2 <- col_table_complete %>%
  relocate("Family", "CalIBIS", "iNaturalist", "LACM", "Sum") %>%
  mutate(Percentage = (Sum/20925))


write.csv(col_table_complete2, "coleoptera/ColeopteraGraphs/col_table_complete.csv", na="0")
write.csv(col_master, "coleoptera/col_master.csv", na="")


```

