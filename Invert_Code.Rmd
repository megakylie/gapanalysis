---
title: "Invert Code"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

This is an R Markdown for the Gap Analysis Invertebrate Graph and Table Making. This is the cleaned up code from my first run with Hymenoptera, this code should be able to be used with all the datasets for each Order with little adjustment. 

Includes: Diptera, Mollusks, Chilopoda, Diplopoda, Blattodea, Odonata, Phasmida, Coleoptera, Lepidoptera, Arachnida, and Hemiptera

#Packages to Download 
```{r Download Packages}
# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(readxl)
```


# Diptera 
### Dip Step 1. Download Packages *above* and Import Data
```{r setup}
dip_inat <- read_csv("diptera/dip_inat.csv")
dip_lacm <- read_csv("diptera/dip_lacm.csv")
dip_chis <- read_csv("diptera/dip_chis.csv")
dip_bold <- read_csv("diptera/dip_bold.csv")

# extra for flies
dip_nic <- read_csv("diptera/dip_nic.csv")
```


### Dip Step 2. Combine datasets 
```{r Selecting columns and combining}
dip_inat_combine <- dip_inat %>%
  rename(scientificName="scientific_") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

dip_lacm_combine <- dip_lacm %>%
   select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, Genus, Species) %>% 
  add_column(latitude=NA, longitude=NA) %>%
  unite("scientificName", c(Genus, Species), sep=" ", na.rm=TRUE)

dip_chis_combine <- dip_chis %>%
  rename(scientificName="scientific", latitude="decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

dip_nic_combine <- dip_nic %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, Latitude, Longitude) %>% 
  add_column(scientificName =NA) %>% rename(latitude="Latitude", longitude="Longitude")

dip_master = rbind(dip_inat_combine, dip_chis_combine, dip_lacm_combine, dip_nic_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda", class="Insecta")
write_csv(dip_master, "master/dip_master.csv")

# bold doesn't have date info
dip_bold_combine <-dip_bold %>%
   select(source, island, acceptedFamily, acceptedGenus, acceptedName) 

dip_combine <- dip_master %>%
   select(source, island, acceptedFamily, acceptedGenus, acceptedName) 

dip_master_bold = rbind(dip_combine, dip_bold_combine)
```

```{r heat map}
dip_inat_map <- dip_inat %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude)

```

###Dip Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
dip_islandsumx <- dip_master %>%
  mutate(no_sample = 1) %>%
  group_by(island) %>%
  summarise(samples = sum(no_sample))

dip_islandsum <- dip_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))

dip_island <- ggplot(data = dip_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Diptera Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1200), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

dip_island 

ggsave(plot=dip_island, filename="diptera/DipteraGraphs/dip_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
dip_islandsum2 = merge(dip_islandsum, island_size, by="island", all.y=TRUE)
dip_islandprop = dip_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

dip_island_prop <- ggplot(data = dip_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Diptera Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,70), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

dip_island_prop 

ggsave(plot=dip_island_prop, filename="diptera/DipteraGraphs/dip_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
dip_year = ggplot(dip_master, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 1000)) + 
  scale_x_continuous(limits=c(1910, 2022), breaks=c(1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020), expand=c(0,0)) + 
  labs(x="Year", y ="Number of Diptera Data Points") +   scale_fill_brewer(palette = "Dark2")

dip_year

ggsave(plot=dip_year, filename="diptera/DipteraGraphs/dip_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

occmonth <- ggplot(mastersyn, aes(x=month, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0)) + 
  labs(x="Month", y ="Number of Specimens Samples") +
  scale_x_continuous(breaks = seq(1, 12, by=1)) 

occmonth

# by month and island 
dip_master$month <- as.factor(dip_master$month)
dip_month <- na.omit(subset(dip_master, select = c(island, month)))


dip_ismonth <- ggplot(dip_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Diptera Data Points per Island by Month", y ="Number of Diptera Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

dip_ismonth 

ggsave(plot=dip_ismonth, filename="diptera/DipteraGraphs/dip_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Dip Step 4. Make Tables 
```{r Family by Source Table}
q = table(dip_master_bold$acceptedFamily)
q = as.data.frame.table(q)
write.csv(q, "diptera/DipteraGraphs/dip_table.csv")

# include BOLD? so few 
table(dip_bold_combine$acceptedFamily)

table(dip_chis_combine$acceptedFamily)

table(dip_lacm_combine$acceptedFamily)

table(dip_inat_combine$acceptedFamily)

table(dip_nic_combine$acceptedFamily)

write.csv(dip_master, "diptera/DipteraGraphs/dip_master.csv", na="")
```

```{r Family by Source Table}

diptab= table(dip_master$acceptedFamily)
diptab = as.data.frame.table(diptab)

diptab_inat = table(dip_inat$acceptedFamily)
diptab_inat = as.data.frame.table(diptab_inat)
diptab_inat <- diptab_inat %>%
  rename(iNaturalist = "Freq") 

diptab_chis = table(dip_chis$acceptedFamily)
diptab_chis = as.data.frame.table(diptab_chis)
diptab_chis <- diptab_chis %>%
  rename(CalIBIS = "Freq") 



dip_lacms = rbind(dip_lacm_combine, dip_nic_combine)
diptab_lacm = table(dip_lacms$acceptedFamily)
diptab_lacm = as.data.frame.table(diptab_lacm)
diptab_lacm <- diptab_lacm %>%
  rename(LACM = "Freq") 

dip_tab <- left_join(diptab, diptab_inat)
dip_tab2 <- left_join(dip_tab, diptab_chis)
dip_tab3 <- left_join(dip_tab2, diptab_lacm)

dip_tab_complete <-dip_tab3 %>%
  rename(Sum = "Freq", Family = "Var1")

dip_tab_complete <- dip_tab_complete %>%
  mutate(Percentage = (Sum/4284)) %>% 
  relocate("Family","CalIBIS","LACM", "iNaturalist", "Sum", "Percentage")

write.csv(dip_tab_complete, "diptera/dip_table_complete.csv", na="0")
```

```{r Diptera Literature Comparison}
dip_lit <- read_csv("diptera/dip_lit.csv")

dip_master2 = dip_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

dip_lit2 = dip_lit %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

dip_all2 = rbind(dip_master2, dip_lit2) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)

diptab_occ = table(dip_master$acceptedName)
diptab_occ = as.data.frame.table(diptab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

diptab_lit = table(dip_lit$acceptedName)
diptab_lit = as.data.frame.table(diptab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

diptab_occ_gen = table(dip_master$acceptedGenus)
diptab_occ_gen = as.data.frame.table(diptab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

diptab_lit_gen = table(dip_lit$acceptedGenus)
diptab_lit_gen = as.data.frame.table(diptab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

diptab_occ_fam = table(dip_master$acceptedFamily)
diptab_occ_fam = as.data.frame.table(diptab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

diptab_lit_fam = table(dip_lit$acceptedFamily)
diptab_lit_fam = as.data.frame.table(diptab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
dip_table <- left_join(dip_all2, diptab_occ)
dip_table2 <- left_join(dip_table, diptab_lit)
dip_table3 <- left_join(dip_table2, diptab_occ_gen, by="acceptedGenus")
dip_table4 <- left_join(dip_table3, diptab_lit_gen, by="acceptedGenus")
dip_table5 <- left_join(dip_table4, diptab_occ_fam, by="acceptedFamily")
dip_table6 <- left_join(dip_table5, diptab_lit_fam, by="acceptedFamily")

dip_lit_complete <-dip_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(dip_lit_complete, "diptera/dip_lit_complete.csv", na="")

dip_complete_family = dip_lit_complete %>%
  distinct(Family, .keep_all=TRUE) %>% 
  select(Family, OccurenceFam, LiteratureFam) %>%
  rename(Occurence="OccurenceFam", Literature="LiteratureFam") 

write.csv(dip_complete_family, "diptera/DipteraGraphs/dip_table_family.csv", na="")

dipocc = unique(c(as.character(dip_master$acceptedGenus)))
diplit = unique(c(as.character(dip_lit$acceptedGenus)))
diffdip = setdiff(diplit, dipocc)
diffdip

```


```{r Source Resolution}
ddply(dip_master_bold, "source", summarise, n = length(unique(acceptedFamily)))

ddply(dip_master_bold, "source", summarise, n = length(acceptedFamily))
ddply(dip_master_bold, "source", summarise, n = length(acceptedGenus))
ddply(dip_master_bold, "source", summarise, n = length(acceptedName))

```

#
# Mollusks

###Mol Step 1. Download Packages and Import Data
```{r setup}

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r download data}
mol_inat <- read_csv("mollusks/mol_inat.csv") %>%
  rename(scientificName = "scientific_name", x= "acceptedFamily", y="acceptedGenus", z="acceptedName")

mol_chis <- read_csv("mollusks/mol_chis2.csv") %>%
  rename(scientificName = "scientific", x= "acceptedFamily", y="acceptedGenus", z="acceptedName")

mol_syn <- read_csv("mollusks/mol_syn3.csv")

mol_inat2 <- left_join(mol_inat, mol_syn)
mol_chis2 <- left_join(mol_chis, mol_syn)
write.csv(mol_chis2, "mollusks/mol_chis2syn.csv", na="")

```


###Mol Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
mol_inat_combine <- mol_inat2 %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, scientificName) %>% 
  add_column(source2="iNaturalist")

mol_chis_combine <- mol_chis2 %>%
  rename(latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, scientificName) %>%
  add_column(source2="Cal-IBIS")



mol_master = rbind(mol_inat_combine, mol_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order= "acceptedOrder") %>% add_column(phylum = "Mollusca", class=NA)

mol_master_synfix = mol_master %>% distinct(scientificName, .keep_all=TRUE)

write.csv(mol_master, "master/mollusk_master.csv")

mol_master_synfix = mol_master %>% distinct(scientificName, .keep_all=TRUE)
write.csv(mol_master_synfix, "mollusks/mol_master_synfix.csv", na="")
```

###Mol Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
mol_inat3 = filter(mol_inat2, quality_grade=="research")
mol_islandsum <- mol_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
mol_islandsum <- na.omit(subset(mol_islandsum, select = c(island, samples, source)))

mol_island <- ggplot(data = mol_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Mollusk Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,900), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mol_island 

ggsave(plot=mol_island, filename="mollusks/MolluskGraphs/mol_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
mol_islandsum2 = merge(mol_islandsum, island_size, by="island", all.y=TRUE)
mol_islandprop = mol_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

mol_island_prop <- ggplot(data = mol_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Mollusk Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,65), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

mol_island_prop 

ggsave(plot=mol_island_prop, filename="mollusks/MolluskGraphs/mol_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
There is no year information for about half of the Cal-IBIS records
```{r Graphing by year}

mol_year = ggplot(mol_master, aes(x=year, fill=source2)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 350)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1790, 2022), breaks=c(1800, 1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980,2000, 2020)) + 
  labs(x="Year", y ="Number of Mollusk Data Points", fill="source") +   scale_fill_brewer(palette = "Dark2")

mol_year

ggsave(plot=mol_year, filename="mollusks/MolluskGraphs/mol_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
mol_master$month <- as.factor(mol_master$month)
mol_month <- na.omit(subset(mol_master, select = c(island, month)))


mol_ismonth <- ggplot(mol_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Mollusk Data Points per Island by Month", y ="Number of Mollusk Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

mol_ismonth 

ggsave(plot=mol_ismonth, filename="mollusks/MolluskGraphs/mol_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Mol Step 4. Make Tables 
````{r Family by Source Table}
moltab= table(mol_master$acceptedFamily)
moltab = as.data.frame.table(moltab)

moltab_inat = table(mol_inat2$acceptedFamily)
moltab_inat = as.data.frame.table(moltab_inat)
moltab_inat <- moltab_inat %>%
  rename(iNaturalist = "Freq") 

moltab_chis = table(mol_chis2$acceptedFamily)
moltab_chis = as.data.frame.table(moltab_chis)
moltab_chis <- moltab_chis %>%
  rename(CalIBIS = "Freq") 


mol_table <- left_join(moltab, moltab_inat)
mol_table2 <- left_join(mol_table, moltab_chis)


mol_table_complete <-mol_table2 %>%
  rename(Sum = "Freq", Family = "Var1")

mol_table_complete2 <- mol_table_complete %>%
  relocate("Family", "CalIBIS", "iNaturalist", "Sum") %>%
  mutate(Percentage = (Sum/1904))


write.csv(mol_table_complete2, "mollusks/MolluskGraphs/mol_table_complete.csv", na="0")



```

```{r Source Resolution}
ddply(mol_master, "source", summarise, n = length(unique(acceptedFamily)))

write.csv(mol_master, "mollusks/mol_master.csv")
```

```{r Mollusk Literature Comparison}
lit_new = read_csv("new_invert_literature_Final.csv")
mol_lit_new = filter(lit_new, order=="Mollusks")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

mol_master2 = mol_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 


mol_all2 = rbind(mol_master2, mol_lit_new) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)

moltab_occ = table(mol_master$acceptedName)
moltab_occ = as.data.frame.table(moltab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

moltab_lit = table(mol_lit_new$acceptedName)
moltab_lit = as.data.frame.table(moltab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 


moltab_occ_gen = table(mol_master$acceptedGenus)
moltab_occ_gen = as.data.frame.table(moltab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

moltab_lit_gen = table(mol_lit_new$acceptedGenus)
moltab_lit_gen = as.data.frame.table(moltab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

moltab_occ_fam = table(mol_master$acceptedFamily)
moltab_occ_fam = as.data.frame.table(moltab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

moltab_lit_fam = table(mol_lit_new$acceptedFamily)
moltab_lit_fam = as.data.frame.table(moltab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
mol_table <- left_join(mol_all2, moltab_occ)
mol_table2 <- left_join(mol_table, moltab_lit)
mol_table3 <- left_join(mol_table2, moltab_occ_gen, by="acceptedGenus")
mol_table4 <- left_join(mol_table3, moltab_lit_gen, by="acceptedGenus")
mol_table5 <- left_join(mol_table4, moltab_occ_fam, by="acceptedFamily")
mol_table6 <- left_join(mol_table5, moltab_lit_fam, by="acceptedFamily")

mol_lit_complete <-mol_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(mol_lit_complete, "mollusks/MollusksGraphs/mol_lit_complete.csv", na="")


#DIDNT DO
col_complete_family = col_lit_complete %>%
  distinct(Family, .keep_all=TRUE) %>% 
  select(Family, OccurenceFam, LiteratureFam) %>%
  rename(Occurence="OccurenceFam", Literature="LiteratureFam") 

col_complete_gen = col_lit_complete %>%
  distinct(Genus, .keep_all=TRUE) %>% 
  select(Genus, OccurenceGen, LiteratureGen) %>%
  rename(Occurence="OccurenceGen", Literature="LiteratureGen")

col_complete_sp = col_lit_complete %>%
  distinct(Species, .keep_all=TRUE) %>% 
  select(Species, Occurence, Literature) 

write.csv(col_complete_sp, "coleoptera/ColeopteraGraphs/col_table_sp.csv", na="")

dipocc = unique(c(as.character(dip_master$acceptedGenus)))
diplit = unique(c(as.character(dip_lit$acceptedGenus)))
diffdip = setdiff(diplit, dipocc)
diffdip
```

#
# Chilopoda 

###Chilo Step 1. Download Packages and Import Data
```{r packages}

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```

```{r data}
chilo_inat <- read_csv("chilopoda/chilo_inat.csv")
```

###Chilo Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
chilo_inat_combine <- chilo_inat %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, scientific_name) %>%
  rename(scientificName="scientific_name")

chilo_master = rbind(chilo_inat_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "Santa Cruz", "Anacapa", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order = "acceptedOrder") %>% add_column(phylum= "Arthropoda", class="Chilopoda")
write.csv(chilo_master, "master/chilo_master.csv")
```

###Chilo Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
chilo_islandsum <- chilo_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))
##FF6600
island_size = read_csv("island_size.csv")
chilo_islandsum2 = merge(chilo_islandsum, island_size, by="island", all.y=TRUE) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

chilo_island <- ggplot(data = chilo_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Chilopoda Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,45), expand = c(0,0)) +
   scale_fill_manual(values=c("#D95F02"))

chilo_island 

ggsave(plot=chilo_island, filename="chilopoda/ChilopodaGraphs/chilo_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
chilo_islandsum2 = merge(chilo_islandsum, island_size, by="island", all.y=TRUE)
chilo_islandprop = chilo_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

chilo_island_prop <- ggplot(data = chilo_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Chilopoda Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,0.5), expand = c(0,0)) +
  scale_fill_manual(values=c("#D95F02"))

chilo_island_prop 

ggsave(plot=chilo_island_prop, filename="chilopoda/ChilopodaGraphs/chilo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
chilo_year = ggplot(chilo_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 30)) + 
  scale_x_continuous(limits=c(2000, 2022),   breaks=c(2000, 2005, 2010, 2015, 2020), expand=c(0,0)) + 
  labs(x="Year", y ="Number of Chilopoda Data Points") +  scale_fill_manual(values=c("#D95F02"))

chilo_year

ggsave(plot=chilo_year, filename="chilopoda/chilopodaGraphs/chilo_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
chilo_master$month <- as.factor(chilo_master$month)
chilo_month <- na.omit(subset(chilo_master, select = c(island, month)))


chilo_ismonth <- ggplot(chilo_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Chilopoda Data Points per Island by Month", y ="Number of Chilopoda Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

chilo_ismonth

ggsave(plot=chilo_ismonth, filename="chilopoda/chilopodaGraphs/chilo_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Chilo Step 4. Make Tables 
```{r Family by Source Table}
chilotab = table(chilo_master$acceptedFamily)
chilotab = as.data.frame.table(chilotab)
write.csv(chilotab, "chilopoda/ChilopodaGraphs/chilo_table.csv")

chilotab2 = table(chilo_master$acceptedName)
chilotab2 = as.data.frame.table(chilotab2)
chilotab2

```

```{r Mollusk Literature Comparison}
lit_new = read_csv("new_invert_literature_Final2.csv")
chilo_miller = read_excel("chilopoda/chilo_miller.xlsx") %>%
  select(acceptedFamily, acceptedGenus, acceptedName)
chilo_lit_new = filter(lit_new, order=="Chilopoda")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

chilo_lit2 = rbind(chilo_miller, chilo_lit_new)

chilo_master2 = chilo_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 


chilo_all2 = rbind(chilo_master2, chilo_lit2) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)

chilotab_occ = table(chilo_master$acceptedName)
chilotab_occ = as.data.frame.table(chilotab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

chilotab_lit = table(chilo_lit2$acceptedName)
chilotab_lit = as.data.frame.table(chilotab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

chilotab_occ_gen = table(chilo_master$acceptedGenus)
chilotab_occ_gen = as.data.frame.table(chilotab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

chilotab_lit_gen = table(chilo_lit2$acceptedGenus)
chilotab_lit_gen = as.data.frame.table(chilotab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

chilotab_occ_fam = table(chilo_master$acceptedFamily)
chilotab_occ_fam = as.data.frame.table(chilotab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

chilotab_lit_fam = table(chilo_lit2$acceptedFamily)
chilotab_lit_fam = as.data.frame.table(chilotab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
chilo_table <- left_join(chilo_all2, chilotab_occ)
chilo_table2 <- left_join(chilo_table, chilotab_lit)
chilo_table3 <- left_join(chilo_table2, chilotab_occ_gen, by="acceptedGenus")
chilo_table4 <- left_join(chilo_table3, chilotab_lit_gen, by="acceptedGenus")
chilo_table5 <- left_join(chilo_table4, chilotab_occ_fam, by="acceptedFamily")
chilo_table6 <- left_join(chilo_table5, chilotab_lit_fam, by="acceptedFamily")

chilo_lit_complete <-chilo_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(chilo_lit_complete, "chilopoda/ChilopodaGraphs/chilo_lit_complete2.csv", na="0")
```
#
# Diplopoda
###Diplo Step 1. Download Packages *above* and Import Data


```{r data}
diplo_inat <- read_csv("diplopoda/diplo_inat.csv")
diplo_lacm <- read_csv("diplopoda/diplo_lacm.csv")
diplo_chis <- read_csv("diplopoda/diplo_chis.csv")

```

###Diplo Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
diplo_inat_combine <- diplo_inat %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, scientific_name) %>%
  rename(scientificName = "scientific_name")

diplo_chis_combine <- diplo_chis %>%
  rename(latitude = "decimalLatitude", longitude = "decimalLongitude") %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, scientificName)

diplo_lacm_combine <- diplo_lacm %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, Family) %>% rename(scientificName= "Family") %>%
  add_column(latitude = NA, longitude =NA)


diplo_master = rbind(diplo_inat_combine, diplo_chis_combine, diplo_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "Santa Cruz", "Anacapa", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order = "acceptedOrder") %>% add_column(phylum = "Arthropoda", class = "Diplopoda")
write.csv(diplo_master, "master/diplo_master.csv")
```

###Diplo Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
diplo_master$month <- as.factor(diplo_master$island)
diplo_master$source <- as.factor(diplo_master$source)

diplo_islandsum <- diplo_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

island_size = read_csv("island_size.csv")
diplo_islandsum2 = merge(diplo_islandsum, island_size, by="island", all.y=TRUE) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

diplo_island <- ggplot(data = diplo_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Diplopoda Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,15), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

diplo_island 

ggsave(plot=diplo_island, filename="diplopoda/DiplopodaGraphs/diplo_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
diplo_islandsum2 = merge(diplo_islandsum, island_size, by="island", all.y=TRUE)
diplo_islandprop = diplo_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

diplo_island_prop <- ggplot(data = diplo_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Diplopoda Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,4), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

diplo_island_prop 

ggsave(plot=diplo_island_prop, filename="diplopoda/DiplopodaGraphs/diplo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
diplo_year = ggplot(diplo_master, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 12)) + 
  scale_x_continuous(limits=c(1920, 2022),   breaks=c(1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020), expand=c(0,0)) + 
  labs(x="Year", y ="Number of Diplopoda Data Points") +   scale_fill_brewer(palette = "Dark2")

diplo_year

ggsave(plot=diplo_year, filename="diplopoda/DiplopodaGraphs/diplo_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
diplo_month <- na.omit(subset(diplo_master, select = c(island, month)))
diplo_month$month2 <-as.factor(diplo_month$month)


diplo_ismonth <- ggplot(diplo_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Diplopoda Data Points per Island by Month", y ="Number of Diplopoda Data Points", fill="month") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

diplo_ismonth 

ggsave(plot=diplo_ismonth, filename="diplopoda/DiplopodaGraphs/diplo_seasonal.png", height=4.5, width=9, units="in", dpi=300)

```

###Diplo Step 4. Make Tables 
```{r Family by Source Table}
diplotab = table(diplo_master$acceptedFamily)
diplotab = as.data.frame.table(diplotab)
write.csv(diplotab, "diplopoda/DiplopodaGraphs/diplo_table.csv")

# include BOLD? so few 

table(diplo_chis_combine$acceptedFamily)
table(diplo_lacm_combine$acceptedFamily)
table(diplo_inat_combine$acceptedFamily)



```

```{r Source Resolution}
ddply(dip_master_bold, "source", summarise, n = length(unique(acceptedFamily)))

ddply(dip_master_bold, "source", summarise, n = length(acceptedFamily))
ddply(dip_master_bold, "source", summarise, n = length(acceptedGenus))
ddply(dip_master_bold, "source", summarise, n = length(acceptedName))

```

```{r Diplopoda Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_R3_syninprog_Final.csv")
x_miller = read_excel("diplopoda/diplo_miller.xlsx") %>%
  select(acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, order=="Diplopoda")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new)

x_master2 = diplo_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit_new) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

diplo_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(diplo_lit_complete, "Diplopoda/DiplopodaGraphs/diplo_lit_complete.csv", na="0")
```

#
# Blattodea
###Bla Step 1. Download Packages *above* and Import Data
```{r data}
bla_inat <- read_csv("blattodea/bla_inat.csv")
bla_chis <- read_csv("blattodea/bla_chis.csv")
```
###Bla Step 2. Combine datasets 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
bla_inat_combine <- bla_inat %>%
  rename(scientificName = "scientific_name") %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

bla_chis_combine <- bla_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude") %>%
  select(source, month, year, island, acceptedOrder, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)


bla_master = rbind(bla_inat_combine, bla_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  rename(order = "acceptedOrder") %>% add_column(phylum = "Arthropoda", class="Insecta")
write.csv(bla_master, "master/bla_master.csv")
```

###Bla Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

bla_islandsum <- bla_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample))

island_size = read_csv("island_size.csv")
bla_islandsum2 = merge(bla_islandsum, island_size, by="island", all.y=TRUE) %>%
   mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

bla_island <- ggplot(data = bla_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Blattodea Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,10), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

bla_island 

ggsave(plot=bla_island, filename="blattodea/BlattodeaGraphs/bla_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
bla_islandsum2 = merge(bla_islandsum, island_size, by="island", all.y=TRUE)
bla_islandprop = bla_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85) %>%
   mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

bla_island_prop <- ggplot(data = bla_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Blattodea Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,0.15), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

bla_island_prop 

ggsave(plot=bla_island_prop, filename="blattodea/BlattodeaGraphs/bla_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
bla_year = ggplot(bla_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 12)) + 
  scale_x_continuous(limits=c(1928, 2022),   breaks=c(1930, 1977, 2020), expand=c(0,0)) + 
  labs(x="Year", y ="Number of Blattodea Data Points") +   scale_fill_brewer(palette = "Dark2")

bla_year

ggsave(plot=bla_year, filename="blattodea/BlattodeaGraphs/bla_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
bla_month <- na.omit(subset(bla_master, select = c(island, month)))
bla_month$month2 <-as.factor(bla_month$month)


bla_ismonth <- ggplot(bla_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Blattodea Data Points per Island by Month", y ="Number of Blattodea Data Points", fill="month") +  
  facet_wrap(vars(island), nrow=1, scales="free_y")

bla_ismonth 

ggsave(plot=bla_ismonth, filename="blattodea/BlattodeaGraphs/bla_seasonal.png", height=2.4, width=9, units="in", dpi=300)

```

###Bla Step 4. Make Tables 
```{r Family by Source Table}
blatab = table(bla_master$acceptedFamily)
diplotab = as.data.frame.table(diplotab)
write.csv(diplotab, "diplopoda/DiplopodaGraphs/diplo_table.csv")



table(bla_chis_combine$acceptedFamily)
table(bla_inat_combine$acceptedFamily)
```
```{r Blat Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_R3_syninprog_Final.csv")
x_miller = read_excel("blattodea/bla_miller.xlsx") %>%
  select(acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, order=="Blattodea")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new)

#does this next line pull the correct order?
x_master2 = bla_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit_new) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

bla_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(bla_lit_complete, "blattodea/BlattodeaGraphs/bla_lit_complete.csv", na="0")
```

#
# Odonanta
###Odo Step 1. Download Packages *above* and Import Data

```{r data}
odo_inat <- read_csv("odonata/odo_inat.csv")
odo_chis <- read_csv("odonata/odo_chis.csv")
```

###Odo Step 2. Combine datasets 
```{r selecting and combining}
odo_inat_combine <- odo_inat %>%
  rename(order="acceptedOrder", scientificName="scientific_name") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

odo_chis_combine <- odo_chis %>%
  rename(order = "order_", latitude = "decimalLat", longitude="decimalLon", scientificName="scientific") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)


odo_master = rbind(odo_inat_combine, odo_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum = "Arthropoda", class="Insecta")
write.csv(odo_master, "master/odo_master.csv")

```

###Odo Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

odo_islandsum <- odo_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 
odo_islandsum <- na.omit(subset(odo_islandsum, select = c(island, samples, source)))

odo_island <- ggplot(data = odo_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(x ="Number of Odonata Data Points", 
       y = "Island",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,150), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

odo_island 

ggsave(plot=odo_island, filename="odonata/OdonataGraphs/odo_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
odo_islandsum2 = merge(odo_islandsum, island_size, by="island", all.y=TRUE)
odo_islandprop = odo_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

odo_island_prop <- ggplot(data = odo_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Odonata Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1.25), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

odo_island_prop 

ggsave(plot=odo_island_prop, filename="odonata/OdonataGraphs/odo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
odo_year = ggplot(odo_master, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 50)) + 
  scale_x_continuous(limits=c(1910, 2022),   breaks=c(1915, 1930, 1945, 1960, 1975, 1990, 2005, 2020), expand=c(0,0)) + 
  labs(x="Year", y ="Number of Odonata Data Points") +   scale_fill_brewer(palette = "Dark2")

odo_year

ggsave(plot=odo_year, filename="odonata/odo_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 

odo_month <- na.omit(subset(odo_master, select = c(island, month)))
odo_month$month2 <-as.factor(odo_month$month)


odo_ismonth <- ggplot(odo_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Odonata Data Points per Island by Month", y ="Number of Odonata Data Points", fill="month") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")


odo_ismonth 

ggsave(plot=odo_ismonth, filename="odonata/OdonataGraphs/odo_seasonal.png", height=4.5, width=9, units="in", dpi=300)

```

###Odo Step 4. Make Tables 
```{r Family by Source Table}
odotab = table(odo_master$acceptedFamily)
odotab = as.data.frame.table(odotab)
write.csv(odotab, "odonata/OdonataGraphs/odo_table.csv")

table(odo_chis_combine$acceptedFamily)
table(odo_inat_combine$acceptedFamily)

#unique name list 
odotab2 = table(odo_master$acceptedName)
odotab2 = as.data.frame.table(odotab2)
write.csv(odotab2, "odonata/OdonataGraphs/odo_table2.csv")
```

```{r Odonata Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_R3_syninprog_Final.csv")
x_miller = read_excel("odonata/odo_miller.xlsx") %>%
  select(acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, order=="Odonata")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new)

#does this next line pull the correct order?
x_master2 = odo_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit_new) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

odo_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(odo_lit_complete, "odonata/OdonataGraphs/odo_lit_complete.csv", na="0")
```
#
# Phasmida
###Phas Step 1. Download Packages *above* and Import Data

```{r data}
phas_inat <- read_csv("phasmida/phas_inat.csv")
phas_chis <- read_csv("phasmida/phas_chis.csv")
```

###Phas Step 2. Combine datasets 
```{r selecting and combining}
phas_inat_combine <- phas_inat %>%
  rename(scientificName="scientific_name") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

phas_chis_combine <- phas_chis %>%
  rename(order = "order_", latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientific, latitude, longitude) %>%
  rename(scientificName ="scientific")


phas_master = rbind(phas_inat_combine, phas_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda", class="Insecta")
write.csv(phas_master, "master/phas_master.csv")

```

###Phas Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

phas_islandsum <- phas_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 
phas_islandsum <- na.omit(subset(phas_islandsum, select = c(island, samples, source)))

phas_island <- ggplot(data = phas_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(x ="Number of Phasmida Data Points", 
       y = "Island",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,8), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

phas_island 

ggsave(plot=phas_island, filename="phasmida/PhasmidaGraphs/phas_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
phas_islandsum2 = merge(phas_islandsum, island_size, by="island", all.y=TRUE)
phas_islandprop = phas_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

phas_island_prop <- ggplot(data = phas_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Phasmida Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,1), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

phas_island_prop 

ggsave(plot=phas_island_prop, filename="phasmida/PhasmidaGraphs/odo_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
phas_year = ggplot(phas_master, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 3)) + 
  scale_x_continuous(limits=c(1930, 2022),   breaks=c(1930, 1945, 1960, 1975, 1990, 2005, 2020), expand=c(0,0)) + 
  labs(x="Year", y ="Number of Phasmida Data Points") +   scale_fill_brewer(palette = "Dark2")

phas_year

ggsave(plot=phas_year, filename="phasmida/PhasmidaGraphs/phas_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}

# by month and island 
phas_month <- na.omit(subset(phas_master, select = c(island, month)))
phas_month$month2 <-as.factor(phas_month$month)

phas_ismonth <- ggplot(phas_month, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)), limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Phasmida Data Points per Island by Month", y ="Number of Phasmida Data Points", fill="month") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

phas_ismonth 

ggsave(plot=phas_ismonth, filename="phasmida/PhasmidaGraphs/phas_seasonal.png", height=2.25, width=4, units="in", dpi=300)

```

###Phas Step 4. Make Tables 
```{r Family by Source Table}
write.csv(phas_master, "phasmida/PhasmidaGraphs/phas_master.csv")

```
```{r Nonexistant Phas Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)
# NO PHASMIDA IN MILLER OR NEW LIT 
lit_new = read_csv("new_invert_literature_R3_syninprog_Final.csv")
##x_miller = read_excel("blattodea/bla_miller.xlsx") %>% select(acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, order=="Phasmida")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new)

#does this next line pull the correct order?
x_master2 = bla_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit_new) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

bla_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(bla_lit_complete, "blattodea/BlattodeaGraphs/bla_lit_complete.csv", na="0")
```

#
#Coleoptera
### Col Step 1. Download Packages *above* and Import Data
```{r setup}

col_inat <- read_csv("coleoptera/col_inat.csv")
col_lacm <- read_csv("coleoptera/col_lacm.csv")
col_chis <- read_csv("coleoptera/col_chis.csv")

col_inat_date <- read_csv("coleoptera/col_inat_date.csv")

col_inat_fix <- col_inat_date %>%
  select(id, year, month)
col_inat2 <- left_join(col_inat, col_inat_fix)
```


### Col Step 2. Combine datasets HUGE ERROR, no dates in iNat data...
```{r Selecting columns and combining}
col_inat_combine <- col_inat2 %>%
  rename(order="taxon_orde", scientificName="scientific") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

col_chis_combine <- col_chis %>%
  rename(order ="order_", latitude = "decimalLat", longitude="decimalLon", scientificName="scientific") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

col_lacm_combine <- col_lacm %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName) %>% add_column(latitude = NA, longitude =NA)

col_master = rbind(col_chis_combine, col_inat_combine, col_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda", class="Insecta")
write.csv(col_master, "master/col_master.csv")
```

###Col Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

col_islandsum <- na.omit(subset(col_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 

col_island <- ggplot(data = col_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Coleoptera Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,5000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

col_island 

ggsave(plot=col_island, filename="coleoptera/ColeopteraGraphs/col_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
col_islandsum2 = merge(col_islandsum, island_size, by="island", all.y=TRUE)
col_islandprop = col_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

col_island_prop <- ggplot(data = col_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Coleoptera Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,260), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

col_island_prop 

ggsave(plot=col_island_prop, filename="coleoptera/ColeopteraGraphs/col_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
col_year = ggplot(col_master, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 8000)) + 
  scale_x_continuous(limits=c(1890, 2022), breaks=c(1890, 1900, 1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Coleoptera Data Points") +   scale_fill_brewer(palette = "Dark2")

col_year

ggsave(plot=col_year, filename="coleoptera/ColeopteraGraphs/col_year.png", height=5, width=9, units="in", dpi=300)

#logging it bc such a heavy skew
col_yeargraph2 = ggplot(col_master, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(trans='log10', expand=c(0,0)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1890, 2020), breaks=c(1890, 1900, 1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Log Transformed Number of Coleoptera Data Points") +   scale_fill_brewer(palette = "Dark2")

col_yeargraph2

ggsave(plot=col_yeargraph2, filename="coleoptera/ColeopteraGraphs/col_year2.png", height=4.5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
col_master$month <- as.factor(col_master$month)
col_month <- na.omit(subset(col_master, select = c(island, month)))


col_ismonth <- ggplot(col_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Coleoptera Data Points per Island by Month", y ="Number of Coleoptera Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

col_ismonth 

ggsave(plot=col_ismonth, filename="coleoptera/ColeopteraGraphs/col_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Col Step 4. Make Tables 
```{r Family by Source Table}
coltab= table(col_master$acceptedFamily)
coltab = as.data.frame.table(coltab)

coltab_inat = table(col_inat$acceptedFamily)
coltab_inat = as.data.frame.table(coltab_inat)
coltab_inat <- coltab_inat %>%
  rename(iNaturalist = "Freq") 

coltab_chis = table(col_chis$acceptedFamily)
coltab_chis = as.data.frame.table(coltab_chis)
coltab_chis <- coltab_chis %>%
  rename(CalIBIS = "Freq") 

coltab_lacm = table(col_lacm$acceptedFamily)
coltab_lacm = as.data.frame.table(coltab_lacm)
coltab_lacm <- coltab_lacm %>%
  rename(LACM = "Freq") 

col_table <- left_join(coltab, coltab_inat)
col_table2 <- left_join(col_table, coltab_chis)
col_table3 <- left_join(col_table2, coltab_lacm)

col_table_complete <-col_table3 %>%
  rename(Sum = "Freq", Family = "Var1")

col_table_complete2 <- col_table_complete %>%
  relocate("Family", "CalIBIS", "iNaturalist", "LACM", "Sum") %>%
  mutate(Percentage = (Sum/20925))


write.csv(col_table_complete2, "coleoptera/ColeopteraGraphs/col_table_complete.csv", na="0")
write.csv(col_master, "coleoptera/col_master.csv", na="")


```


```{r Coleoptera Literature Comparison}

col_lit_miller = read_csv("coleoptera/col_lit2.csv")
lit_new = read_csv("new_invert_literature_FINAL.csv")
col_lit_new = filter(lit_new, order=="Coleoptera")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 
col_lit_miller2 = col_lit_miller %>%
    select(acceptedFamily, acceptedGenus, acceptedName) 

col_lit2 = rbind(col_lit_miller2, col_lit_new)

col_master2 = col_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 


col_all2 = rbind(col_master2, col_lit2) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)

coltab_occ = table(col_master$acceptedName)
coltab_occ = as.data.frame.table(coltab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

coltab_lit = table(col_lit2$acceptedName)
coltab_lit = as.data.frame.table(coltab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 


coltab_occ_gen = table(col_master$acceptedGenus)
coltab_occ_gen = as.data.frame.table(coltab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

coltab_lit_gen = table(col_lit2$acceptedGenus)
coltab_lit_gen = as.data.frame.table(coltab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

coltab_occ_fam = table(col_master$acceptedFamily)
coltab_occ_fam = as.data.frame.table(coltab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

coltab_lit_fam = table(col_lit2$acceptedFamily)
coltab_lit_fam = as.data.frame.table(coltab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
col_table <- left_join(col_all2, coltab_occ)
col_table2 <- left_join(col_table, coltab_lit)
col_table3 <- left_join(col_table2, coltab_occ_gen, by="acceptedGenus")
col_table4 <- left_join(col_table3, coltab_lit_gen, by="acceptedGenus")
col_table5 <- left_join(col_table4, coltab_occ_fam, by="acceptedFamily")
col_table6 <- left_join(col_table5, coltab_lit_fam, by="acceptedFamily")

col_lit_complete <-col_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(col_lit_complete, "coleoptera/ColeopteraGraphs/col_lit_complete.csv", na="")


#DIDNT DO
col_complete_family = col_lit_complete %>%
  distinct(Family, .keep_all=TRUE) %>% 
  select(Family, OccurenceFam, LiteratureFam) %>%
  rename(Occurence="OccurenceFam", Literature="LiteratureFam") 

col_complete_gen = col_lit_complete %>%
  distinct(Genus, .keep_all=TRUE) %>% 
  select(Genus, OccurenceGen, LiteratureGen) %>%
  rename(Occurence="OccurenceGen", Literature="LiteratureGen")

col_complete_sp = col_lit_complete %>%
  distinct(Species, .keep_all=TRUE) %>% 
  select(Species, Occurence, Literature) 

write.csv(col_complete_sp, "coleoptera/ColeopteraGraphs/col_table_sp.csv", na="")

dipocc = unique(c(as.character(dip_master$acceptedGenus)))
diplit = unique(c(as.character(dip_lit$acceptedGenus)))
diffdip = setdiff(diplit, dipocc)
diffdip
```

#
#Lepidoptera
### Lep Step 1. Download Packages *above* and Import Data
```{r setup}
lep_inat <- read_csv("lepidoptera/lep_inat.csv")
lep_lacm <- read_csv("lepidoptera/lep_lacm.csv")
lep_chis <- read_csv("lepidoptera/lep_chis.csv")
```


### Lep Step 2. Combine datasets
```{r Selecting columns and combining}
lep_inat_combine <- lep_inat %>%
  rename(order="taxon_order_name", scientificName = "scientific_name") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

lep_chis_combine <- lep_chis %>%
  rename(order = "order_", latitude = "decimalLat", longitude="decimalLon", scientificName="scientific") %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

lep_lacm_combine <- lep_lacm %>%
  select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName) %>%
  add_column(latitude=NA, longitude=NA, scientificName=NA)

lep_master = rbind(lep_inat_combine, lep_chis_combine, lep_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda", class="Insecta")
write.csv(lep_master, "master/lep_master.csv")
```

###Lep Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
lep_islandsumx <- na.omit(subset(lep_master, select = c(island))) %>%
  mutate(no_sample = 1) %>%
  group_by(island) %>%
  summarise(samples = sum(no_sample)) 

lep_islandsum <- na.omit(subset(lep_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 


lep_island <- ggplot(data = lep_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Lepidoptera Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,4000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

lep_island 

ggsave(plot=lep_island, filename="lepidoptera/LepidopteraGraphs/lep_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
lep_islandsum2 = merge(lep_islandsum, island_size, by="island", all.y=TRUE)
lep_islandprop = lep_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

lep_island_propgraph <- ggplot(data = lep_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Lepidoptera Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,150), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

lep_island_propgraph 

ggsave(plot=lep_island_propgraph, filename="lepidoptera/LepidopteraGraphs/lep_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
lep_year <- na.omit(subset(lep_master, select = c(island, year, month, source)))
lep_yeargraph = ggplot(lep_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 1750)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1905, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Lepidoptera Data Points") +   scale_fill_brewer(palette = "Dark2")

lep_yeargraph

ggsave(plot=lep_yeargraph, filename="lepidoptera/LepidopteraGraphs/lep_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
lep_year$month <- as.factor(lep_year$month)

lep_ismonth <- ggplot(lep_year, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0.5)) + 
  labs(x="Lepidoptera Data Points per Island by Month", y ="Number of Lepidoptera Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

lep_ismonth 

ggsave(plot=lep_ismonth, filename="lepidoptera/LepidopteraGraphs/lep_seasonal.png", height=4.5, width=9, units="in", dpi=300)

```

###Lep Step 4. Make Tables 
```{r Family by Source Table}
leptab= table(lep_master$acceptedFamily)
leptab = as.data.frame.table(leptab)
write.csv(leptab, "lepidoptera/LepidopteraGraphs/lep_table.csv")

leptab_inat = table(lep_inat$acceptedFamily)
leptab_inat = as.data.frame.table(leptab_inat)
leptab_inat <- leptab_inat %>%
  rename(iNaturalist = "Freq") 

leptab_chis = table(lep_chis$acceptedFamily)
leptab_chis = as.data.frame.table(leptab_chis)
leptab_chis <- leptab_chis %>%
  rename(CalIBIS = "Freq") 

leptab_lacm = table(lep_lacm$acceptedFamily)
leptab_lacm = as.data.frame.table(leptab_lacm)
leptab_lacm <- leptab_lacm %>%
  rename(LACM = "Freq") 

lep_table <- left_join(leptab, leptab_inat)
lep_table2 <- left_join(lep_table, leptab_chis)
lep_table3 <- left_join(lep_table2, leptab_lacm)

lep_table_complete <-lep_table3 %>%
  rename(Sum = "Freq", Family = "Var1")

lep_fam = read_csv("lepidoptera/lep_families.csv")
lep_table_complete2 <- left_join(lep_table_complete, lep_fam) 

lep_table_complete2 <- lep_table_complete2 %>%
  relocate("iconic", "Family", "CalIBIS", "iNaturalist", "LACM", "Sum") %>%
  mutate(Percentage = (Sum/9392))


write.csv(lep_table_complete2, "lepidoptera/LepidopteraGraphs/lep_table_complete.csv", na="0")
write.csv(lep_master, "lepidoptera/lep_master.csv", na="")
```
```{r Lep Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_Final2.csv")
x_miller = read_csv("lepidoptera/lep_miller.csv") %>%
  select(acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, acceptedOrder=="Lepidoptera")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new)

#does this next line pull the correct order?
x_master2 = lep_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit_new) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

lep_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(lep_lit_complete, "lepidoptera/LepidopteraGraphs/lep_lit_complete.csv", na="0")
```
#
#Arachnida 
#### Arac Step1. Download Packages *above* and Import Data
```{r setup}
arac_inat <- read_csv("arachnida/arac_inat.csv")
arac_lacm <- read_csv("arachnida/arac_lacm.csv")
arac_chis <- read_csv("arachnida/arac_chis.csv")
```


### Arac Step 2. Combine datasets BY CLASS not ORDER (Note for total combine data for KHL)
```{r Selecting columns and combining}
arac_inat_combine <- arac_inat %>%
  rename(class="iconic_taxon_name") %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

arac_chis_combine <- arac_chis %>%
  rename(order="order_", latitude = "decimalLat", longitude="decimalLon", scientificName="scientific") %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude) 


arac_lacm_combine <- arac_lacm %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName) %>%
  add_column(latitude=NA, longitude =NA, scientificName="Scorpiones")


arac_master = rbind(arac_inat_combine, arac_chis_combine, arac_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda")

#some base R script to get rid of the silly 0 months, years and lat/long (done above to coord data)
arac_master[arac_master == 0] <- NA
write.csv(arac_master, "master/arac_master.csv")

```

###Arac Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
arac_islandsum <- na.omit(subset(arac_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 


arac_island <- ggplot(data = arac_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Arachnida Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,600), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

arac_island 

ggsave(plot=arac_island, filename="arachnida/ArachnidaGraphs/arac_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
arac_islandsum2 = merge(arac_islandsum, island_size, by="island", all.y=TRUE)
arac_islandprop = arac_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

arac_island_propgraph <- ggplot(data = arac_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Arachnida Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,12), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

arac_island_propgraph 

ggsave(plot=arac_island_propgraph, filename="arachnida/ArachnidaGraphs/arac_island_prop.png", height=5, width=8, units="in", dpi=300)
```

#### Temporal Graph
```{r Graphing by year}

arac_year <- na.omit(subset(arac_master, select = c(island, year, month, source)))
arac_yeargraph = ggplot(arac_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 550)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1905, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Arachnida Data Points") +   scale_fill_brewer(palette = "Dark2")

arac_yeargraph

ggsave(plot=lep_yeargraph, filename="lepidoptera/LepidopteraGraphs/lep_year.png", height=5, width=9, units="in", dpi=300)

#logging it bc such a heavy skew
arac_yeargraph2 = ggplot(arac_year, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(trans='log10', expand=c(0,0)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1905, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Log Transformed Number of Arachnida Data Points") +   scale_fill_brewer(palette = "Dark2")

arac_yeargraph2

ggsave(plot=arac_yeargraph2, filename="arachnida/ArachnidaGraphs/arac_year2.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 
```{r Graphing by month}
# by month and island 
arac_year$month <- as.factor(arac_year$month)

arac_ismonth <- ggplot(arac_year, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Arachnida Data Points per Island by Month", y ="Number of Arachnida Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

arac_ismonth 

ggsave(plot=arac_ismonth, filename="arachnida/ArachnidaGraphs/arac_seasonal.png", height=5, width=9, units="in", dpi=300)

```

###Arac Step 4. Make Tables 
```{r Family by Source Table}
#not using LACM single Scorpion to order in this table so using arac_combo instead of arac_master
aractab= table(arac_combo$acceptedFamily)
aractab = as.data.frame.table(aractab)

aractab_inat = table(arac_inat$acceptedFamily)
aractab_inat = as.data.frame.table(aractab_inat)
aractab_inat <- aractab_inat %>%
  rename(iNaturalist = "Freq") 

aractab_chis = table(arac_chis$acceptedFamily)
aractab_chis = as.data.frame.table(aractab_chis)
aractab_chis <- aractab_chis %>%
  rename(CalIBIS = "Freq") 

arac_table <- left_join(aractab, aractab_inat)
arac_table2 <- left_join(arac_table, aractab_chis)

arac_table_complete <-arac_table2 %>%
  rename(Sum = "Freq", Family = "Var1")

arac_table_complete <- arac_table_complete %>%
  mutate(Percentage = (Sum/1333))

#this is me trying to add order to the table as well (can be used to add higher rankings to other tables!)
arac_combo2 <- arac_combo %>% 
  rename(Family="acceptedFamily", Order = "order") %>%
  select(Family, Order)
arac_combo3 <- distinct(arac_combo2, Family, .keep_all = TRUE)

arac_table_worder <- left_join(arac_table_complete, arac_combo3)


write.csv(arac_table_worder, "arachnida/ArachnidaGraphs/arac_table_complete.csv", na="0")
```

```{r Arac Literature comparison}
arac_lit_miller = read_csv("arachnida/arac_lit_miller.csv")
lit_new = read_csv("new_invert_literature_R3_syninprog2.csv")
arac_lit_new = filter(lit_new, class=="Arachnida")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 
arac_lit_miller2 = arac_lit_miller %>%
    select(acceptedFamily, acceptedGenus, acceptedName) 

arac_lit = rbind(arac_lit_miller2, arac_lit_new)

arac_occ_fam = unique(c(as.character(arac_master$acceptedFamily)))
arac_lit_fam = unique(c(as.character(arac_lit_miller$acceptedFamily)))
aracfam = setdiff(arac_lit_fam, arac_occ_fam)
aracfam #list of 71 different 

#against new lit
arac_lit_fam_new = unique(c(as.character(arac_lit_new$acceptedFamily)))
aracfam_new = setdiff(arac_lit_fam_new, arac_occ_fam)
aracfam_new

arac_lit1 = as.data.frame(aracfam)
arac_lit2 = as.data.frame(aracfam_new) %>%
  rename(aracfam = "aracfam_new")
arac_lit_families = rbind(arac_lit1, arac_lit2)


#GENUS
arac_occ_gen = unique(c(as.character(arac_master$acceptedGenus)))
arac_lit_gen = unique(c(as.character(arac_lit$acceptedGenus)))
aracgen = setdiff(arac_lit_gen, arac_occ_gen)
aracgen #list of 149 different 85 gen occ

arac_occ_gen

#FAMILY
arac_occ_fam = unique(c(as.character(arac_master$acceptedFamily)))
arac_lit_fam = unique(c(as.character(arac_lit$acceptedFamily)))
aracfam = setdiff(arac_lit_fam, arac_occ_fam)
aracfam #list of 82 different 59 fam occ 

arac_occ_fam

#SPECIES
arac_occ_sp = unique(c(as.character(arac_master$acceptedName)))
arac_lit_sp = unique(c(as.character(arac_lit$acceptedName)))
aracsp = setdiff(arac_lit_sp, arac_occ_sp)
aracsp #list of 154 different 74 sp occ

arac_occ_sp



arac_lit1sp = as.data.frame(aracsp)
arac_lit2sp = as.data.frame(aracsp_new) %>%
  rename(aracsp = "aracsp_new")
arac_lit_species = rbind(arac_lit1sp, arac_lit2sp)

write.csv(arac_lit_families, "arachnida/arac_lit_fam.csv", na="")
write.csv(arac_lit_genera, "arachnida/arac_lit_gen.csv", na="")
write.csv(arac_lit_species, "arachnida/arac_lit_sp.csv", na="")


#species list table 
arac_master2 = arac_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName, island) %>% 
  distinct(across(contains("accepted")), .keep_all=TRUE)

arac_lit2 = arac_lit_family %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

arac_master3 = arac_master2 %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

arac_all2 = rbind(arac_master3, arac_lit_fam) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)

write.csv(arac_master2, "arachnida/arac_occurence_SCL.csv", na="")
write.csv(arac_all2, "arachnida/arac_allisland.csv", na="")

```

```{r Arachnida Literature Comparison}
arac_lit_miller = read_csv("arachnida/arac_lit_miller.csv")
lit_new = read_csv("new_invert_literature_R3_syninprog2.csv")
arac_lit_new = filter(lit_new, class=="Arachnida")  %>% 
  select(order, acceptedFamily, acceptedGenus, acceptedName) 
arac_lit_miller2 = arac_lit_miller %>%
    select(order, acceptedFamily, acceptedGenus, acceptedName) 

arac_lit = rbind(arac_lit_miller2, arac_lit_new)

arac_master2 = arac_master %>%
  select(order, acceptedFamily, acceptedGenus, acceptedName) 

arac_lit2 = arac_lit %>% 
  select(order, acceptedFamily, acceptedGenus, acceptedName) 

arac_all2 = rbind(arac_master2, arac_lit2) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)

aractab_occ = table(arac_master$acceptedName)
aractab_occ = as.data.frame.table(aractab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

aractab_lit = table(arac_lit$acceptedName)
aractab_lit = as.data.frame.table(aractab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

aractab_occ_gen = table(arac_master$acceptedGenus)
aractab_occ_gen = as.data.frame.table(aractab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

aractab_lit_gen = table(arac_lit$acceptedGenus)
aractab_lit_gen = as.data.frame.table(aractab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

aractab_occ_fam = table(arac_master$acceptedFamily)
aractab_occ_fam = as.data.frame.table(aractab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

aractab_lit_fam = table(arac_lit$acceptedFamily)
aractab_lit_fam = as.data.frame.table(aractab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
arac_table <- left_join(arac_all2, aractab_occ)
arac_table2 <- left_join(arac_table, aractab_lit)
arac_table3 <- left_join(arac_table2, aractab_occ_gen, by="acceptedGenus")
arac_table4 <- left_join(arac_table3, aractab_lit_gen, by="acceptedGenus")
arac_table5 <- left_join(arac_table4, aractab_occ_fam, by="acceptedFamily")
arac_table6 <- left_join(arac_table5, aractab_lit_fam, by="acceptedFamily")

arac_lit_complete <-arac_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(arac_lit_complete, "arachnida/ArachnidaGraphs/arac_lit_complete2.csv", na="0")

```

```{r OLD Combine all masters to check against lit list}

master_m = rbind(col_master, lep_master) %>%
  select(source, year, month, island, order, acceptedFamily, acceptedGenus, acceptedName) 
arac = arac_master %>%
  select(source, year, month,  island, order, acceptedFamily, acceptedGenus, acceptedName)
master_master = rbind(master_m, arac)

write.csv(master_master, "arachnida/master_master.csv", na="")


```
#
#Hemiptera
#### Hem Step1. Download Packages *above* and Import Data
```{r setup}
hem_inat <- read_csv("hemiptera/hem_inat4.csv")
hem_lacm <- read_csv("hemiptera/hem_lacm3.csv")
hem_chis <- read_csv("hemiptera/hem_chis3.csv")
hem_bold <- read_csv("hemiptera/hem_bold3.csv")
```


### Hem Step 2. Combine datasets 
```{r Selecting columns and combining}
hem_inat_combine <- hem_inat %>%
  rename(class="iconic_taxon_name", island="ArcMap_Name") %>%
  select(source, month, year, island, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude)

hem_chis_combine <- hem_chis %>%
  rename(latitude = "decimalLat", longitude="decimalLon") %>%
  select(source, month, year, island, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude) %>% filter_all(any_vars(!is.na(.)))

hem_lacm_combine <- hem_lacm %>%
  select(month, year, island, acceptedFamily, acceptedGenus, acceptedName, scientificName) %>%
  add_column(source="LACM", latitude = NA, longitude = NA)

hem_bold_combine <- hem_bold %>%
  rename(latitude = "lat", longitude = "lon") %>%
  select(source, island, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude) %>%
  add_column(month = NA, year= NA)

hem_master = rbind(hem_inat_combine, hem_chis_combine, hem_bold_combine, hem_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
  add_column(phylum="Arthropoda", class="Insecta", order="Hemiptera")
hem_master2 = hem_master %>% 
  mutate(source = fct_relevel(source, "Cal-IBIS", "iNaturalist", "LACM", "BOLD"))
#some base R script to get rid of the silly 0 months, years and lat/long (done above to coord data)
hem_master[hem_master == 0] <- NA

write.csv(hem_master, "master/hem_master.csv")
```

###Hem Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}

hem_islandsum <- na.omit(subset(hem_master2, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 


hem_island <- ggplot(data = hem_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Hemiptera Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,850), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

hem_island 

ggsave(plot=hem_island, filename="hemiptera/HemipteraGraphs/hem_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
hem_islandsum2 = merge(hem_islandsum, island_size, by="island", all.y=TRUE)
hem_islandprop = hem_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

hem_island_propgraph <- ggplot(data = hem_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Hemiptera Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,12), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

hem_island_propgraph 

ggsave(plot=hem_island_propgraph, filename="hemiptera/HemipteraGraphs/hem_island_prop.png", height=5, width=8, units="in", dpi=300)
```

#### Temporal Graph
```{r Graphing by year}

hem_year <- na.omit(subset(hem_master, select = c(island, year, month, source)))
hem_yeargraph = ggplot(hem_year, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits=c(0, 300)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1908, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Hemiptera Data Points") +   scale_fill_brewer(palette = "Dark2")

hem_yeargraph

ggsave(plot=hem_yeargraph, filename="hemiptera/HemipteraGraphs/hem_year.png", height=5, width=9, units="in", dpi=300)
```

####Seasonal Graph 
```{r Graphing by month}
# by month and island 
hem_year$month2 <- as.factor(hem_year$month)

hem_ismonth <- ggplot(hem_year, aes(x=month2, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + 
  labs(x="Hemiptera Data Points per Island by Month", y ="Number of Hemiptera Data Points", fill="month") +  facet_wrap(vars(island), nrow=2, scales="free_y")

hem_ismonth 

ggsave(plot=hem_ismonth, filename="hemiptera/HemipteraGraphs/hem_seasonal.png", height=5, width=9, units="in", dpi=300)
```

```{r Family table}
hemtab= table(hem_master$acceptedFamily)
hemtab = as.data.frame.table(hemtab)  %>%
  rename(acceptedFamily = "Var1", total = "Freq")

hemtab_inat = table(hem_inat$acceptedFamily)
hemtab_inat = as.data.frame.table(hemtab_inat) %>%
  rename(iNaturalist = "Freq", acceptedFamily = "Var1")

hemtab_chis = table(hem_chis$acceptedFamily)
hemtab_chis = as.data.frame.table(hemtab_chis) %>%
  rename(CalIBIS = "Freq", acceptedFamily = "Var1") 

hemtab_lacm = table(hem_lacm$acceptedFamily)
hemtab_lacm = as.data.frame.table(hemtab_lacm) %>%
  rename(LACM = "Freq", acceptedFamily = "Var1")

hemtab_bold = table(hem_bold$acceptedFamily)
hemtab_bold = as.data.frame.table(hemtab_bold) %>%
  rename(BOLD = "Freq", acceptedFamily = "Var1") 

hem_table <- left_join(hemtab, hemtab_inat)
hem_table2 <- left_join(hem_table, hemtab_chis)
hem_table3 <- left_join(hem_table2, hemtab_lacm)
hem_table4 <- left_join(hem_table3, hemtab_bold)

hem_table_complete <-hem_table4 %>%
  rename(Family = "acceptedFamily") %>%
  relocate("Family", "CalIBIS", "LACM", "iNaturalist", "BOLD","total") %>%
  mutate(Percentage = (total/1387))
  
write.csv(hem_table_complete, "hemiptera/HemipteraGraphs/hem_table_complete.csv", na="0")

hemtab2= table(hem_master$acceptedName)
hemtab2 = as.data.frame.table(hemtab2)  %>%
  rename(acceptedName = "Var1", total = "Freq")

hem_master2 = hem_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName)

hem_species = left_join(hemtab2, hem_master2 )
hem_species = distinct(hem_species)

write.csv(hem_species, "hemiptera/HemipteraGraphs/hem_specieslist.csv", na="")
```

```{r Hemipt Literature comparison}
hem_lit_miller = read_csv("hemiptera/hem_miller.csv") %>%
  rename(family="FAMILY", genus="GENUS") %>%
  select(source, family, genus, scientificName, acceptedFamily, acceptedGenus, acceptedName)
lit_new = read_csv("new_invert_literature_FINAL.csv") %>%
  select(source, order, family, genus, scientificName)
hem_lit_new = filter(lit_new, order=="Hemiptera") %>%
  select(source, family, genus, scientificName)

hem_syn = read_csv("hemiptera/hem_syn.csv")
hem_syn_round2 = read_csv("hemiptera/hym_syn_round2.csv") 
hem_synonymy = rbind(hem_syn, hem_syn_round2)
hem_lit_new_syn = left_join(hem_lit_new, hem_synonymy)

hem_lit_fam = rbind(hem_lit_miller, hem_lit_new_syn)

hem_occ_fam = unique(c(as.character(hem_master$acceptedFamily)))
hem_lit_fam = unique(c(as.character(hem_lit_miller$acceptedFamily)))
hemfam = setdiff(hem_lit_fam, hem_occ_fam)
hemfam #8 in miller

#against new lit
hem_lit_fam_new = unique(c(as.character(hem_lit_new_syn$family)))
hemfam_new = setdiff(hem_lit_fam_new, hem_occ_fam)
hemfam_new

#9 familys, 8 from Miller and 1 new "Naucoridae?"

hem_lit1 = as.data.frame(hemfam)
hem_lit2 = as.data.frame(hemfam_new) %>%
  rename(hemfam = "hemfam_new")
hem_lit_families = rbind(hem_lit1, hem_lit2)

#GENUS
hem_occ_gen = unique(c(as.character(hem_master$acceptedGenus)))
hem_lit_gen = unique(c(as.character(hem_lit_miller$acceptedGenus)))
hemgen = setdiff(hem_lit_gen, hem_occ_gen)
hemgen #list of 59 miller

#against new lit
hem_lit_gen_new = unique(c(as.character(hem_lit_new$genus)))
hemgen_new = setdiff(hem_lit_gen_new, hem_occ_gen)
hemgen_new

hem_lit1gen = as.data.frame(hemgen)
hem_lit2gen = as.data.frame(hemgen_new) %>%
  rename(hemgen = "hemgen_new")
hem_lit_genera = rbind(hem_lit1gen, hem_lit2gen)

#SPECIES
hem_occ_sp = unique(c(as.character(hem_master$acceptedName)))
hem_lit_sp = unique(c(as.character(hem_lit_miller$acceptedName)))
hemsp = setdiff(hem_lit_sp, hem_occ_sp)
hemsp #list of 124 miller

#against new lit
hem_lit_sp_new = unique(c(as.character(hem_lit_new$scientificName)))
hemsp_new = setdiff(hem_lit_sp_new, hem_occ_sp)
hemsp_new

hem_lit1sp = as.data.frame(hemsp)
hem_lit2sp = as.data.frame(hemsp_new) %>%
  rename(hemsp = "hemsp_new")
hem_lit_species = rbind(hem_lit1sp, hem_lit2sp)

write.csv(hem_lit_families, "hemiptera/hem_lit_fam.csv", na="")
write.csv(hem_lit_genera, "hemiptera/hem_lit_gen.csv", na="")
write.csv(hem_lit_species, "hemiptera/hem_lit_sp.csv", na="")
```

```{r Hemiptera Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_Final.csv")
x_miller = read_csv("hemiptera/hem_miller.csv") %>%
  select(acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, order=="Hemiptera")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new)

x_master2 = hem_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit_new) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

hem_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(hem_lit_complete, "Hemiptera/HemipteraGraphs/hem_lit_complete.csv", na="")
```

#
#Orthoptera
### Orth Step 1. Download Packages *above* and Import Data
```{r setup}
orth_inat <- read_csv("orthoptera/orth_inat3.csv")
orth_lacm <- read_csv("orthoptera/orth_lacm2.csv")
orth_chis <- read_csv("orthoptera/orth_chis3.csv")
```


### Orth Step 2. Combine datasets
```{r Selecting columns and combining}
orth_inat_combine <- orth_inat %>%
  select(month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude) %>%
    add_column(source="iNaturalist")

orth_chis_combine <- orth_chis %>%
  rename(latitude = "decimalLat", longitude="decimalLon", island="ArcMap_IslandNames") %>%
  select(month, year, island, order_, acceptedFamily, acceptedGenus, acceptedName...92, scientificName, latitude, longitude) %>%
  rename(order = "order_", acceptedName="acceptedName...92") %>%
  add_column(source="Cal-IBIS")

orth_lacm_combine <- orth_lacm %>%
  rename(island="Island") %>%
  select(month, year, island, order, acceptedFamily, acceptedGenus, acceptedName) %>%
  add_column(latitude=NA, longitude=NA, scientificName=NA, source="LACM")

orth_master = rbind(orth_inat_combine, orth_chis_combine, orth_lacm_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda", class="Insecta")
write.csv(orth_master, "master/orth_master.csv")
```

###Orth Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
orth_islandsum <- na.omit(subset(orth_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 


orth_island <- ggplot(data = orth_islandsum, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Orthoptera Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,175), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

orth_island 

ggsave(plot=orth_island, filename="orthoptera/OrthopteraGraphs/orth_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
orth_islandsum2 = merge(orth_islandsum, island_size, by="island", all.y=TRUE)
orth_islandprop = orth_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

orth_island_propgraph <- ggplot(data = orth_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Orthoptera Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,7), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

orth_island_propgraph 

ggsave(plot=orth_island_propgraph, filename="orthoptera/OrthopteraGraphs/orth_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
orth_year <- na.omit(subset(orth_master, select = c(island, year, month, source)))
orth_yeargraph = ggplot(orth_year, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 200)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1905, 2022), breaks=c(1910,  1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Orthoptera Data Points") +   scale_fill_brewer(palette = "Dark2")

orth_yeargraph

ggsave(plot=orth_yeargraph, filename="orthoptera/OrthopteraGraphs/orth_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
orth_year$month <- as.factor(orth_year$month)

orth_ismonth <- ggplot(orth_year, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Orthoptera Data Points per Island by Month", y ="Number of Orthoptera Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

orth_ismonth 

ggsave(plot=orth_ismonth, filename="orthoptera/OrthopteraGraphs/orth_seasonal.png", height=4.5, width=9, units="in", dpi=300)

```

###Orthoptera Step 4. Make Tables 
```{r Family by Source Table}
orthtab= table(orth_master$acceptedFamily)
orthtab = as.data.frame.table(orthtab)
write.csv(orthtab, "orthoptera/OrthopteraGraphs/orth_table.csv")

orthtab_inat = table(orth_inat$acceptedFamily)
orthtab_inat = as.data.frame.table(orthtab_inat)
orthtab_inat <- orthtab_inat %>%
  rename(iNaturalist = "Freq") 

orthtab_chis = table(orth_chis$acceptedFamily)
orthtab_chis = as.data.frame.table(orthtab_chis)
orthtab_chis <- orthtab_chis %>%
  rename(CalIBIS = "Freq") 

orthtab_lacm = table(orth_lacm$acceptedFamily)
orthtab_lacm = as.data.frame.table(orthtab_lacm)
orthtab_lacm <- orthtab_lacm %>%
  rename(LACM = "Freq") 

orth_table <- left_join(orthtab, orthtab_inat)
orth_table2 <- left_join(orth_table, orthtab_chis)
orth_table3 <- left_join(orth_table2, orthtab_lacm)

orth_table_complete <-orth_table3 %>%
  rename(Sum = "Freq", Family = "Var1")


orth_table_complete2 <- orth_table_complete %>%
  relocate("Family", "CalIBIS", "iNaturalist", "LACM", "Sum") %>%
  mutate(Percentage = (Sum/613))


write.csv(orth_table_complete2, "orthoptera/OrthopteraGraphs/orth_table_complete.csv", na="0")

orth_inat_research = filter(orth_inat, quality_gr=="research" ) %>%
  select(acceptedFamily, acceptedGenus, acceptedName)

```

```{r Orthoptera Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_R3_syninprog_Final.csv")
x_miller = read_csv("orthoptera/orth_lit_miller_syn.csv") %>%
  select(scientificName, acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, acceptedOrder=="Orthoptera")  %>% 
  select(scientificName, acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new) %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

#does this next line pull the correct order?
x_master2 = orth_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit2) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

orth_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(orth_lit_complete, "orthoptera/OrthopteraGraphs/orth_lit_complete.csv", na="0")
```
#
#Hymenoptera
## Step 1. Download datasets. 
(iNaturalist, LACM, Cal-IBIS, Bohart for Hymenoptera)
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(plyr)
library(dplyr)

inat =read.csv("hymenoptera/hym_inat_clean.csv")
lacm = read.csv("hymenoptera/hym_lacm_clean.csv")
chis = read_csv("hymenoptera/hym_chis_clean.csv")
bohart = read.csv("hymenoptera/hym_bohart_clean.csv")
bold = read.csv("hymenoptera/BOLD_IslandHymenoptera_Feb2021.csv")
```
```{r clean up datasets}
inat_column <- inat %>%
  select(source, month, day_arabic, year, island, order, family, genus, specificEp, scientificName)
lacm_column <- lacm %>%
  select(source, month_arabic, day_arabic, year, island, order, family, genus, specificEp, scientificName) 
chis_column <- chis %>%
  select(source, month_arabic, day_arabic, year, island, order, family, genus, specificEp, scientificName) %>%
filter(!is.na(source))
bohart_column <- bohart %>%
  select(source, month_arabic, day_arabic, year, island, order, family, genus, specificEp, scientificName)

chis_hym_2012 = filter(chis, year==2012)
```

## Step 3. Make master dataset.
Now to combine. iNat = 1372, LACM = 1186, CHIS = 7621, Bohart = 6326 (bohart is all bees). 16505 total. 

```{r create the master }
masterdata = rbind(inat_column, lacm_column, chis_column, bohart_column)
write.csv(masterdata, "hym_master.csv")
```
**Ignore if you did synonymy before combining

Updated master dataset with the synonymy. 
```{r synonymy dataset}
mastersyn = read.csv("hymenoptera/hym_master_syn.csv")
write_csv(mastersyn, "master/hym_master.csv")

hym_master = mastersyn %>%  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda", class="Insecta")
```
## Adding the BOLD data to the mastersyn. 
Mastersyn2 documnet has no temporal information
```{r}
bold = read.csv("hymenoptera/BOLD_IslandHymenoptera_Feb2021.csv")
bold_column <- bold %>%
  select(record, source, island, acceptedFamily, acceptedGenus, acceptedName) %>% 
  add_column(year="", month="")
mastersyn_column <- mastersyn %>%
  select(record, source, island, acceptedFamily, acceptedGenus, acceptedName)
mastersyn2 = rbind(mastersyn_column, bold_column)
```
##Hym Step. 3 Make Graphs! New Standardized code with edits 
### Island Graph 
```{r Graphing by island}
 hym_islandsumx <- hym_master %>%
   mutate(no_sample = 1) %>%
   group_by(island) %>%
   summarise(samples = sum(no_sample)) %>%
   filter(!is.na(island)) 

 hym_islandsum <- hym_master %>%
   mutate(no_sample = 1) %>%
   group_by(island, source) %>%
   summarise(samples = sum(no_sample)) %>%
   filter(!is.na(island)) %>%
   ungroup() %>%
   mutate(source2 = fct_relevel(source, "Cal-IBIS", "iNaturalist", "LACM", "Bohart"))

hym_islandsum = hym_islandsum[c(1:32),] 

hym_island <- ggplot(data = hym_islandsum, aes(x = samples, y = fct_rev(island), fill = source2)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Hymenoptera Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,11000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

hym_island 

ggsave(plot=hym_island, filename="hymenoptera/HymenopteraGraphs/hym_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
hym_islandsum2 = merge(hym_islandsum, island_size, by="island", all.y=TRUE)
hym_islandprop = hym_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

hym_island_prop <- ggplot(data = hym_islandprop, aes(x = by_area, y = fct_rev(island), fill = source2)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Hymenoptera Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,150), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

hym_island_prop 

ggsave(plot=hym_island_prop, filename="hymenoptera/HymenopteraGraphs/hym_island_prop2.png", height=5, width=8, units="in", dpi=300)
```


### Temporal Graph
```{r Graphing by year}

hymyear =  mastersyn %>% mutate(source2 = fct_relevel(source, "Cal-IBIS", "iNaturalist", "LACM", "Bohart"))

hym_year = ggplot(hymyear, aes(x=year, fill=source2)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 3500)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1890, 2022), breaks=c(1900, 1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Hymenoptera Data Points", fill="source") +   scale_fill_brewer(palette = "Dark2")

hym_year

ggsave(plot=hym_year, filename="hymenoptera/HymenopteraGraphs/hym_year.png", height=5, width=9, units="in", dpi=300)

```

###Graphing the seasonal gaps in collections. 

```{r Graphing by month}
# by month and island 
mastersyn$month <- as.factor(mastersyn$month)
hym_month <- na.omit(subset(mastersyn, select = c(island, month)))
hym_month <- hym_month[c(1:1371, 1373:16323),]

hym_ismonth <- ggplot(hym_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05))) + 
  labs(x="Hymenoptera Data Points per Island by Month", y ="Number of Hymenoptera Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

hym_ismonth 

ggsave(plot=hym_ismonth, filename="hymenoptera/HymenopteraGraphs/hym_seasonal.png", height=5, width=9, units="in", dpi=300)
```

```{r Hym Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_R3_syninprog_Final.csv")
x_miller = read_csv("hymenoptera/lit_miller_hym_nosp.csv") %>%
  select(acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, acceptedOrder=="Hymenoptera")  %>% 
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new)

#does this next line pull the correct order?
x_master2 = mastersyn %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit2) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

hym_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(hym_lit_complete, "hymenoptera/HymenopteraGraphs/hym_lit_complete.csv", na="0")
```



#
#Dermaptera
### Derm Step 1. Download Packages *above* and Import Data
```{r setup}
derm_inat <- read_csv("dermaptera/derm_inat.csv")
derm_chis <- read_csv("dermaptera/derm_chis.csv")
```


### Orth Step 2. Combine datasets
```{r Selecting columns and combining}
derm_inat_combine <- derm_inat %>%
  select(month, year, island, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude) %>%
    add_column(source="iNaturalist", order="Dermaptera")

derm_chis_combine <- derm_chis %>%
  rename(latitude = "decimalLat", longitude="decimalLon") %>%
  select(month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude) %>%
  add_column(source="Cal-IBIS")

derm_master = rbind(derm_inat_combine, derm_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>% add_column(phylum="Arthropoda", class="Insecta")
write.csv(derm_master, "master/derm_master.csv")
```

###Derm Step. 3 Make Graphs! 

#### Island Graph 
```{r Graphing by island}
derm_islandsum <- na.omit(subset(derm_master, select = c(island, source))) %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) 


derm_island <- ggplot(data = derm_islandsum2, aes(x = samples, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Dermaptera Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,15), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

derm_island 

ggsave(plot=derm_island, filename="dermaptera/DermapteraGraphs/derm_island.png", height=5, width=8, units="in", dpi=300)

```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
derm_islandsum2 = merge(derm_islandsum, island_size, by="island", all.y=TRUE) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))
derm_islandprop = derm_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

derm_island_propgraph <- ggplot(data = derm_islandprop, aes(x = by_area, y = fct_rev(island), fill = source)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Dermaptera Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,0.75), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

derm_island_propgraph 

ggsave(plot=derm_island_propgraph, filename="dermaptera/DermapteraGraphs/derm_island_prop.png", height=5, width=8, units="in", dpi=300)
```


#### Temporal Graph
```{r Graphing by year}
derm_year <- na.omit(subset(derm_master, select = c(island, year, month, source)))
derm_yeargraph = ggplot(derm_year, aes(x=year, fill=source)) + 
  geom_bar(width=0.75) + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 16)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1925, 2022), breaks=c(1910,1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + 
  labs(x="Year", y ="Number of Dermaptera Data Points") +   scale_fill_brewer(palette = "Dark2")

derm_yeargraph

ggsave(plot=derm_yeargraph, filename="dermaptera/DermapteraGraphs/derm_year.png", height=5, width=9, units="in", dpi=300)

```

####Seasonal Graph 

```{r Graphing by month}
# by month and island 
derm_year$month2 <-as.factor(derm_year$month)

derm_ismonth <- ggplot(derm_year, aes(x=month, fill=month2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(expand=expansion(mult=c(0,0.01)),  limits=c(0.5,12), breaks=c(1,2,3,4,5,6,7,8,9,10,11,12)) +
  labs(x="Dermaptera Data Points per Island by Month", y ="Number of Dermaptera Data Points", fill="month") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

derm_ismonth 

ggsave(plot=derm_ismonth, filename="dermaptera/DermapteraGraphs/derm_seasonal.png", height=4.5, width=9, units="in", dpi=300)
```

###Orthoptera Step 4. Make Tables 
```{r Family by Source Table}
dermtab= table(derm_master$acceptedName)
dermtab = as.data.frame.table(dermtab)

dermtab_inat = table(derm_inat$acceptedName)
dermtab_inat = as.data.frame.table(dermtab_inat)
dermtab_inat <- dermtab_inat %>%
  rename(iNaturalist = "Freq") 

dermtab_chis = table(derm_chis$acceptedName)
dermtab_chis = as.data.frame.table(dermtab_chis)
dermtab_chis <- dermtab_chis %>%
  rename(CalIBIS = "Freq") 


derm_table <- left_join(dermtab, dermtab_inat)
derm_table2 <- left_join(derm_table, dermtab_chis)


derm_table_complete <-derm_table2 %>%
  rename(Sum = "Freq", Family = "Var1")


derm_table_complete2 <- derm_table_complete %>%
  relocate("Family", "CalIBIS", "iNaturalist", "Sum") %>%
  mutate(Percentage = (Sum/44))


write.csv(derm_table_complete2, "dermaptera/DermapteraGraphs/derm_table_complete.csv", na="0")

derm_inat_research = filter(derm_inat, quality_grade=="research" ) %>%
  select(acceptedFamily, acceptedGenus, acceptedName)

```

```{r Orthoptera Literature Comparison}

#USING X_" " for easy copy and paste through taxa (MAKE SURE EVERYTHING IS CORRECT)

lit_new = read_csv("new_invert_literature_R3_syninprog_Final.csv")
x_miller = read_csv("orthoptera/orth_lit_miller_syn.csv") %>%
  select(scientificName, acceptedFamily, acceptedGenus, acceptedName)
x_lit_new = filter(lit_new, acceptedOrder=="Orthoptera")  %>% 
  select(scientificName, acceptedFamily, acceptedGenus, acceptedName) 

x_lit2 = rbind(x_miller, x_lit_new) %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

#does this next line pull the correct order?
x_master2 = orth_master %>%
  select(acceptedFamily, acceptedGenus, acceptedName) 

x_all2 = rbind(x_master2, x_lit2) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE)


xtab_occ = table(x_master2$acceptedName)
xtab_occ = as.data.frame.table(xtab_occ) %>%
  rename(Occurence= "Freq",  acceptedName = "Var1") 

xtab_lit = table(x_lit2$acceptedName)
xtab_lit = as.data.frame.table(xtab_lit) %>%
  rename(Literature= "Freq",  acceptedName = "Var1") 

xtab_occ_gen = table(x_master2$acceptedGenus)
xtab_occ_gen = as.data.frame.table(xtab_occ_gen) %>%
  rename(OccurenceGen= "Freq",  acceptedGenus = "Var1") 

xtab_lit_gen = table(x_lit2$acceptedGenus)
xtab_lit_gen = as.data.frame.table(xtab_lit_gen) %>%
  rename(LiteratureGen= "Freq",  acceptedGenus = "Var1") 

xtab_occ_fam = table(x_master2$acceptedFamily)
xtab_occ_fam = as.data.frame.table(xtab_occ_fam) %>%
  rename(OccurenceFam= "Freq",  acceptedFamily = "Var1") 

xtab_lit_fam = table(x_lit2$acceptedFamily)
xtab_lit_fam = as.data.frame.table(xtab_lit_fam) %>%
  rename(LiteratureFam= "Freq",  acceptedFamily = "Var1") 

#species list table from occurence and literature, with numbers just to show what is added by lit
x_table <- left_join(x_all2, xtab_occ)
x_table2 <- left_join(x_table, xtab_lit)
x_table3 <- left_join(x_table2, xtab_occ_gen, by="acceptedGenus")
x_table4 <- left_join(x_table3, xtab_lit_gen, by="acceptedGenus")
x_table5 <- left_join(x_table4, xtab_occ_fam, by="acceptedFamily")
x_table6 <- left_join(x_table5, xtab_lit_fam, by="acceptedFamily")

orth_lit_complete <-x_table6 %>%
  rename(Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus")

write.csv(orth_lit_complete, "orthoptera/OrthopteraGraphs/orth_lit_complete.csv", na="0")
```
#
#Fixing up Literature species synonymy
This code is messy and not the most straight forward way to do this, but it shouldn't be run against accepted for making a master list. After this is done and synonymy is finished for the new literature records I can make a really nice synonymy .csv for all invertebrate that can be used for future work. 
```{r MASTER MASTER!}

#masterlists download if don't have already
mol_master = read_csv("master/mollusk_master.csv") %>% 
  select(...1, source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude, phylum, class)
chilo_master = read_csv("master/chilo_master.csv")
diplo_master = read_csv("master/diplo_master.csv")
bla_master = read_csv("master/bla_master.csv")
odo_master = read_csv("master/odo_master.csv")
phas_master = read_csv("master/phas_master.csv")
col_master = read_csv("master/col_master.csv")
lep_master = read_csv("master/lep_master.csv")
arac_master = read_csv("master/arac_master.csv")
hem_master = read_csv("master/hem_master.csv")
dip_master = read_csv("master/dip_master.csv")
derm_master = read_csv("master/derm_master.csv")
orth_master = read_csv("master/orth_master.csv")
hym_master = read_csv("hymenoptera/hym_master_syn.csv") %>% select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName) %>% add_column(latitude=NA, longitude=NA, phylum="Arthropoda", class="Insecta")

#combined all the master lists
master_invert_1 = rbind(mol_master, chilo_master, diplo_master, bla_master, odo_master, phas_master, col_master, lep_master, arac_master, orth_master, derm_master, hem_master) %>% 
   select(source, month, year, island, order, acceptedFamily, acceptedGenus, acceptedName, scientificName, latitude, longitude, phylum, class)

master_inverts = rbind(master_invert_1, dip_master, hym_master)
write_csv(master_inverts, "master/master_inverts2.csv")

master_invert_syn =master_inverts %>%
  rename(scientificName_accepted="scientificName") %>%
  select(phylum, class, order, acceptedFamily,  acceptedGenus, acceptedName, scientificName_accepted) %>%
  distinct(across(contains("accepted")), .keep_all=TRUE) %>%
  rename(scientificName ="scientificName_accepted")


#Master synonymy list of distinct scientificName values
master_invert_syn = master_inverts %>% distinct(scientificName, .keep_all=TRUE) %>% select(phylum, class, order, scientificName, acceptedFamily, acceptedGenus, acceptedName)
write_csv(master_invert_syn, "master/master_invert_syn.csv")
#SEEMS TO BE AN ISSUE WITH THE MOLLUSK OCCURENCE DATA NOT BEING SYNONYMIZED !!!

#list of San Clemenete for Kristen
invert_scl = filter(master_inverts, island=="San Clemente") %>% distinct(scientificName, .keep_all=TRUE) %>% select(island, phylum, class, order, acceptedFamily, acceptedGenus, acceptedName, scientificName)
write_csv(invert_scl, "master/invert_scl.csv")
```
``` {r}

#adding new lit list 
new_invert_lit = read_csv("Island_invert_lit_new-2.csv")

master_invert_syn2 = master_invert_syn %>%
  select(scientificName, acceptedGenus, acceptedName)


#ONLY COMPARED TO OCCURENCE SYNONYMY, not Miller 
new_invert_lit_synonymy = left_join(new_invert_lit, master_invert_syn2)
write_csv(new_invert_lit_synonymy, "Kylie/new_invert_lit_synR1.csv", na="")

# did spiders, hymenoptera and small orders by hand, reuploading dataset and then will compare to miller lit synonymy for hemiptera, coleoptera and lepidoptera
new_invert_lit_synR1 = read_csv("Kylie/new_invert_lit_synR1edited.csv")
col_miller = read_csv("coleoptera/col_lit.csv")
lep_miller = read_csv("lepidoptera/lep_miller.csv")
hem_miller = read_csv("hemiptera/hem_miller.csv")

col_millersyn = col_miller %>%
  select(family, acceptedFamily,  acceptedGenus, acceptedName, genus, species) %>%
  unite("scientificName_accepted", genus:species, na.rm=TRUE, sep=" ") %>%
  distinct(across(contains("accepted"))) %>%
  rename(scientificName ="scientificName_accepted")

hem_millersyn = hem_miller %>%
  rename(family="FAMILY", genus="GENUS", scientificName_accepted="scientificName") %>%
  select(family, acceptedFamily,  acceptedGenus, acceptedName, scientificName_accepted) %>%
  distinct(across(contains("accepted"))) %>%
  rename(scientificName ="scientificName_accepted")

lep_millersyn = lep_miller %>%
  select(family, acceptedFamily,  acceptedGenus, acceptedName, genus, species) %>%
  unite("scientificName_accepted", genus:species, na.rm=TRUE, sep=" ") %>%
  distinct(across(contains("accepted"))) %>%
  rename(scientificName ="scientificName_accepted")

millersyn_col_hem_lep = rbind(col_millersyn, hem_millersyn, lep_millersyn)

newinvert_lit_syn2 = left_join(new_invert_lit_synR1, millersyn_col_hem_lep, by="scientificName")
new_invert_lit_syn3 = left_join(newinvert_lit_syn2, master_invert_syn, by="scientificName")
write_csv(newinvert_lit_syn2, "Kylie/new_invert_lit_synR2.csv", na="")
write_csv(new_invert_lit_syn3, "Kylie/new_invert_lit_synR3.csv", na="")

leptab= table(lep_master$acceptedGenus)
leptab = as.data.frame.table(leptab)  %>%
  rename(acceptedGenus = "Var1", total = "Freq")
```