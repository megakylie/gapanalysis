---
title: "Rare and Endemic"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

This is an R Markdown to analysis the distribution of rare and endemic vertebrates and invertebrates in the dataset. To understand there geographic and temporal gaps. 

#Packages to Download 
```{r Download Packages}
# load packages
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
```


```{r}
mam_inat <- read_csv("mammal/mam_inat.csv")

mam_chis <- read_csv("mammal/mam_chis.csv")

```


##Mam Step 2. Combine datasets 
```{r selecting and combining}


#inat doesn't have order listed..would need to add 
mam_inat_combine <- mam_inat %>%
  rename(class="iconic_tax") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName)

#doesn't have location information!!!!
mam_chis_combine <- mam_chis %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName)


mam_master = rbind(mam_inat_combine, mam_chis_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente"))

```

#Mammal Endemics
```{r Creating a new datasheet with just endemics}
mam_end <- read_csv("mammal/mam_end.csv")

mam_end_join = inner_join(mam_master, mam_end)

```

```{r island fox}
fox = filter(mam_end_join, acceptedGenus=="Urocyon")
fox_yearrare = ggplot(fox, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=2, scales="free") 
fox_yearrare = fox_yearrare  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1880, 1890, 1900, 1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15)) 

fox_yearrare

ggsave(plot=fox_yearrare, filename="mammal/MammalGraphs/mam_er_fox.png", height=20, width=45, units="cm", dpi=300)

```

```{r deermouse}
mouse = filter(mam_end_join, acceptedGenus=="Peromyscus")
mouse_yearrare = ggplot(mouse, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=3, scales="free") 
mouse_yearrare = mouse_yearrare  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(n.breaks=8) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15)) 

mouse_yearrare

ggsave(plot=mouse_yearrare, filename="mammal/MammalGraphs/mam_er_deermouse.png", height=30, width=45, units="cm", dpi=300)
```

```{r skunk}
skunk = filter(mam_end_join, acceptedGenus=="Spilogale")
skunk_yearrare = ggplot(skunk, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of S. gracilis amphiala Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=1, scales="free")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(n.breaks=8)

skunk_yearrare

ggsave(plot=skunk_yearrare, filename="mammal/MammalGraphs/mam_er_skunk.png", height=10, width=15, units="cm", dpi=300)
```

```{r Pacific bat}
bat1 = filter(mam_end_join, acceptedGenus=="Antrozous")
bat1_yearrare = ggplot(bat1, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=1, scales="free")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(n.breaks=8)

bat1_yearrare

ggsave(plot=bat1_yearrare, filename="mammal/MammalGraphs/mam_er_bat1.png", height=10, width=15, units="cm", dpi=300)
```

```{r other bat}
bat2 = filter(mam_end_join, acceptedGenus=="Corynorhinus")
bat2_yearrare = ggplot(bat2, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1900, 1920, 1940, 1960, 1980, 2000, 2020))

bat2_yearrare

ggsave(plot=bat2_yearrare, filename="mammal/MammalGraphs/mam_er_bat2.png", height=10, width=30, units="cm", dpi=300)
```

```{r harvest mouse NO RECORDS}
harv_mouse =  filter(mam_end_join, acceptedGenus=="Reithrodontomys")
harvmouse_yearrare = ggplot(harv_mouse, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=1, scales="free")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(n.breaks=8)

harvmouse_yearrare

ggsave(plot=bat1_yearrare, filename="mammal/MammalGraphs/mam_er_harvmouse.png", height=10, width=15, units="cm", dpi=300)
```

```{r squirrel}
squirrel = filter(mam_end_join, acceptedGenus=="Otospermophilus")
squirrel_yearrare = ggplot(squirrel, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=1, scales="free")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(n.breaks=8)

squirrel_yearrare

ggsave(plot=squirrel_yearrare, filename="mammal/MammalGraphs/mam_er_squirrel.png", height=10, width=15, units="cm", dpi=300)
```

```{r shrew}
shrew= filter(mam_end_join, acceptedGenus=="Sorex")
shrew_yearrare = ggplot(shrew, aes(x=year, fill=source)) + 
  geom_bar() + 
  theme_bw() + 
  labs(x="Year", y ="Number of Occurences") +   scale_fill_brewer(palette = "Dark2") + facet_wrap(vars(acceptedName), nrow=1)  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(limits=c(1920, 2020), breaks=c(1941, 1983, 1991, 2004))

shrew_yearrare

ggsave(plot=shrew_yearrare, filename="mammal/MammalGraphs/mam_er_shrew.png", height=10, width=15, units="cm", dpi=300)
```

```{r trying to see if island trends is relevant graph (maybe not)}
mammal_end_island = rbind(skunk, shrew, bat1, squirrel, harv_mouse)
island_size = read_csv("island_size.csv")
mammal_end_island2 = merge(mam_end_islandsum, island_size, by="island", all.y=TRUE)

mam_end_islandsum <- mammal_end_island %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source) %>%
  summarise(samples = sum(no_sample))
mam_end_islandsum <- na.omit(subset(mam_end_islandsum, select = c(island, samples, acceptedName, source)))
island_size = read_csv("island_size.csv")
mam_end_islandsum2 = merge(mam_end_islandsum, island_size, by="island", all.y=TRUE) %>%
  replace_na(list(samples =0))
mam_end_islandsum2 <- na.omit(select = c(acceptedName))

mam_end_islandsum2 <- na.omit(subset(mam_end_islandsum, select = c(samples, acceptedName, source, island)))

mam_end_island_ex <- ggplot(data = mammal_end_island2, aes(x = samples, y = fct_rev(island), fill=source)) + 
  geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=2, scales="free_x") +
  labs(y ="Island", 
       x = "Number of Occurences",
       fill = "Species") +
  theme_bw() + 
 + scale_fill_brewer(palette="Paired")

mam_end_island_ex

#4 observations in the Cal-IBIS dataset 
ggsave(plot=mam_end_island_ex, filename="mammal/MammalGraphs/mam_end_island_ex.png", height=5, width=8, units="in", dpi=300)
```
