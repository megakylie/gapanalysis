---
title: "Aves Code"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook for the Gap Analysis - Aves analysis. I consolidated all the Aves code (minus synonymy/data clean up) into one markdown because it's too large to want to place nice with others (aka it makes the other markdowns messy and huge)

#Aves Step 1. Download Packages and Import Data
```{r download packages}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(readxl)
```

```{r download datasets}
#using inat3, ebird2, chis_onlyegg2, sbmnh_obs4, and sbmnh_col4.
aves_inat <- read_csv("aves/aves_inat4.csv")
aves_ebird <- read_csv("aves/aves_ebird2.csv")
aves_chis <- read_csv("aves/aves_chis_onlyeggs2.csv")
aves_sbmnh_obs <- read_csv("aves/aves_sbmnh_obs4.csv")
aves_sbmnh_col <- read_excel("aves/aves_sbmnh_col.xlsx")
aves_ebird_erem <- read_csv("aves/aves_ebird_empid2.csv")
```

```{r EBIRD!!!!!! ):<}
aves_ebird_ana <- read_csv("aves/ebird/EBIRD_Anacapa.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_scr <- read_csv("aves/ebird/EBIRD_SantaCruz.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_sr <- read_csv("aves/ebird/EBIRD_SantaRosa.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_sm <- read_csv("aves/ebird/EBIRD_SanMiguel.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_sn <- read_csv("aves/ebird/EBIRD_SanNicolas.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_sb <- read_csv("aves/ebird/EBIRD_SantaBarbara.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_scl <- read_csv("aves/ebird/EBIRD_SanClemente.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_sca <- read_csv("aves/ebird/EBIRD_SantaCatalina.csv") %>%
  select(island...1, gbifID, identifier, occurrenceID, catalogNumber, recordedBy, individualCount, year, month, day, stateProvince, county, locality, decimalLatitude, decimalLongitude, scientificName, kingdom, phylum, class, order, family, genus, specificEpithet, infraspecificEpithet, vernacularName)

aves_ebird_new = rbind(aves_ebird_ana, aves_ebird_scr, aves_ebird_sr, aves_ebird_sm, aves_ebird_sb, aves_ebird_sn, aves_ebird_sca, aves_ebird_scl) %>% 
  rename(island="island...1", authorName = "scientificName") %>%
  unite('scientificName', genus:specificEpithet, remove=FALSE, sep=" ")

write_csv(aves_ebird_new, "aves/ave_ebird.new.csv")

```

#Aves Step 2. Combine datasets. Lat and Long included. 
```{r selecting and combining}
#inat doesn't have order listed..would need to add 
aves_inat_combine <- aves_inat %>%
  rename(class="iconic_tax", type="collectionType") %>%
  select(source, month, year, island, class,  acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, scientificName) %>%
  add_column(family= NA, genus =NA)

aves_chis_combine <- aves_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", year="year_", month="month_", type="collectionType") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, family, genus, scientificName)

aves_sbmnh_obs_combine <- aves_sbmnh_obs %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", type="collectionType") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, family, genus, scientificName)

aves_sbmnh_col_combine <- aves_sbmnh_col %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", type="collectionType2") %>%
  select(source, month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, family, genus, scientificName)

aves_ebird_orig <- aves_ebird %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", year="year_", month="month_") %>%
  select(month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, family, genus, scientificName) %>%
  add_column(source="EBIRD", type="Observation")

aves_ebird_new <- aves_ebird_erem %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", island="island...127", scientificName="scientificName...202") %>%
  select(month, year, island, class, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, family, genus, scientificName) %>%
  add_column(source="EBIRD", type="Observation")
aves_ebird_combine = rbind(aves_ebird_orig, aves_ebird_new)
  
aves_master_na = rbind(aves_inat_combine, aves_chis_combine, aves_sbmnh_obs_combine, aves_sbmnh_col_combine, aves_ebird_combine) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
 mutate(source2 = fct_relevel(source, "Cal-IBIS (Egg Only)", "iNaturalist", "EBIRD", "SBMNH Collections", "SBMNH Observations"))
#filter out all NA rows 
aves_master <- filter(aves_master_na, rowSums(is.na(aves_master_na)) != ncol(aves_master_na)) # Apply 
```


```{r}
aves_chis_combine_ord <- aves_chis %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", year="year_", month="month_", type="collectionType") %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, family, genus, scientificName)

aves_sbmnh_obs_combine_ord <- aves_sbmnh_obs %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", type="collectionType") %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, family, genus, scientificName)

aves_sbmnh_col_combine_ord <- aves_sbmnh_col %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", type="collectionType2") %>%
  select(source, month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, family, genus, scientificName)

aves_ebird_ord_orig <- aves_ebird %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", year="year_", month="month_", type = "collection Type") %>%
  select(month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, type, family, genus, scientificName) %>%
  add_column(source="EBIRD")

aves_ebird_ord_new <- aves_ebird_erem %>%
  rename(latitude = "decimalLatitude", longitude="decimalLongitude", island="island...127", scientificName="scientificName...202") %>%
  select(month, year, island, class, order, acceptedFamily, acceptedGenus, acceptedName, latitude, longitude, family, genus, scientificName) %>%
  add_column(source="EBIRD", type="Observation")
aves_ebird_combine_ord = rbind(aves_ebird_ord_orig, aves_ebird_ord_new)
  
aves_master_na_ord = rbind( aves_chis_combine_ord, aves_sbmnh_obs_combine_ord, aves_sbmnh_col_combine_ord, aves_ebird_combine_ord) %>%
  # reorder the island names to show up N -> S on list
  mutate(island = fct_relevel(island, "San Miguel", "Santa Rosa", "Santa Cruz", "Anacapa", "Santa Barbara", "Santa Catalina", "San Nicolas", "San Clemente")) %>%
 mutate(source2 = fct_relevel(source, "Cal-IBIS (Egg Only)", "EBIRD", "SBMNH Collections", "SBMNH Observations"))
#filter out all NA rows 
aves_master <- filter(aves_master_na, rowSums(is.na(aves_master_na)) != ncol(aves_master_na)) # Apply 
```

#Aves Step. 3 Make Graphs! 
### Island Graph 
```{r Graphing by island}
aves_islandsum <- aves_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, source) %>%
  summarise(samples = sum(no_sample)) %>%
filter(!is.na(island)) %>%
   ungroup() %>%
  mutate(source2 = fct_relevel(source, "Cal-IBIS (Egg Only)", "iNaturalist", "EBIRD", "SBMNH Collections", "SBMNH Observations"))

aves_islandsum <- na.omit(subset(aves_islandsum, select = c(island, samples, source2)))

aves_island <- ggplot(data = aves_islandsum, aes(x = samples, y = fct_rev(island), fill = source2)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,126000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

aves_island 

ggsave(plot=aves_island, filename="aves/AvesGraphs/aves_island.png", height=5, width=8, units="in", dpi=300)

#by collection type
aves_master$type = as.character(aves_master$type)
aves_islandsumty <- aves_master %>%
  mutate(no_sample = 1) %>%
  group_by(island, type) %>%
  summarise(samples = sum(no_sample)) %>%
filter(!is.na(island)) 
aves_islandsumty <- na.omit(subset(aves_islandsumty, select = c(island, samples, type)))

aves_islandtype <- ggplot(data = aves_islandsumty, aes(x = samples, y = fct_rev(island), fill = type)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points",
       fill = "Type") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,126000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Paired")

aves_islandtype
ggsave(plot=aves_islandtype, filename="aves/AvesGraphs/aves_island_type.png", height=5, width=8, units="in", dpi=300)


```

```{r Graphing by island proportional}
island_size = read_csv("island_size.csv")
aves_islandsum2 = merge(aves_islandsum, island_size, by="island", all.y=TRUE)
aves_islandprop = aves_islandsum2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

aves_island_prop <- ggplot(data = aves_islandprop, aes(x = by_area, y = fct_rev(island), fill = source2)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points/Island Area (km^2)",
       fill = "Data Source") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,10000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Dark2")

aves_island_prop 

ggsave(plot=aves_island_prop, filename="aves/AvesGraphs/aves_island_prop.png", height=5, width=8, units="in", dpi=300)

aves_islandsumty2 = merge(aves_islandsumty, island_size, by="island", all.y=TRUE)
aves_islandsumty_prop = aves_islandsumty2 %>% group_by(island) %>% mutate(by_area = samples/island_size_85)

aves_island_prop_type <- ggplot(data = aves_islandsumty_prop, aes(x = by_area, y = fct_rev(island), fill = type)) + 
  geom_bar(stat = "identity") +
  labs(y ="Island", 
       x = "Number of Bird Data Points/Island Area (km^2)",
       fill = "Type") +
  theme_bw() + 
  scale_x_continuous(limits =c(0,10000), expand = c(0,0)) +
  scale_fill_brewer(palette = "Paired" )
aves_island_prop_type

ggsave(plot=aves_island_prop_type, filename="aves/AvesGraphs/aves_island_prop_type.png", height=5, width=8, units="in", dpi=300)

```

### Temporal Graph
```{r Graphing by year}
aves_year <- na.omit(subset(aves_master, select = c(island, year, source, type))) %>%
  mutate(source2 = fct_relevel(source, "Cal-IBIS (Egg Only)", "iNaturalist", "EBIRD", "SBMNH Collections", "SBMNH Observations"))
aves_yeargraph = ggplot(aves_year, aes(x=year, fill=source2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=c(0,0), limits = c(0, 9000)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1840, 2022), breaks=c(1818, 1850, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + 
  labs(x="Year", y ="Number of Bird Data Points", fill="Data Source") +   scale_fill_brewer(palette = "Dark2")

aves_yeargraph

ggsave(plot=aves_yeargraph, filename="aves/AvesGraphs/aves_year.png", height=5, width=9, units="in", dpi=300)

aves_yeargraph2 = ggplot(aves_year, aes(x=year, fill=source2)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(trans='log10', expand=c(0,0)) + 
  scale_x_continuous(expand=c(0,0), limits=c(1840, 2022), breaks=c(1818, 1850, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + 
  labs(x="Year", y="Number of Bird Data Points (log scaled)", fill="Data Source") +   scale_fill_brewer(palette = "Dark2")

aves_yeargraph2

ggsave(plot=aves_yeargraph2, filename="aves/AvesGraphs/aves_year2.png", height=5, width=9, units="in", dpi=300)

#collection type

aves_yeargraph3 = ggplot(aves_year, aes(x=year, fill=source2)) + 
  geom_bar() + 
  theme_bw() +   facet_wrap(vars(type), nrow=3, scales="free") +
  scale_y_continuous(expand=expansion(mult=c(0,0.02))) + 
  scale_x_continuous(expand=c(0,0), n.breaks=10) +
  labs(x="Year", y="Number of Bird Data Points", fill="Data Source") + scale_fill_brewer(palette = "Dark2") 


aves_yeargraph3

ggsave(plot=aves_yeargraph3, filename="aves/AvesGraphs/aves_year_coll.png", height=25, width=40, units="cm", dpi=300)

#collection type 2 

aves_year2 = filter(aves_year, type=="Collection: Egg/Nest")
aves_year3 = filter(aves_year, type=="Collection: Specimen")
aves_year4 = rbind(aves_year2, aves_year3)

aves_yeargraph4 = ggplot(aves_year4, aes(x=year, fill=type)) + 
  geom_bar(width=0.75) + 
  theme_bw() +   facet_wrap(vars(type), nrow=2, scales="free") +
  scale_y_continuous(expand=expansion(mult=c(0,0.02))) + 
  scale_x_continuous(expand=c(0,0), limits=c(1840, 2022), breaks=c(1818, 1850, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + 
  labs(x="Year", y ="Number of Bird Data Points", fill="Collection Type") +   scale_fill_brewer(palette = "Dark2")

aves_yeargraph4

ggsave(plot=aves_yeargraph4, filename="aves/AvesGraphs/aves_year_coll2.png", height=5, width=9, units="in", dpi=300)

```

###Seasonal Graph 
```{r Graphing by month}
# by month and island 
aves_master$month <- as.factor(aves_master$month)
aves_month <- na.omit(subset(aves_master, select = c(island, month)))


aves_ismonth <- ggplot(aves_month, aes(x=month, fill=month)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand=expansion(mult=c(0,0.02))) + 
  labs(x="Bird Data Points per Island by Month", y ="Number of Bird Data Points") +  
  facet_wrap(vars(island), nrow=2, scales="free_y")

aves_ismonth 

ggsave(plot=aves_ismonth, filename="aves/AvesGraphs/aves_seasonal.png", height=5, width=9, units="in", dpi=300)

```

```{r Aves Collection Type}
aves_colltype = rbind(aves_sbmnh_combine, aves_chis_combine)
aves_colltype = na.omit(subset(aves_chis_combine, select = c(collectionType, source)))
aves_collgraph <- ggplot(aves_colltype, aes(x=collectionType, fill=source)) + geom_bar() + theme_bw()  + labs(x="Collection Type", y="Number of Bird Specimens") + scale_y_continuous(expand=c(0,0), limits=c(0,6000), breaks=c(0, 1000, 2000, 3000, 4000, 5000, 6000))

aves_collgraph

ggsave(plot=aves_collgraph, filename="aves/AvesGraphs/aves_type_CHIS.png", height=5, width=8, units="in", dpi=300)



#doing it will a log 
aves_collgraph2 <- ggplot(aves_colltype, aes(x=collectionType, fill=source)) + geom_bar() + theme_bw()  + labs(x="Collection Type", y="Number of Bird Specimens (log scaled)") +
scale_y_continuous(trans='log10', expand=c(0,0)) 
aves_collgraph2
ggsave(plot=aves_collgraph, filename="aves/AvesGraphs/aves_type2.png", height=5, width=8, units="in", dpi=300)

```


#
#Aves Step 4. Make Tables 
```{r Family by Source & Collection Type Tables}
avestab= table(aves_master$acceptedName)
avestab = as.data.frame.table(avestab) 
avestab2 = avestab %>%
  rename(acceptedName = "Var1", total = "Freq")

aves_master2 = aves_master_na_ord %>%
  select(order, acceptedFamily, acceptedGenus, acceptedName)

avestable = left_join(avestab2, aves_master2 )
avestable = distinct(avestable)

avestab_inat = table(aves_inat$acceptedName)
avestab_inat = as.data.frame.table(avestab_inat) %>%
  rename(iNaturalist = "Freq", acceptedName = "Var1")

avestab_chis = table(aves_chis$acceptedName)
avestab_chis = as.data.frame.table(avestab_chis) %>%
  rename(CalIBIS = "Freq", acceptedName = "Var1") 

avestab_ebird = table(aves_ebird$acceptedName)
avestab_ebird = as.data.frame.table(avestab_ebird) %>%
  rename(EBIRD = "Freq", acceptedName = "Var1") 

avestab_sbmnh_col = table(aves_sbmnh_col$acceptedName)
avestab_sbmnh_col = as.data.frame.table(avestab_sbmnh_col) %>%
  rename(SBMNHcol= "Freq",  acceptedName = "Var1") 

avestab_sbmnh_obs = table(aves_sbmnh_obs$acceptedName)
avestab_sbmnh_obs = as.data.frame.table(avestab_sbmnh_obs) %>%
  rename(SBMNHobs= "Freq",  acceptedName = "Var1") 

aves_table <- left_join(avestable, avestab_inat)
aves_table2 <- left_join(aves_table, avestab_chis)
aves_table3 <- left_join(aves_table2, avestab_ebird)
aves_table4 <- left_join(aves_table3, avestab_sbmnh_col)
aves_table5 <- left_join(aves_table4, avestab_sbmnh_obs)

aves_table_complete <-aves_table5 %>%
  rename(Order = "order", Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus") %>%
  relocate("Order", "Family", "Genus", "Species", "CalIBIS", "SBMNHcol", "SBMNHobs", "EBIRD", "iNaturalist","total") 


write.csv(aves_table_complete, "aves/ave_table_complete2.csv", na="0")

# NOW DOING A TABLE BY Collections v Observations
aves_obs = rbind(aves_inat_combine, aves_ebird_combine, aves_sbmnh_obs_combine)
aves_col = rbind(aves_chis_combine, aves_sbmnh_col_combine)

avestab_obs = table(aves_obs$acceptedName)
avestab_obs = as.data.frame.table(avestab_obs) %>%
  rename(Observations = "Freq", acceptedName = "Var1") 

avestab_col = table(aves_col$acceptedName)
avestab_col = as.data.frame.table(avestab_col) %>%
  rename(Collections = "Freq", acceptedName = "Var1") 

avestable_combo = left_join(avestable, avestab_obs)
avestable_combo2 = left_join(avestable_combo, avestab_col)

aves_table_combo_complete <- avestable_combo2 %>%
   rename(Order= "order", Species = "acceptedName", Family = "acceptedFamily", Genus = "acceptedGenus") %>%
  relocate("Order", "Family", "Genus", "Species", "Collections", "Observations","total") 

write.csv(aves_table_combo_complete, "aves/ave_table_combo_complete2.csv", na="0")
```


#
#Endemic and Rare Aves 

##Create and Endemic and Rare only dataset 
```{r Creating a new datasheet with just endemics and rare}
aves_end <- read_csv("aves/aves_end_grouped.csv")

aves_end_join = inner_join(aves_master, aves_end) %>%
 mutate(source2 = fct_relevel(source, "Cal-IBIS (Egg Only)", "iNaturalist", "EBIRD", "SBMNH Collections", "SBMNH Observations"))

#unique acceptedName to check all 51 are present
avesdata = unique(c(as.character(aves_end_join$acceptedName)))
avesend = unique(c(as.character(aves_end$acceptedName)))
diffaves = setdiff(avesend, avesdata)
diffaves
#Circus cyaneus and Rhynchops niger are not currently present in occurence data, synonymy issue?
# Rynhops niger, changed it csv. now onlt diff by Circus cyaneus, which I think was meant to be local C. hudsonius bc C. cyaneus is native to Eurasia, just added a new row with it to csv, check with DAK, hudsonius is syn, fixed and the issues with rare subsp fixed
```

###Group A
```{r bird group A Accipitridae}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#[1] "#1B9E77" "#D95F02" "#7570B3" "#E7298A" "#66A61E"
# different lighter green "#A6D96A
aPalette <- c("#D95F02", "#E7298a", "#7FBC41")

aves_end_a = filter(aves_end_join, group=="a")

#temporal
aves_a_year = ggplot(aves_end_a, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") + scale_fill_manual(values=aPalette) + facet_wrap(vars(acceptedName), nrow=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_a_year

ggsave(plot=aves_a_year, filename="aves/AvesGraphs/aves_a_year.png", height=20, width=35, units="cm", dpi=300)
```
```{r bird A island}

aves_a_islandsum <- aves_end_a %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_a_islandsum2 <- na.omit(subset(aves_a_islandsum, select = c(island, samples, source2, acceptedName)))

aves_a_island <- ggplot(data = aves_a_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=aPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_a_island

ggsave(plot=aves_a_island, filename="aves/AvesGraphs/aves_a_island.png", height=20, width=35, units="cm", dpi=300)
```

###Group B
```{r bird group B Anatidae }
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#[1] Cal-IBIS "#1B9E77" iNaturalist "#D95F02" "EBIRD #7570B3" SBMNH Col "#E7298A" SBMNH Obs "#7FBC41"
bPalette <- c("#D95F02", "#7570B3", "#7FBC41")

aves_end_b = filter(aves_end_join, group=="b")

#temporal
aves_b_year = ggplot(aves_end_b, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=bPalette) + facet_wrap(vars(acceptedName), nrow=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_b_year

ggsave(plot=aves_b_year, filename="aves/AvesGraphs/aves_B_year.png", height=20, width=35, units="cm", dpi=300)
```
```{r bird B island}

aves_b_islandsum <- aves_end_b %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_b_islandsum2 <- na.omit(subset(aves_b_islandsum, select = c(island, samples, source2, acceptedName)))

aves_b_island <- ggplot(data = aves_b_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=bPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_b_island

ggsave(plot=aves_b_island, filename="aves/AvesGraphs/aves_B_island.png", height=20, width=35, units="cm", dpi=300)
```

###Group C Allen's Hummingbird
```{r bird group C Hummingbird }
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#[1] Cal-IBIS "#1B9E77" iNaturalist "#D95F02" "EBIRD #7570B3" SBMNH Col "#E7298A" SBMNH Obs "#7FBC41"
cPalette <- c( "#D95F02", "#7570b3", "#E7298A", "#7FBC41")

aves_end_c1 = filter(aves_master, acceptedName=="Selasphorus sasin")
aves_end_c2 = filter(aves_master, acceptedName=="Selasphorus sasin sedentarius")
aves_end_c = rbind(aves_end_c1, aves_end_c2)

#temporal
aves_c_year = ggplot(aves_end_c2, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5, ) + 
  theme_bw() + 
  labs(x="Year", y ="Log Transformed Data Points", fill="Data Source") +  scale_fill_manual(values=cPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(trans='log10', expand=expansion(mult=c(0,0.05))) + scale_x_continuous(limits=c(1890, 2021), breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020), expand=expansion(mult=c(0.05, 0.01))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_c_year

ggsave(plot=aves_c_year, filename="aves/AvesGraphs/aves_C_year.png", height=10, width=20, units="cm", dpi=300)
```
```{r bird C island}

aves_c_islandsum <- aves_end_c2 %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_c_islandsum2 <- na.omit(subset(aves_c_islandsum, select = c(island, samples, source2, acceptedName)))

island_size = read_csv("island_size.csv")
aves_c_islandsum2 = merge(aves_c_islandsum, island_size, by="island", all.y=TRUE) 

#replaced NAs in acceptedName with one of the species so an NA graph doesn't appear, but doesn't impact other graphs at all
aves_c_islandsum2$acceptedName[is.na(aves_c_islandsum2$acceptedName)] <- "Selasphorus sasin sedentarius"


aves_c_island <- ggplot(data = aves_c_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=cPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_c_island

ggsave(plot=aves_c_island, filename="aves/AvesGraphs/aves_C_island.png", height=10, width=20, units="cm", dpi=300)
```

###Group D
```{r bird group D Charadriiformes }
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
dPalette <- c("#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_d = filter(aves_end_join, group=="d")

#temporal
aves_d_year = ggplot(aves_end_d, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=dPalette) + facet_wrap(vars(acceptedName), ncol=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_d_year

ggsave(plot=aves_d_year, filename="aves/AvesGraphs/aves_D_year.png", height=40, width=35, units="cm", dpi=300)
```
```{r bird D island}
aves_d_islandsum <- aves_end_d %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_d_islandsum2 <- na.omit(subset(aves_d_islandsum, select = c(island, samples, source2, acceptedName)))

aves_d_island <- ggplot(data = aves_d_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), ncol=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=dPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_d_island

ggsave(plot=aves_d_island, filename="aves/AvesGraphs/aves_D_island.png", height=40, width=35, units="cm", dpi=300)
```

###Group E
```{r bird group E Cuckoo and Falcon.. }
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
ePalette <- c("#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_e = filter(aves_end_join, group=="e")
aves_end_e_falcon = filter(aves_end_join, acceptedGenus=="Falco")
aves_end_e_cuckoo =filter(aves_end_join, acceptedGenus=="Coccyzus")
#temporal
aves_e_year_falcon = ggplot(aves_end_e_falcon, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Log transformed Data Points", fill="Data Source") +  scale_fill_manual(values=dPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(trans='log10', expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_e_year_falcon

aves_e_year_cuckoo = ggplot(aves_end_e_cuckoo, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=dPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_e_year_cuckoo

aves_e_year = ggarrange(aves_e_year_cuckoo, aves_e_year_falcon, legend.grob=(get_legend(aves_e_year_falcon)), legend="right")
aves_e_year
ggsave(plot=aves_e_year, filename="aves/AvesGraphs/aves_E_year.png", height=10, width=35, units="cm", dpi=300)
```
```{r bird E island}
aves_e_islandsum <- aves_end_e %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_e_islandsum2 <- na.omit(subset(aves_e_islandsum, select = c(island, samples, source2, acceptedName)))

aves_e_island <- ggplot(data = aves_e_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=dPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_e_island

ggsave(plot=aves_e_island, filename="aves/AvesGraphs/aves_E_island.png", height=10, width=30, units="cm", dpi=300)
```

###Group F
```{r bird group F Quail and Loon }
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"

aves_end_f = filter(aves_end_join, group=="f")

#temporal
aves_f_year = ggplot(aves_end_f, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=dPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_f_year

ggsave(plot=aves_f_year, filename="aves/AvesGraphs/aves_F_year.png", height=10, width=35, units="cm", dpi=300)
```
```{r bird F island}
aves_f_islandsum <- aves_end_f %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_f_islandsum2 <- na.omit(subset(aves_f_islandsum, select = c(island, samples, source2, acceptedName)))

aves_f_island <- ggplot(data = aves_f_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=dPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_f_island

ggsave(plot=aves_f_island, filename="aves/AvesGraphs/aves_F_island.png", height=10, width=30, units="cm", dpi=300)
```

###Group G
```{r bird group G Lark, Tanager, Jay}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"

aves_end_g1 = filter(aves_end_join, group=="g") %>%
  select(source2, island, month, year, acceptedName)
aves_end_g_add = filter(aves_master, acceptedName=="Eremophila alpestris")%>%
  select(source2, island, month, year, acceptedName)

aves_end_g = rbind(aves_end_g1, aves_end_g_add) %>%
 mutate(acceptedName2 = fct_relevel(acceptedName, "Aphelocoma insularis", "Piranga rubra", "Eremophila alpestris", "Eremophila alpestris insularis"))

#temporal
aves_g_year = ggplot(aves_end_g, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=dPalette) + facet_wrap(vars(acceptedName2), nrow=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_g_year

ggsave(plot=aves_g_year, filename="aves/AvesGraphs/aves_G_year.png", height=20, width=35, units="cm", dpi=300)
```
```{r bird G island}

aves_g_islandsum <- aves_end_g %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName2, source2) %>%
  summarise(samples = sum(no_sample))

aves_g_islandsum2 <- na.omit(subset(aves_g_islandsum, select = c(island, samples, source2, acceptedName2)))

aves_g_island <- ggplot(data = aves_g_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName2), nrow=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=dPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_g_island

ggsave(plot=aves_g_island, filename="aves/AvesGraphs/aves_G_island.png", height=20, width=35, units="cm", dpi=300)
```

###Group H
```{r bird group H Sparrow and Towhee}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
hPalette <- c("#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_h = filter(aves_end_join, group=="h")

#temporal
aves_h_year = ggplot(aves_end_h, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=hPalette) + facet_wrap(vars(acceptedName), ncol=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_h_year

ggsave(plot=aves_h_year, filename="aves/AvesGraphs/aves_H_yearp.png", height=40, width=35, units="cm", dpi=300)
```
```{r bird H island}
aves_h_islandsum <- aves_end_h %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_h_islandsum2 <- na.omit(subset(aves_h_islandsum, select = c(island, samples, source2, acceptedName)))

aves_h_island <- ggplot(data = aves_h_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), ncol=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=hPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_h_island

ggsave(plot=aves_h_island, filename="aves/AvesGraphs/aves_H_islandp.png", height=40, width=35, units="cm", dpi=300)
```

###Group I
```{r bird group I Martin and Bank Swallow}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
iPalette <- c("#D95F02", "#7570B3", "#7FBC41")

aves_end_i = filter(aves_end_join, group=="i")

#temporal
aves_i_year = ggplot(aves_end_i, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=iPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_i_year

ggsave(plot=aves_i_year, filename="aves/AvesGraphs/aves_I_year.png", height=10, width=35, units="cm", dpi=300)
```
```{r bird I island}
aves_i_islandsum <- aves_end_i %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_i_islandsum2 <- na.omit(subset(aves_i_islandsum, select = c(island, samples, source2, acceptedName)))

island_size = read_csv("island_size.csv")
aves_i_islandsum2 = merge(aves_i_islandsum, island_size, by="island", all.y=TRUE) 

#replaced NAs in acceptedName with one of the species so an NA graph doesn't appear, but doesn't impact other graphs at all
aves_i_islandsum2$acceptedName[is.na(aves_i_islandsum2$acceptedName)] <- "Riparia riparia"


aves_i_island <- ggplot(data = aves_i_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=iPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_i_island

ggsave(plot=aves_i_island, filename="aves/AvesGraphs/aves_I_island.png", height=10, width=35, units="cm", dpi=300)
```

###Group J Ictertidae 
```{r bird group J Blackbird}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
jPalette <- c("#1B9E77", "#D95F02", "#E7298A", "#7FBC41")

aves_end_j = filter(aves_end_join, group=="j")

#temporal
aves_j_year = ggplot(aves_end_j, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=jPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_j_year

ggsave(plot=aves_j_year, filename="aves/AvesGraphs/aves_J_year.png", height=10, width=35, units="cm", dpi=300)
```
```{r bird J island}
aves_j_islandsum <- aves_end_j %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_j_islandsum2 <- na.omit(subset(aves_j_islandsum, select = c(island, samples, source2, acceptedName)))

aves_j_island <- ggplot(data = aves_j_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=jPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_j_island

ggsave(plot=aves_j_island, filename="aves/AvesGraphs/aves_J_island.png", height=10, width=35, units="cm", dpi=300)
```

###Group K
```{r bird group K Shrike}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
kPalette <- c("#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_k = filter(aves_end_join, group=="k")

#temporal
aves_k_year = ggplot(aves_end_k, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=kPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_k_year

ggsave(plot=aves_k_year, filename="aves/AvesGraphs/aves_K_year.png", height=10, width=35, units="cm", dpi=300)
```
```{r bird K island}
aves_k_islandsum <- aves_end_k %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_k_islandsum2 <- na.omit(subset(aves_k_islandsum, select = c(island, samples, source2, acceptedName)))

island_size = read_csv("island_size.csv")
aves_k_islandsum2 = merge(aves_k_islandsum, island_size, by="island", all.y=TRUE) 

#replaced NAs in acceptedName with one of the species so an NA graph doesn't appear, but doesn't impact other graphs at all
aves_k_islandsum2$acceptedName[is.na(aves_k_islandsum2$acceptedName)] <- "Lanius ludovicianus anthonyi"

aves_k_island <- ggplot(data = aves_k_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=kPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_k_island

ggsave(plot=aves_k_island, filename="aves/AvesGraphs/aves_K_island.png", height=10, width=35, units="cm", dpi=300)
```

###Group L: Leiothlypis spp, Icteria sp, Setophaga sp
```{r bird group L Chat and Warbler}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
lPalette <- c("#1B9E77","#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_l1 = filter(aves_end_join, group=="l") %>%
  select(source2, island, month, year, acceptedName)
aves_end_l_add = filter(aves_master, acceptedName=="Leiothlypis celata")%>%
  select(source2, island, month, year, acceptedName)

aves_end_l = rbind(aves_end_l1, aves_end_l_add) %>%
 mutate(acceptedName2 = fct_relevel(acceptedName, "Leiothlypis celata", "Leiothlypis celata sordida", "Leiothlypis luciae", "Icteria virens", "Setophaga petechia brewsteri"))
#temporal
aves_l_year = ggplot(aves_end_l, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=lPalette) + facet_wrap(vars(acceptedName2), ncol=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_l_year

ggsave(plot=aves_l_year, filename="aves/AvesGraphs/aves_L_year.png", height=30, width=35, units="cm", dpi=300)
```
```{r bird L island}
aves_l_islandsum <- aves_end_l %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName2, source2) %>%
  summarise(samples = sum(no_sample))

aves_l_islandsum2 <- na.omit(subset(aves_l_islandsum, select = c(island, samples, source2, acceptedName2)))

aves_l_island <- ggplot(data = aves_l_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName2), ncol=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=lPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_l_island

ggsave(plot=aves_l_island, filename="aves/AvesGraphs/aves_L_island.png", height=30, width=35, units="cm", dpi=300)
```

###Group M Thryomanes bewickii
```{r bird group M Wren }
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
mPalette <- c("#1B9E77","#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_m = filter(aves_master, acceptedGenus=="Thryomanes")

#temporal
aves_m_year = ggplot(aves_end_m, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=mPalette) + facet_wrap(vars(acceptedName), ncol=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_m_year

ggsave(plot=aves_m_year, filename="aves/AvesGraphs/aves_M_year.png", height=20, width=35, units="cm", dpi=300)
```
```{r bird M island}
aves_m_islandsum <- aves_end_m %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_m_islandsum2 <- na.omit(subset(aves_m_islandsum, select = c(island, samples, source2, acceptedName)))

island_size = read_csv("island_size.csv")
aves_m_islandsum2 = merge(aves_m_islandsum, island_size, by="island", all.y=TRUE) 

#replaced NAs in acceptedName with one of the species so an NA graph doesn't appear, but doesn't impact other graphs at all
aves_m_islandsum2$acceptedName[is.na(aves_m_islandsum2$acceptedName)] <- "Thryomanes bewickii charienturus"

aves_m_island <- ggplot(data = aves_m_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), ncol=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=mPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_m_island

ggsave(plot=aves_m_island, filename="aves/AvesGraphs/aves_M_island.png", height=20, width=35, units="cm", dpi=300)
```

###Group N
```{r bird group N Flycatcher}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
nPalette <- c("1B9E77", "#D95F02", "#7570B3", "#E7298A", "#7FBC41")
aves_end_n1 = filter(aves_end_join, group=="n") %>%
  select(source2, island, month, year, acceptedName)
aves_end_n_add = filter(aves_master, acceptedName=="Empidonax difficilis")%>%
  select(source2, island, month, year, acceptedName)

aves_end_n = rbind(aves_end_n1, aves_end_n_add) %>%
 mutate(acceptedName2 = fct_relevel(acceptedName, "Empidonax difficilis", "Empidonax difficilis insulicola", "Empidonax traillii", "Contopus cooperi", "Pyrocephalus rubinus"))


#temporal
aves_n_year = ggplot(aves_end_n, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=mPalette) + facet_wrap(vars(acceptedName2), ncol=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_n_year

ggsave(plot=aves_n_year, filename="aves/AvesGraphs/aves_N_year.png", height=30, width=35, units="cm", dpi=300)
```
```{r bird N island}
aves_n_islandsum <- aves_end_n %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName2, source2) %>%
  summarise(samples = sum(no_sample))

aves_n_islandsum2 <- na.omit(subset(aves_n_islandsum, select = c(island, samples, source2, acceptedName2)))

aves_n_island <- ggplot(data = aves_n_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName2), ncol=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=mPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_n_island

ggsave(plot=aves_n_island, filename="aves/AvesGraphs/aves_N_island.png", height=30, width=35, units="cm", dpi=300)
```

###Group O: Vireo
```{r bird group O Vireo}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
oPalette <- c("#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_o = filter(aves_end_join, group=="o")

#temporal
aves_o_year = ggplot(aves_end_o, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=oPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_o_year

ggsave(plot=aves_o_year, filename="aves/AvesGraphs/aves_O_year.png", height=10, width=35, units="cm", dpi=300)
```
```{r bird O island}
aves_o_islandsum <- aves_end_o %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))
aves_o_islandsum2 <- na.omit(subset(aves_o_islandsum, select = c(island, samples, source2, acceptedName)))

island_size = read_csv("island_size.csv")
aves_o_islandsum2 = merge(aves_o_islandsum, island_size, by="island", all.y=TRUE) 

#replaced NAs in acceptedName with one of the species so an NA graph doesn't appear, but doesn't impact other graphs at all
aves_o_islandsum2$acceptedName[is.na(aves_o_islandsum2$acceptedName)] <- "Vireo vicinior"

aves_o_island <- ggplot(data = aves_o_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=oPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_o_island

ggsave(plot=aves_o_island, filename="aves/AvesGraphs/aves_O_island.png", height=10, width=35, units="cm", dpi=300)
```

###Group P: Pelican
```{r bird group P Pelican}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
dPalette <- c("#1B9E77","#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_p = filter(aves_end_join, group=="p")

#temporal
aves_p_year = ggplot(aves_end_p, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=dPalette) + facet_wrap(vars(acceptedName), nrow=1, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05)), breaks=function(x) unique(floor(pretty(seq(0, (max(x)+1 *1.1)))))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_p_year

ggsave(plot=aves_p_year, filename="aves/AvesGraphs/aves_P_year.png", height=10, width=35, units="cm", dpi=300)
```
```{r bird P island}
aves_p_islandsum <- aves_end_p %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))
aves_p_islandsum2 <- na.omit(subset(aves_p_islandsum, select = c(island, samples, source2, acceptedName)))

aves_p_island <- ggplot(data = aves_p_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=1, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=dPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_p_island

ggsave(plot=aves_p_island, filename="aves/AvesGraphs/aves_P_island.png", height=10, width=35, units="cm", dpi=300)
```

###Group Q: Albatross and Petrel
```{r bird group Q Albatross Petrel}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"

aves_end_q = filter(aves_end_join, group=="q")

#temporal
aves_q_year = ggplot(aves_end_q, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=dPalette) + facet_wrap(vars(acceptedName), nrow=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_q_year

ggsave(plot=aves_q_year, filename="aves/AvesGraphs/aves_Q_year.png", height=20, width=35, units="cm", dpi=300)
```
```{r bird Q island}
aves_q_islandsum <- aves_end_q %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_q_islandsum2 <- na.omit(subset(aves_q_islandsum, select = c(island, samples, source2, acceptedName)))

aves_q_island <- ggplot(data = aves_q_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=dPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_q_island

ggsave(plot=aves_q_island, filename="aves/AvesGraphs/aves_Q_island.png", height=20, width=35, units="cm", dpi=300)
```

###Group R: Owl
```{r R temporal}
#brewer.pal(5, name="Dark2") Color codes for the brewer colors, need 1, 2 and 4 for this one
#Cal-IBIS "#1B9E77"            iNaturalist "#D95F02"            EBIRD #7570B3"
#SBMNH Col "#E7298A"            SBMNH Obs "#7FBC41"
rPalette <- c("#D95F02", "#7570B3", "#E7298A", "#7FBC41")

aves_end_r = filter(aves_end_join, group=="r")

#temporal
aves_r_year = ggplot(aves_end_r, aes(x=year, fill=source2)) + 
  geom_bar(width=0.5) + 
  theme_bw() + 
  labs(x="Year", y ="Number of Data Points", fill="Data Source") +  scale_fill_manual(values=rPalette) + facet_wrap(vars(acceptedName), nrow=2, scales="free_y")  + scale_y_continuous(expand=expansion(mult=c(0,0.05))) + scale_x_continuous(breaks=c(1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000, 2020)) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 
aves_r_year

ggsave(plot=aves_r_year, filename="aves/AvesGraphs/aves_R_year.png", height=20, width=35, units="cm", dpi=300)
```
```{r R island}
aves_r_islandsum <- aves_end_r %>%
  mutate(no_sample = 1) %>%
  group_by(island, acceptedName, source2) %>%
  summarise(samples = sum(no_sample))

aves_r_islandsum2 <- na.omit(subset(aves_r_islandsum, select = c(island, samples, source2, acceptedName)))

aves_r_island <- ggplot(data = aves_r_islandsum2, aes(x = samples, y = fct_rev(island), fill=source2)) + geom_bar(stat = "identity") + facet_wrap(vars(acceptedName), nrow=2, scales="free_x") +
  labs(y ="Island",  x = "Number of Data Points", fill = "Data Source") + theme_bw() + scale_fill_manual(values=rPalette) + scale_x_continuous(expand=expansion(mult=c(0,0.05))) + theme(axis.text = element_text(size = 8), axis.title = element_text(size=15), strip.text = element_text(size=14), legend.text = element_text(size=12)) 

aves_r_island

ggsave(plot=aves_r_island, filename="aves/AvesGraphs/aves_R_island.png", height=20, width=35, units="cm", dpi=300)
```

