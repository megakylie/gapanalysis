---
title: "Cleaning plants"
author: "Josie Lesage"
date: "8/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# load packages
library(tidyverse)
library(stringr)
```

# File goal

The goal of this file is to finish the data prep of a partially cleaned dataset of plants on the Channel Islands. 

In step 1 of this process, we'll ensure that the locality information or spatial information from each island is encoded and remove any records with such poor info that that we can't assign an island. I started this process by passing the data through a ArcGIS map layer to spatially join the island names for points that were accurately GPS'd.

```{r}
# import two files (bc one is too big)
plants_raw_1 <- read_csv("Josie/Data/plants_raw_1.csv", col_types = cols(.default = "c", isl_name = "c")) 
plants_raw_2 <- read_csv("Josie/Data/plants_raw_2.csv", col_types = cols(.default = "c", isl_name = "c")) 

# smoosh together
plants_raw <- full_join(plants_raw_1, plants_raw_2)

# change locality data to lowercase
plants_isl1 <- plants_raw %>%
  mutate(locality_low = str_to_lower(locality)) 

plants_isl <- plants_isl1 %>%
  # remove weird states/locations
  filter(stateProvince != "Missouri" | is.na(stateProvince),
         stateProvince != "Alaska" | is.na(stateProvince),
         stateProvince != "Michigan" | is.na(stateProvince),
         stateProvince != "Kentucky" | is.na(stateProvince),
         stateProvince != "UTAH" | is.na(stateProvince),
         stateProvince != "Florida" | is.na(stateProvince),
         stateProvince != "Glapagos" | is.na(stateProvince),
         stateProvince != "Colorado" | is.na(stateProvince),
         stateProvince != "Gal<e1>pagos" | is.na(stateProvince),
         stateProvince != "Gal<e1>pagos Prov." | is.na(stateProvince),
         stateProvince != "Province Gal<e1>pagos Islands" | is.na(stateProvince),
         stateProvince != "Galapagos Islands" | is.na(stateProvince),
         stateProvince != "Provincia de Galapagos" | is.na(stateProvince),
         stateProvince != "Galapagos" | is.na(stateProvince)) %>%
  # start adding real island names
  mutate(isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "san nicolas"), "San Nicolas", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "san nicholas"), "San Nicolas", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "nicholas"), "San Nicolas", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "nicolas"), "San Nicolas", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "santa catalina is"), "Santa Catalina", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "catalina is"), "Santa Catalina", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "catalina"), "Santa Catalina", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "santa rosa i"), "Santa Rosa", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "clemente"), "San Clemente", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "clement"), "San Clemente", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "santa cruz"), "Santa Cruz", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "cruz is"), "Santa Cruz", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "coronados i"), "Coronados", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "coronado i"), "Coronados", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "isla coronado"), "Coronados", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "anacapa"), "Anacapa", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "cedros"), "Cedros", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "miguel"), "San Miguel", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "guadalupe"), "Guadalupe", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "todos santo"), "Todos Santos", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "todo santos"), "Todos Santos", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "natividad"), "Natividad", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "benito"), "San Benito", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "martin"), "San Martin", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "santa barbara isl"), "Santa Barbara", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "jeronimo"), "Geronimo", isl_name),
         isl_name = ifelse(is.na(isl_name) & str_detect(locality_low, "geronimo"), "Geronimo", isl_name)) %>%
  filter(!is.na(isl_name)) %>%
  filter(isl_name == "San Nicolas" | isl_name == "Santa Catalina" | isl_name == "Santa Rosa" | isl_name == "Santa Barbara" | 
           isl_name == "Anacapa" | isl_name == "Santa Cruz" | isl_name == "San Clemente" | isl_name == "San Miguel") 

remove(plants_raw_1, plants_raw_2, plants_isl1)
```


In step 2, we'll remove any obvious horticulture species from the dataset and fix synonyms to be up-to-date and consistent. To do this, we'll compare a master list of species names that Kristen indicated should be eliminated from the analysis data. 


```{r intial cleanup pass - plant data}
plants_genus <- plants_isl %>%
  # break the "scientific name" column into two parts - genus and species
  mutate(epithetfilter =  scientificName) %>%
  separate(epithetfilter, sep = " ", into = c("genus_filter", "epithet_filter"), extra = "merge") %>%
  # remove anything that wasn't given a specific epithet
  filter(!is.na(epithet_filter)) %>%
  # fix poaceae - for some reason is capitalized
  mutate(family = ifelse(family == "POACEAE", "Poaceae", family),
         scientificName = str_to_lower(scientificName)) %>%
  # filter to just the tracheophyta
  filter(phylum == "Tracheophyta")

# isolate by-island species
by_isl <- read_csv("Josie/Data/byislsp.csv", col_types = cols(.default = "c")) %>%
  rename(scientificName = old_name) %>%
  mutate(scientificName = str_to_lower(scientificName)) %>%
  dplyr::select(scientificName, assign_by_island)

plants_byisl <- left_join(plants_genus, by_isl) %>%
  filter(!is.na(assign_by_island))

plants_nonisl <- left_join(plants_genus, by_isl) %>%
  filter(is.na(assign_by_island))

```




```{r fix synonomy for taxa not sorted by island}
# fix classes/orders based on taxonomy 
plants_combo4_orders <- plants_combo4 %>%
  mutate(order = ifelse(Family_4 == "Alliaceae", "Asparagales", order),
         order = ifelse(Family_4 == "Asparagaceae", "Asparagales", order),
         order = ifelse(Family_4 == "Asphodelaceae", "Asparagales", order),
         order = ifelse(Family_4 == "Caprifoliaceae", "Dipsacales", order),
         order = ifelse(Family_4 == "Caryophyllaceae", "Caryophyllales", order),
         order = ifelse(Family_4 == "Geraniaceae", "Geraniales", order),
         order = ifelse(Family_4 == "Hydrophyllaceae", "Boraginales", order),
         order = ifelse(Family_4 == "Nyctaginaceae", "Caryophyllales", order),
         order = ifelse(Family_4 == "Orobanchaceae", "Lamiales", order),
         order = ifelse(Family_4 == "Polygonaceae", "Caryophyllales", order),
         order = ifelse(Family_4 == "Solanaceae", "Solanales", order),
         class = ifelse(Family_4 == "Solanaceae", "Magnoliopsida", class),
         order = ifelse(Family_4 == "Themidaceae", "Asparagales", order),
         family = ifelse(genus == "Athyrium", "Athyriaceae", family)) %>%
  rename(old_name = scientificName)

test <- plants_combo4_orders %>%
  select(old_name, sciname_4, Eliminate) %>%
  filter(is.na(sciname_4)) %>%
  distinct()

```


### Main data cleanup by island
After fixing synonyms and removing the major problem species, we also want to remove specimens that were assigned the incorrect island based on their known occurrences. 

```{r cleanup for main islands by island}

plants_nonisl_initialclean <- plants_combo4_orders %>%
  filter(Eliminate == "Keep")

SMI <- plants_nonisl_initialclean %>%
  filter(isl_name == "San Miguel",
         SMI == "1")

SR <- plants_nonisl_initialclean %>%
  filter(isl_name == "Santa Rosa",
         SR == "1")

SCR <- plants_nonisl_initialclean %>%
  filter(isl_name == "Santa Cruz",
         SCR == "1")

A <- plants_nonisl_initialclean %>%
  filter(isl_name == "Anacapa",
         SR == "1")

SBA <- plants_nonisl_initialclean %>%
  filter(isl_name == "Santa Barbara",
         SBA == "1")

SNI <- plants_nonisl_initialclean %>%
  filter(isl_name == "San Nicolas",
         SNI == "1")

SCL <- plants_nonisl_initialclean %>%
  filter(isl_name == "San Clemente",
         SCL == "1")

SCA <- plants_nonisl_initialclean %>%
  filter(isl_name == "Santa Catalina",
         SCA == "1")

plants_nonisl_clean <- rbind(SBA, SCA, SCL, SCR, SMI, SNI, SR, A)

remove(SBA, SCA, SCL, SCR, SMI, SNI, SR, A)

```



### Special Cases - by island
In a few cases, we'll want to clean the data OR assign MRT based on the specific island a speciment is from. 

```{r}
by_isl_filter <- read_csv("Josie/Data/byislsp_islcheck.csv", col_types = cols(.default = "c")) %>%
  mutate(sciname_2 = str_to_sentence(sciname_3)) %>%
  distinct()

by_isl_namechanges <- read_csv("Josie/Data/byislsp_namechanges.csv", col_types = cols(.default = "c")) %>%
  rename(scientificName = old_name) %>%
  mutate(scientificName = str_to_lower(scientificName))

plants_byisl_join <- left_join(plants_byisl, by_isl_namechanges) %>%
  mutate(sciname_2 = coalesce(name_based_onisl, scientificName)) %>%
  dplyr::select(-name_based_onisl) %>%
  mutate(scientificName = str_to_sentence(scientificName),
         sciname_2 = ifelse(scientificName == "Eriogonum giganteum" & isl_name == "Santa Barbara", 
                            "Eriogonum giganteum var. compactum", sciname_2),
         sciname_2 = ifelse(scientificName == "Eriogonum giganteum" & isl_name == "San Clemente",
                            "Eriogonum giganteum var. formosum", sciname_2),
         sciname_2 = ifelse(scientificName == "Eriogonum giganteum" & isl_name == "Santa Catalina", 
                            "Eriogonum giganteum var. giganteum", sciname_2),
         sciname_2 = ifelse(scientificName == "Eriogonum giganteum" & isl_name == "Santa Cruz", 
                            "Eriogonum giganteum var. giganteum", sciname_2),
         
         sciname_2 = ifelse(scientificName == "Eriogonum grande" & isl_name == "San Clemente",
                            "Eriogonum giganteum var. grande", sciname_2),
         sciname_2 = ifelse(scientificName == "Eriogonum grande" & isl_name == "Santa Catalina", 
                            "Eriogonum giganteum var. grande", sciname_2),
         sciname_2 = ifelse(scientificName == "Eriogonum grande" & isl_name == "San Nicolas", 
                            "Eriogonum giganteum var. timorum", sciname_2),
         sciname_2 = ifelse(scientificName == "Eriogonum grande" & isl_name == "San Miguel", 
                            "Eriogonum giganteum var. rubescens", sciname_2),
         
         sciname_2 = ifelse(scientificName == "Lotus dendroideus" & isl_name == "Santa Rosa", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Lotus dendroideus" & isl_name == "Santa Cruz", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Lotus dendroideus" & isl_name == "Santa Catalina", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Lotus dendroideus" & isl_name == "Anacapa", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Lotus dendroideus" & isl_name == "San Miguel", 
                            "Acmispon dendroideus var. veatchii", sciname_2),
         sciname_2 = ifelse(scientificName == "Lotus dendroideus" & isl_name == "San Clemente", 
                            "Acmispon dendroideus var. traskiae", sciname_2),
        
         sciname_2 = ifelse(scientificName == "Acmispon dendroideus" & isl_name == "Santa Rosa", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Acmispon dendroideus" & isl_name == "Santa Cruz", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Acmispon dendroideus" & isl_name == "Santa Catalina", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Acmispon dendroideus" & isl_name == "Anacapa", 
                            "Acmispon dendroideus var. dendroideus", sciname_2),
         sciname_2 = ifelse(scientificName == "Acmispon dendroideus" & isl_name == "San Miguel", 
                            "Acmispon dendroideus var. veatchii", sciname_2),
         sciname_2 = ifelse(scientificName == "Acmispon dendroideus" & isl_name == "San Clemente", 
                            "Acmispon dendroideus var. traskiae", sciname_2),
        
         sciname_2 = ifelse(scientificName == "Galium angustifolium" & isl_name == "Santa Catalina", 
                            "Galium angustifolium subsp. angustifolium", sciname_2),
         sciname_2 = ifelse(scientificName == "Galium angustifolium" & isl_name == "Santa Rosa", 
                            "Galium angustifolium subsp. foliosum", sciname_2),
         sciname_2 = ifelse(scientificName == "Galium angustifolium" & isl_name == "Santa Cruz", 
                            "Galium angustifolium subsp. foliosum", sciname_2),
         sciname_2 = ifelse(scientificName == "Galium angustifolium" & isl_name == "Anacapa", 
                            "Galium angustifolium subsp. foliosum", sciname_2),
         
         sciname_2 = ifelse(scientificName == "Galium catalinense" & isl_name == "San Clemente", 
                            "Galium catalinense subsp. acrispum", sciname_2),
         sciname_2 = ifelse(scientificName == "Galium catalinense" & isl_name == "Santa Catalina", 
                            "Galium catalinense subsp. catalinense", sciname_2),

         sciname_2 = ifelse(scientificName == "Malvastrum nesioticum" & isl_name == "Santa Catalina", 
                            "Malacothamnus fasciculatus var. catalinensis", sciname_2),
         sciname_2 = ifelse(scientificName == "Malvastrum nesioticum" & isl_name == "Santa Cruz", 
                            "Malacothamnus fasciculatus var. nesioticus", sciname_2),
         sciname_2 = ifelse(scientificName == "Malacothamnus fasciculatus" & isl_name == "Santa Catalina", 
                            "Malacothamnus fasciculatus var. catalinensis", sciname_2),
         sciname_2 = ifelse(scientificName == "Malacothamnus fasciculatus" & isl_name == "Santa Cruz", 
                            "Malacothamnus fasciculatus var. nesioticus", sciname_2),
        
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora" & isl_name == "Santa Catalina", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora" & isl_name == "San Clemente", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. glabra" & isl_name == "San Clemente", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. glabra" & isl_name == "Santa Catalina", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora" & isl_name == "San Clemente", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora" & isl_name == "Santa Catalina", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. glabra" & isl_name == "San Clemente", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. glabra" & isl_name == "Santa Catalina", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. assurgentiflora" & isl_name == "San Clemente",
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. assurgentiflora" & isl_name == "Santa Catalina", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. assurgentiflora" & isl_name == "San Clemente",
                            "Malva assurgentiflora subsp. glabra", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. assurgentiflora" & isl_name == "Santa Catalina", 
                            "Malva assurgentiflora subsp. glabra", sciname_2),

         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. assurgentiflora" & isl_name == "San Miguel",
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. assurgentiflora" & isl_name == "Santa Rosa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. assurgentiflora" & isl_name == "Santa Cruz", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. assurgentiflora" & isl_name == "Anacapa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora" & isl_name == "San Miguel",
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora" & isl_name == "Santa Rosa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora" & isl_name == "Santa Cruz", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora" & isl_name == "Anacapa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. glabra" & isl_name == "San Miguel",
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. glabra" & isl_name == "Santa Rosa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. glabra" & isl_name == "Santa Cruz", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Malva assurgentiflora subsp. glabra" & isl_name == "Anacapa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. glabra" & isl_name == "San Miguel",
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. glabra" & isl_name == "Santa Rosa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. glabra" & isl_name == "Santa Cruz", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. glabra" & isl_name == "Anacapa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. assurgentiflora" & isl_name == "San Miguel",
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. assurgentiflora" & isl_name == "Santa Rosa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. assurgentiflora" & isl_name == "Santa Cruz", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora subsp. assurgentiflora" & isl_name == "Anacapa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora" & isl_name == "San Miguel",
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora" & isl_name == "Santa Rosa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora" & isl_name == "Santa Cruz", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lavatera assurgentiflora" & isl_name == "Anacapa", 
                            "Malva assurgentiflora subsp. assurgentiflora", sciname_2),  
         
         sciname_2 = ifelse(scientificName == "Lyonothamnus aspleniifolius" & isl_name == "Santa Cruz", 
                            "Lyonothamnus floribundus subsp. aspleniifolius", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lyonothamnus aspleniifolius" & isl_name == "Santa Rosa", 
                            "Lyonothamnus floribundus subsp. aspleniifolius", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lyonothamnus aspleniifolius" & isl_name == "San Clemente", 
                            "Lyonothamnus floribundus subsp. aspleniifolius", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lyonothamnus aspleniifolius" & isl_name == "Santa Catalina", 
                            "Lyonothamnus floribundus subsp. floribundus", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lyonothamnus floribundus" & isl_name == "Santa Cruz", 
                            "Lyonothamnus floribundus subsp. aspleniifolius", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lyonothamnus floribundus" & isl_name == "Santa Rosa", 
                            "Lyonothamnus floribundus subsp. aspleniifolius", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lyonothamnus floribundus" & isl_name == "San Clemente", 
                            "Lyonothamnus floribundus subsp. aspleniifolius", sciname_2),  
         sciname_2 = ifelse(scientificName == "Lyonothamnus floribundus" & isl_name == "Santa Catalina", 
                            "Lyonothamnus floribundus subsp. floribundus", sciname_2),
         
         sciname_2 = ifelse(scientificName == "Dudleya hassei", 
                            "Dudleya virens", sciname_2),
         sciname_2 = ifelse(scientificName == "Dudleya virens subsp. hassei", 
                            "Dudleya virens", sciname_2),
         sciname_2 = ifelse(scientificName == "Dudleya virens subsp. insularis", 
                            "Dudleya virens", sciname_2),
         sciname_2 = ifelse(scientificName == "Dudleya virens subsp. virens", 
                            "Dudleya virens", sciname_2),
         
         sciname_2 = ifelse(scientificName == "Delphinium parryi subsp. maritimum", 
                            "Delphinium parryi", sciname_2),
         sciname_2 = ifelse(scientificName == "Delphinium parryi subsp. parryi", 
                            "Delphinium parryi", sciname_2),

         sciname_2 = ifelse(scientificName == "Camissonia cheiranthifolia", 
                            "Camissoniopsis cheiranthifolia", sciname_2),   
         sciname_2 = ifelse(scientificName == "Camissonia cheiranthifolia subsp. cheiranthifolia", 
                            "Camissoniopsis cheiranthifolia", sciname_2),   
         sciname_2 = ifelse(scientificName == "Camissoniopsis cheiranthifolia subsp. cheiranthifolia", 
                            "Camissoniopsis cheiranthifolia", sciname_2),   
         sciname_2 = ifelse(scientificName == "Camissonia cheiranthifolia subsp. suffruticosa", 
                            "Camissoniopsis cheiranthifolia", sciname_2),   
         sciname_2 = ifelse(scientificName == "Camissoniopsis cheiranthifolia subsp. suffruticosa", 
                            "Camissoniopsis cheiranthifolia", sciname_2)) 

plants_byisl_join2 <- left_join(plants_byisl_join, by_isl_filter)


SMI <- plants_byisl_join2 %>%
  filter(isl_name == "San Miguel",
         SMI == "1")

SR <- plants_byisl_join2 %>%
  filter(isl_name == "Santa Rosa",
         SR == "1")

SCR <- plants_byisl_join2 %>%
  filter(isl_name == "Santa Cruz",
         SCR == "1")

A <- plants_byisl_join2 %>%
  filter(isl_name == "Anacapa",
         SR == "1")

SBA <- plants_byisl_join2 %>%
  filter(isl_name == "Santa Barbara",
         SBA == "1")

SNI <- plants_byisl_join2 %>%
  filter(isl_name == "San Nicolas",
         SNI == "1")

SCL <- plants_byisl_join2 %>%
  filter(isl_name == "San Clemente",
         SCL == "1")

SCA <- plants_byisl_join2 %>%
  filter(isl_name == "Santa Catalina",
         SCA == "1")

plants_byisl_join2_clean <- rbind(SBA, SCA, SCL, SCR, SMI, SNI, SR, A) %>%
  rename(sciname_4 = sciname_3)

remove(SBA, SCA, SCL, SCR, SMI, SNI, SR, A)


```

## Summary Lists

```{r}
all_clean <- full_join(plants_nonisl_clean, plants_byisl_join2_clean)

plants_keep <- all_clean %>% 
  mutate(Sci_Name = str_to_sentence(sciname_4)) %>%
  dplyr::select(kingdom_final, phylum_final, class_final, order_final, family_final, old_name, Sci_Name,
         eventDate, year, month, day, startDayOfYear, endDayOfYear, verbatimEventDate, associatedTaxa, 
         country, stateProvince, county, municipality, locality, isl_name,
         decimalLatitude, decimalLongitude, geodeticDatum,
         id, institutionCode, collectionCode, occurrenceID, basisOfRecord, catalogNumber,
         scientificNameAuthorship, identifiedBy, dateIdentified, recordedBy, associatedCollectors) %>%
  filter(institutionCode != "iNaturalist")

write_csv(plants_keep, "Josie/Data/DraftData_20210921.csv")
```


